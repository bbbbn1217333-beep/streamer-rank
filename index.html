<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="referrer" content="no-referrer">
<title>ì´ë¼333ë°° ë©”ì´í”Œ ê°œë§ì§± ì»¨í…ì¸ </title>
<link rel="icon" href="https://i.postimg.cc/d1w9vSmS/seukeulinsyas-2025-12-18-180217.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: transparent; font-family: 'Noto Sans KR', sans-serif; padding: 0; width: 850px; overflow: hidden; }
.scale-wrapper { width: 630px; transform-origin: top left; transform: scale(1.3492); padding: 5px; }
.panel-wrap { border-radius: 10px; overflow: hidden; }
.panel {
  background: linear-gradient(160deg, #1a0000 0%, #3d0000 40%, #1a0000 100%);
  border-radius: 10px; border: 2px solid #c82a2a;
  box-shadow: 0 0 0 1px #6b0000, 0 0 24px rgba(200,42,42,0.3), inset 0 1px 0 rgba(255,100,100,0.12);
  position: relative;
}
.header {
  position: relative; z-index: 10;
  display: flex; align-items: center; justify-content: space-between;
  padding: 2px 12px;
  background: linear-gradient(90deg, transparent, rgba(255,50,50,0.07), transparent);
  border-bottom: 2px solid #6b0000;
}
.header-center {
  display: flex; align-items: center; gap: 6px; flex: 1; justify-content: center;
  pointer-events: none;
}
.header-title {
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: 20px; font-weight: 800; color: #ffb3b3;
  text-shadow: 0 0 10px rgba(255,50,50,0.5), 1px 1px 0 rgba(0,0,0,0.6);
  letter-spacing: 3px;
}
.header-glove { font-size: 20px; display: inline-block; animation: punch 0.6s ease infinite alternate; }
@keyframes punch { from { transform: scale(1) rotate(-15deg); } to { transform: scale(1.2) rotate(10deg); } }
.header-btns {
  display: flex; align-items: center; gap: 5px; flex-shrink: 0;
  position: relative; z-index: 20;
}
.lock-btn {
  background: none; border: none; cursor: pointer;
  font-size: 20px; line-height: 1; padding: 0 2px; transition: transform 0.2s;
}
.lock-btn:hover { transform: scale(1.2); }
.finish-btn {
  background: linear-gradient(135deg, #c70000, #ff4444);
  border: 1px solid #ff8080; border-radius: 5px;
  color: #fff; font-size: 11px; font-weight: 900;
  padding: 3px 8px; cursor: pointer;
  font-family: 'Noto Sans KR', sans-serif;
  transition: all 0.15s; box-shadow: 0 2px 6px rgba(0,0,0,0.4);
}
.finish-btn:hover { transform: scale(1.05); }
.finish-btn.active { background: linear-gradient(135deg, #ff4040, #ff0000); border-color: #ffaaaa; color: #fff; }
.race-section { position: relative; z-index: 1; padding: 1px 7px 1px; }
.race-row { margin-bottom: 1px; }
@keyframes fadeSlide { from { opacity:0; transform: translateX(-12px); } to { opacity:1; transform: translateX(0); } }
.race-row:nth-child(1)  { animation: fadeSlide 0.3s 0.00s both; }
.race-row:nth-child(3)  { animation: fadeSlide 0.3s 0.04s both; }
.race-row:nth-child(5)  { animation: fadeSlide 0.3s 0.08s both; }
.race-row:nth-child(7)  { animation: fadeSlide 0.3s 0.12s both; }
.race-row:nth-child(9)  { animation: fadeSlide 0.3s 0.16s both; }
.race-row:nth-child(11) { animation: fadeSlide 0.3s 0.20s both; }
.race-row:nth-child(13) { animation: fadeSlide 0.3s 0.24s both; }
.race-top { display: flex; align-items: center; gap: 5px; margin-bottom: 0px; }
.rank-badge {
  width: 24px; height: 24px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 900; flex-shrink: 0; border: 2px solid;
}
.rank-1 { background: radial-gradient(circle, #ff4747, #c70000); color: #fff; border-color: #ff6060; box-shadow: 0 0 8px rgba(255,50,50,0.6); }
.rank-2 { background: radial-gradient(circle, #d0d8e0, #7a8a99); color: #1a2030; border-color: #b0bec5; }
.rank-3 { background: radial-gradient(circle, #f0a070, #a04010); color: #2a0800; border-color: #cd7f32; }
.rank-other { background: rgba(0,0,0,0.4); color: #e8b0b0; border-color: #5a2020; }
.avatar-wrap { position: relative; width: 40px; height: 40px; flex-shrink: 0; }
.avatar-img {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scaleX(-1);
  width: 250px; height: 250px; object-fit: contain;
  image-rendering: auto;
  filter: drop-shadow(0 1px 4px rgba(0,0,0,0.6));
  z-index: 2;
}
.name-score { flex: 1; min-width: 0; display: flex; align-items: center; gap: 5px; }
.score-total + .score-label { margin-left: 0; }
.streamer-name {
  font-size: 16px; font-weight: 900; color: #ffb3b3;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.8);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 120px;
}
.score-total { font-size: 18px; font-weight: 900; color: #fff; text-shadow: 0 0 6px rgba(255,50,50,0.4); flex-shrink: 0; }
.score-label { font-size: 13px; color: #fff; margin-left: 0; font-weight: 700; text-shadow: 0 0 6px rgba(255,50,50,0.4); }
.round-scores { display: flex; gap: 3px; margin-left: auto; flex-shrink: 0; }
.rs-badge { background: rgba(0,0,0,0.4); border: 1px solid #5a2020; border-radius: 4px; padding: 1px 5px; text-align: center; min-width: 40px; }
.rs-badge .rs-r { font-size: 11px; color: #ff6060; font-weight: 700; display: block; }
.rs-badge .rs-v { font-size: 18px; color: #ffb3b3; font-weight: 900; display: block; }

/* ë¼ìš´ë“œë³„ 1ë“± ë±ƒì§€ ê³¨ë“œ ê°•ì¡° */
.rs-badge.rs-top { border-color: #c8a000; box-shadow: 0 0 5px rgba(255,200,0,0.4); }
.rs-badge.rs-top .rs-v { color: #ffd700; text-shadow: 0 0 8px rgba(255,200,0,0.6); }



/* â”€â”€ 3ë¼ìš´ë“œ ë±ƒì§€ ì„íŒ©íŠ¸ ì´í™íŠ¸ (GPU ê°€ì†) â”€â”€ */
.rs-badge.rs-r3,
.rs-badge.rs-r5 {
  position: relative;
  will-change: transform, opacity;
  overflow: hidden;
  /* ì• ë‹ˆë©”ì´ì…˜ ì „ ê¸°ë³¸ ìƒíƒœ */
  transform: translateZ(0);
}

/* ìœ„ì¹˜/í¬ê¸°ë§Œ ë‹´ë‹¹ - transform+opacityë§Œ ì¨ì„œ compositorì—ì„œ ì²˜ë¦¬ */
@keyframes r3FlyIn {
  0%   { transform: translateX(60px) scale(1.5) translateZ(0); opacity: 0; }
  50%  { transform: translateX(-3px) scale(0.95) translateZ(0); opacity: 1; }
  70%  { transform: translateX(2px) scale(1.04) translateZ(0); }
  85%  { transform: translateX(-1px) scale(0.99) translateZ(0); }
  100% { transform: translateX(0) scale(1) translateZ(0); opacity: 1; }
}

/* ë°°ê²½/í…Œë‘ë¦¬ ë³€í™”ëŠ” ::after ë ˆì´ì–´ì—ì„œ ë”°ë¡œ ì²˜ë¦¬ */
.rs-badge.rs-r3::after,
.rs-badge.rs-r5::after {
  content: '';
  position: absolute; inset: -2px;
  border-radius: inherit;
  pointer-events: none;
  z-index: 0;
  opacity: 0;
  transition: opacity 0.1s;
}
.rs-badge.rs-r3.r3-impact::after,
.rs-badge.rs-r5.r3-impact::after {
  opacity: 1;
  background: rgba(255,60,60,0.7);
  animation: r3FlashLayer 0.75s ease forwards;
}
@keyframes r3FlashLayer {
  0%   { background: rgba(255,60,60,0.7); box-shadow: 0 0 14px 4px rgba(255,50,50,0.7); }
  30%  { background: rgba(140,0,0,0.6);   box-shadow: 0 0 9px 2px rgba(255,40,40,0.5); }
  70%  { background: rgba(60,0,0,0.45);   box-shadow: 0 0 6px 2px rgba(255,25,25,0.3); }
  100% { background: rgba(45,0,0,0.0);    box-shadow: none; opacity: 0; }
}

/* ìŠ¤ìœ• ë¼ì¸ - ::beforeë¡œ ë¶„ë¦¬ ìœ ì§€ */
.rs-badge.rs-r3.r3-impact::before,
.rs-badge.rs-r5.r3-impact::before {
  content: '';
  position: absolute; left: -10%; right: -10%; top: -2px;
  height: 110%;
  background: linear-gradient(180deg,
    transparent 0%,
    rgba(255,180,180,0.6) 48%,
    rgba(255,220,220,0.85) 50%,
    rgba(255,180,180,0.6) 52%,
    transparent 100%
  );
  transform: translateY(-100%) translateZ(0);
  animation: r3Sweep 0.3s 0.05s ease-out forwards;
  z-index: 5; pointer-events: none;
  will-change: transform;
}
@keyframes r3Sweep {
  from { transform: translateY(-100%) translateZ(0); }
  to   { transform: translateY(200%) translateZ(0); }
}

@keyframes r3TextPop {
  0%   { opacity: 0; transform: scale(0.5) translateZ(0); }
  60%  { opacity: 1; transform: scale(1.15) translateZ(0); }
  80%  { transform: scale(0.97) translateZ(0); }
  100% { transform: scale(1) translateZ(0); opacity: 1; }
}

.rs-badge.rs-r3.r3-impact,
.rs-badge.rs-r5.r3-impact {
  animation: r3FlyIn 0.48s cubic-bezier(0.22,1,0.36,1) forwards;
  border-color: #ff6060;
  transition: border-color 0.6s ease;
}
.rs-badge.rs-r3.r3-impact .rs-r,
.rs-badge.rs-r5.r3-impact .rs-r { animation: r3TextPop 0.35s 0.15s cubic-bezier(0.34,1.5,0.64,1) both; }
.rs-badge.rs-r3.r3-impact .rs-v,
.rs-badge.rs-r5.r3-impact .rs-v { animation: r3TextPop 0.38s 0.22s cubic-bezier(0.34,1.5,0.64,1) both; }

@keyframes r3Sizzle {
  0%,100% { box-shadow: 0 0 7px 2px rgba(255,25,25,0.45), inset 0 0 8px rgba(255,20,20,0.12); }
  40%     { box-shadow: 0 0 11px 3px rgba(255,50,50,0.65), inset 0 0 12px rgba(255,40,40,0.2); }
}
.rs-badge.rs-r3.r3-done,
.rs-badge.rs-r5.r3-done {
  border-color: #ff1f1f;
  background: rgba(45,0,0,0.5);
  animation: r3Sizzle 2.2s ease-in-out infinite;
}
.rs-badge.rs-r3.r3-done .rs-r,
.rs-badge.rs-r5.r3-done .rs-r { color: #ff5050; }
.rs-badge.rs-r3.r3-done .rs-v,
.rs-badge.rs-r5.r3-done .rs-v { color: #ffd5d5; text-shadow: 0 0 7px rgba(255,70,70,0.65); }

@keyframes r3BadgeHeaderIn {
  0%   { transform: scaleX(0) translateZ(0); opacity: 0; }
  55%  { transform: scaleX(1.06) translateZ(0); opacity: 1; }
  75%  { transform: scaleX(0.97) translateZ(0); }
  90%  { transform: scaleX(1.01) translateZ(0); }
  100% { transform: scaleX(1) translateZ(0); opacity: 1; }
}
#r5badge.r3-header-in {
  animation: r3BadgeHeaderIn 0.5s cubic-bezier(0.22,1,0.36,1) forwards;
  border-color: #ff6060;
  will-change: transform, opacity;
}
#r5badge.r3-header-done {
  border-color: #ff1f1f !important;
  animation: r3Sizzle 2.5s ease-in-out infinite !important;
}
#r5badge.r3-header-done .r-label { color: #ff5050; text-shadow: 0 0 8px rgba(255,50,50,0.6); }

/* â”€â”€ 5ë¼ìš´ë“œ 1ë“± ì „ìš© ì´ˆí™”ë ¤ ì´í™íŠ¸ â”€â”€ */
@keyframes r5FirstFlyIn {
  0%   { transform: translateX(80px) scale(2) translateZ(0); opacity: 0; }
  40%  { transform: translateX(-6px) scale(0.9) translateZ(0); opacity: 1; }
  60%  { transform: translateX(4px) scale(1.08) translateZ(0); }
  80%  { transform: translateX(-2px) scale(0.98) translateZ(0); }
  100% { transform: translateX(0) scale(1) translateZ(0); opacity: 1; }
}
@keyframes r5FirstGoldPulse {
  0%,100% {
    border-color: #ffd700;
    box-shadow: 0 0 10px 3px rgba(255,215,0,0.8), 0 0 25px 8px rgba(255,165,0,0.5), 0 0 50px 15px rgba(255,100,0,0.3);
  }
  50% {
    border-color: #fff7a0;
    box-shadow: 0 0 20px 6px rgba(255,240,100,1), 0 0 45px 15px rgba(255,200,0,0.8), 0 0 80px 25px rgba(255,130,0,0.5);
  }
}
@keyframes r5FirstTextShine {
  0%,100% { color: #ffd700; text-shadow: 0 0 8px rgba(255,220,0,0.8), 0 0 20px rgba(255,170,0,0.5); }
  50%     { color: #fff7a0; text-shadow: 0 0 16px rgba(255,255,150,1), 0 0 35px rgba(255,200,0,0.8), 0 0 60px rgba(255,150,0,0.4); }
}
@keyframes r5FirstBgFlash {
  0%   { background: rgba(255,220,0,0.7); box-shadow: inset 0 0 20px rgba(255,200,0,0.6); }
  40%  { background: rgba(200,150,0,0.4); box-shadow: inset 0 0 12px rgba(255,180,0,0.3); }
  100% { background: rgba(80,50,0,0.0); box-shadow: none; opacity: 0; }
}
@keyframes r5CrownSpin {
  0%   { transform: translateX(-50%) rotate(-20deg) scale(0); opacity: 0; }
  50%  { transform: translateX(-50%) rotate(10deg) scale(1.3); opacity: 1; }
  75%  { transform: translateX(-50%) rotate(-5deg) scale(1.05); }
  100% { transform: translateX(-50%) rotate(0deg) scale(1); opacity: 1; }
}
@keyframes crownParticle {
  0%   { transform: translate(-50%,-50%) scale(0) rotate(0deg); opacity: 1; }
  60%  { opacity: 1; }
  100% { transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(1) rotate(360deg); opacity: 0; }
}

/* impact ë‹¨ê³„: ë‚ ì•„ë“¤ì–´ì˜¤ë©´ì„œ í™©ê¸ˆ í­ë°œ */
.rs-badge.rs-r5-first.r5-first-impact {
  animation: r5FirstFlyIn 0.55s cubic-bezier(0.22,1,0.36,1) forwards;
  border-color: #ffd700;
  will-change: transform, opacity;
  overflow: hidden;
}
.rs-badge.rs-r5-first.r5-first-impact::after {
  content: '';
  position: absolute; inset: -2px;
  border-radius: inherit;
  pointer-events: none;
  z-index: 0;
  animation: r5FirstBgFlash 0.8s ease forwards;
  opacity: 1;
}
/* ì™•ê´€ ì•„ì´ì½˜ ë„ìš°ê¸° */
.rs-badge.rs-r5-first.r5-first-impact::before {
  content: 'ğŸ‘‘';
  position: absolute; top: -22px; left: 50%;
  font-size: 18px; line-height: 1;
  transform: translateX(-50%) scale(0);
  animation: r5CrownSpin 0.5s 0.15s cubic-bezier(0.34,1.6,0.64,1) both;
  z-index: 10; pointer-events: none;
}

/* done ë‹¨ê³„: ê³„ì† í™©ê¸ˆë¹›ìœ¼ë¡œ ì‚´ì•„ ìˆ¨ì‰¬ê¸° */
.rs-badge.rs-r5-first.r5-first-done {
  border-width: 2px;
  animation: r5FirstGoldPulse 1.8s ease-in-out infinite;
  background: rgba(60,40,0,0.55);
}
.rs-badge.rs-r5-first.r5-first-done::before {
  content: 'ğŸ‘‘';
  position: absolute; top: -18px; left: 50%;
  font-size: 16px; line-height: 1;
  transform: translateX(-50%);
  z-index: 10; pointer-events: none;
  animation: bounce 0.9s ease infinite alternate;
}
.rs-badge.rs-r5-first.r5-first-done .rs-r {
  color: #ffc400;
  text-shadow: 0 0 6px rgba(255,200,0,0.6);
}
.rs-badge.rs-r5-first.r5-first-done .rs-v {
  animation: r5FirstTextShine 1.8s ease-in-out infinite;
}
.track-wrap { position: relative; height: 18px; overflow: visible; }
.track-bg {
  position: absolute; top: 50%; transform: translateY(-50%);
  left: 0; right: 0; height: 9px;
  background: #100808; border-radius: 5px; border: 1px solid #4a1010; overflow: hidden;
}
.track-bg::after {
  content: ''; position: absolute; top: 50%; transform: translateY(-50%);
  left: 0; right: 0; height: 1px;
  background: repeating-linear-gradient(90deg, transparent, transparent 10px, rgba(255,50,50,0.12) 10px, rgba(255,50,50,0.12) 18px);
}
.track-fill {
  position: absolute; top: 0; left: 0; height: 100%; border-radius: 5px;
  transition: width 1s cubic-bezier(0.34,1.3,0.64,1); z-index: 1;
}
.fill-1 { background: linear-gradient(90deg, #c70000, #ff4444, #ff8080); box-shadow: 0 0 4px rgba(255,50,50,0.5); }
.fill-2 { background: linear-gradient(90deg, #5a6a7a, #b0bec5); }
.fill-3 { background: linear-gradient(90deg, #7a3010, #cd7f32); }
.fill-o { background: linear-gradient(90deg, #3a0808, #6b0000); }

/* â”€â”€ ì™„ì£¼ ê²Œì´ì§€ ë„¤ì˜¨ ë ˆë“œ í„ìŠ¤ â”€â”€ */
@keyframes neonRedPulse {
  0%   {
    background: linear-gradient(90deg, #aa0000, #ff0000, #ff3333, #ff0000, #aa0000);
    box-shadow:
      0 0 4px 1px rgba(255,0,0,0.85),
      0 0 8px 3px rgba(255,0,0,0.4);
  }
  50%  {
    background: linear-gradient(90deg, #ff0000, #ff4444, #ff7070, #ff4444, #ff0000);
    box-shadow:
      0 0 6px 2px rgba(255,50,50,1),
      0 0 14px 5px rgba(255,0,0,0.55),
      inset 0 0 6px rgba(255,120,120,0.3);
  }
  100% {
    background: linear-gradient(90deg, #aa0000, #ff0000, #ff3333, #ff0000, #aa0000);
    box-shadow:
      0 0 4px 1px rgba(255,0,0,0.85),
      0 0 8px 3px rgba(255,0,0,0.4);
  }
}

/* ê²Œì´ì§€ë°” ë°°ê²½ íŠ¸ë™ ë²ˆì©ì„ */
@keyframes trackBgFlash {
  0%,100% { background: #100808; }
  50% { background: #200000; box-shadow: inset 0 0 8px rgba(255,0,0,0.2); }
}

/* 1ë“± ëŸ¬ë„ˆ ì•„ì´ì½˜ ë¹¨ê°• í›„ê´‘ */
@keyframes firstRunnerAura {
  0%,100% { filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8)) drop-shadow(0 0 4px rgba(255,0,0,0.6)); }
  50%     { filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8)) drop-shadow(0 0 9px rgba(255,80,80,0.9)) drop-shadow(0 0 18px rgba(255,0,0,0.5)); }
}

/* ì™„ì£¼ ì‹œ ê²Œì´ì§€ ì„¬ê´‘ ìŠ¤ìœ• */
@keyframes gaugeFlashSweep {
  0%   { left: -20%; opacity: 0.9; }
  100% { left: 120%; opacity: 0; }
}

.fill-1.finish-glow {
  background: linear-gradient(90deg, #aa0000, #ff0000, #ff3333, #ff0000, #aa0000) !important;
  animation: neonRedPulse 1.5s ease-in-out infinite !important;
}

/* íŠ¸ë™ ë°°ê²½ ë°˜ì‘ */
.fill-1.finish-glow ~ .track-bg,
.track-wrap:has(.finish-glow) .track-bg {
  animation: trackBgFlash 0.55s ease-in-out infinite;
}

/* 1ë“± runner ì•„ì´ì½˜ ë¹¨ê°• í›„ê´‘ (is-first í´ë˜ìŠ¤ ì´ìš©) */
.runner-icon.is-first.finish-runner img {
  animation: firstRunnerAura 1.5s ease-in-out infinite !important;
}

/* ì™„ì£¼ ì‹œ íŠ¸ë™ wrap ì „ì²´ ê¸€ë¡œìš° - ì œê±° */
.track-wrap.finish-active {
  /* ê¸€ë¡œìš° ì—†ìŒ */
}

/* ì„¬ê´‘ ìŠ¤ìœ• - ì œê±° */

.finish-line { position: absolute; right: 0; top: 0; height: 100%; width: 6px; background: repeating-linear-gradient(90deg, #fff 0px, #fff 2px, #000 2px, #000 4px); border-radius: 0 5px 5px 0; opacity: 0.5; z-index: 2; }
.runner-icon {
  position: absolute; top: 50%; transform: translate(-50%, -100%);
  width: 26px; height: 26px;
  z-index: 10; pointer-events: none;
}
.runner-icon img {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scaleX(-1);
  width: 150px; height: 180px; object-fit: contain;
  image-rendering: auto;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8));
}
/* finish-runnerì¼ ë•Œ firstRunnerAura ì˜¤ë²„ë¼ì´ë“œ */
.runner-icon.is-first.finish-runner img {
  animation: firstRunnerAura 1.5s ease-in-out infinite !important;
}
.runner-icon.is-first::after {
  content: 'â­'; position: absolute; top: -8px; left: 50%;
  transform: translateX(-50%); font-size: 7px;
  animation: bounce 0.8s ease infinite alternate;
}
/* ê³¨ì¸(finish-runner)ì‹œì—” ğŸ‘‘ìœ¼ë¡œ êµì²´ + í¬ê²Œ */
.runner-icon.is-first.finish-runner::after {
  content: 'ğŸ‘‘';
  font-size: 13px;
  top: -14px;
}
@keyframes bounce { from { transform: translateX(-50%) translateY(0); } to { transform: translateX(-50%) translateY(-3px); } }

.avatar-img.frozen { opacity: 0.45; filter: drop-shadow(0 1px 4px rgba(0,0,0,0.6)) grayscale(0.6); }
.runner-icon.frozen img { opacity: 0.4; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8)) grayscale(0.6); }

.row-divider { height: 1px; background: linear-gradient(90deg, transparent, rgba(107,0,0,0.3), transparent); margin-bottom: 1px; }
/* â”€â”€ ë‘êµ¬ë‘êµ¬ ë¹Œë“œì—… ì˜¤ë²„ë ˆì´ â”€â”€ */
#drumrollOverlay {
  display: none; position: absolute; inset: 0;
  z-index: 19999; pointer-events: none;
  border-radius: 10px; overflow: hidden;
}
#drumrollOverlay.active { display: block; }

/* ë°°ê²½ ì–´ë‘  */
#drumrollBg {
  position: absolute; inset: 0;
  background: #000;
  opacity: 0;
  transition: opacity 0.4s ease;
  border-radius: 10px;
}

/* ê°€ì¥ìë¦¬ ë¹¨ê°„ ë¹„ë„¤íŠ¸ - ë‘êµ¬ë‘êµ¬ ë°•ìì— ë§ì¶° í„ìŠ¤ */
#drumrollVignette {
  position: absolute; inset: 0; border-radius: 10px;
  box-shadow: inset 0 0 0px 0px rgba(200,0,0,0);
  opacity: 0;
}
@keyframes vignetteThump {
  0%   { box-shadow: inset 0 0 40px 20px rgba(200,0,0,0.0); opacity:0; }
  10%  { box-shadow: inset 0 0 80px 40px rgba(255,30,30,0.9); opacity:1; }
  100% { box-shadow: inset 0 0 40px 20px rgba(200,0,0,0.3); opacity:0.6; }
}

/* ì¤‘ì•™ ë¬¼ìŒí‘œ / ê¸´ì¥ê° í…ìŠ¤íŠ¸ */
#drumrollText {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  z-index: 10;
  opacity: 0;
}
#drumrollQmark {
  font-size: 100px; line-height: 1;
  filter: drop-shadow(0 0 20px rgba(255,50,50,0.8));
}
@keyframes qmarkPulse {
  0%,100% { transform: scale(1);   filter: drop-shadow(0 0 10px rgba(255,50,50,0.5)); }
  50%     { transform: scale(1.12); filter: drop-shadow(0 0 30px rgba(255,80,80,1)); }
}
#drumrollLabel {
  font-family: 'Pretendard','Noto Sans KR',sans-serif;
  font-size: 32px; font-weight: 900; letter-spacing: 8px;
  color: #ffffff;
  text-shadow:
    0 0 2px rgba(255,255,255,1),
    0 0 10px rgba(255,120,120,0.9),
    0 0 24px rgba(255,50,50,0.6);
  margin-top: 8px;
  opacity: 0;
}

/* ë‘êµ¬ í”Œë˜ì‹œ */
#drumrollFlash {
  position: absolute; inset: 0; border-radius: 10px;
  background: radial-gradient(circle at 50% 50%, rgba(255,50,50,0.6) 0%, transparent 70%);
  opacity: 0; pointer-events: none;
}
@keyframes drumFlash {
  0%   { opacity: 0.8; }
  100% { opacity: 0; }
}

/* ë‘êµ¬ë‘êµ¬ ì§„í–‰ ë°” */
#drumrollBar {
  position: absolute; bottom: 20px; left: 10%; right: 10%;
  height: 4px; border-radius: 2px;
  background: rgba(255,255,255,0.1);
  overflow: hidden; opacity: 0;
}
#drumrollBarFill {
  height: 100%; width: 0%;
  background: linear-gradient(90deg, #ff2222, #ff8888, #ffffff);
  box-shadow: 0 0 8px rgba(255,50,50,0.8);
  transition: width 0.1s linear;
  border-radius: 2px;
}

/* ìš°ìŠ¹ì ê³µê°œ í­ë°œ */
@keyframes revealPop {
  0%   { transform: translate(-50%,-50%) scale(0) rotate(-15deg); opacity:0; filter: brightness(4); }
  50%  { transform: translate(-50%,-50%) scale(1.1) rotate(3deg);  opacity:1; filter: brightness(2); }
  70%  { transform: translate(-50%,-50%) scale(0.96) rotate(-1deg); filter: brightness(1.3); }
  100% { transform: translate(-50%,-50%) scale(1) rotate(0deg);   opacity:1; filter: brightness(1); }
}

#celebOverlay {
  display: none; position: absolute; inset: 0;
  pointer-events: none; z-index: 9999; overflow: visible; border-radius: 10px;
}
#celebOverlay.active { display: block; }
#celebOverlay::before { content: ''; position: absolute; inset: 0; background: rgba(0,0,0,0.6); border-radius: 10px; }
.celeb-box {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  display: flex; flex-direction: column; align-items: center; gap: 4px; z-index: 10001;
  width: 100%; padding: 0 10px;
  animation: boxPop 0.5s cubic-bezier(0.34,1.6,0.64,1) both;
  max-height: 100%; overflow: visible;
}
@keyframes boxPop { from { transform: translate(-50%,-50%) scale(0.3) rotate(-8deg); opacity:0; } to { transform: translate(-50%,-50%) scale(1) rotate(0deg); opacity:1; } }
@keyframes winnerGlow {
  0%   { box-shadow: 0 0 20px rgba(255,50,50,0.9), 0 0 50px rgba(200,0,0,0.5), 0 0 0px rgba(255,100,100,0); border-color: #ff4444; }
  50%  { box-shadow: 0 0 40px rgba(255,80,80,1), 0 0 80px rgba(220,0,0,0.9), 0 0 120px rgba(255,100,100,0.6); border-color: #ffffff; }
  100% { box-shadow: 0 0 20px rgba(255,50,50,0.9), 0 0 50px rgba(200,0,0,0.5), 0 0 0px rgba(255,100,100,0); border-color: #ff4444; }
}
.celeb-char-wrap {
  position: relative;
  width: min(480px, 70%);
  flex-shrink: 1;
  border-radius: 12px;
}
.celeb-char {
  width: 100%; height: auto; aspect-ratio: 1/1; object-fit: contain; border-radius: 12px;
  transform: scaleX(-1);
  border: 4px solid #ff4444;
  image-rendering: auto;
  animation: winnerGlow 1.2s ease-in-out infinite;
  display: block;
}
.celeb-name {
  position: absolute; bottom: 6%; left: 0; right: 0;
  font-size: clamp(18px, 4vw, 36px); font-weight: 900; color: #ffffff;
  letter-spacing: 4px; white-space: nowrap; text-align: center;
  padding: 10px;
  background: none;
  border-radius: 0;
  text-shadow:
    0 0 2px #ffffff,
    0 0 14px rgba(255,150,150,0.9),
    0 0 32px rgba(255,80,80,0.7),
    3px 3px 0 rgba(0,0,0,0.9);
  animation: nameGlow 1.4s ease-in-out infinite;
  z-index: 5;
}
/* ì´ë¦„ ìœ„ì•„ë˜ ì¥ì‹ì„  ì œê±°ë¨ */
.celeb-title {
  position: absolute; bottom: calc(12% + 1.6em); left: 0; right: 0;
  font-size: clamp(16px, 3.5vw, 28px); font-weight: 800; color: #ffffff;
  text-align: center; white-space: nowrap;
  text-shadow:
    0 0 2px rgba(255,255,255,1),
    0 0 10px rgba(255,120,120,0.9),
    0 0 24px rgba(255,50,50,0.7),
    2px 2px 0 #7a0000, 4px 4px 0 rgba(0,0,0,0.5);
  letter-spacing: 4px;
  z-index: 5;
}
@keyframes nameGlow {
  0%,100% {
    text-shadow:
      0 0 2px #ffffff,
      0 0 14px rgba(255,150,150,0.9),
      0 0 32px rgba(255,80,80,0.7),
      0 0 60px rgba(200,0,0,0.4),
      3px 3px 0 rgba(0,0,0,0.9);
  }
  50% {
    text-shadow:
      0 0 4px #ffffff,
      0 0 20px rgba(255,180,180,1),
      0 0 45px rgba(255,100,100,0.8),
      0 0 80px rgba(220,0,0,0.5),
      3px 3px 0 rgba(0,0,0,0.9);
  }
}
.particle { position: absolute; pointer-events: none; z-index: 10000; }
@keyframes orbitFlyOut {
  0%   { opacity:1; transform: translate(-50%,-50%) scale(1); }
  30%  { opacity:1; }
  100% { opacity:0; transform: translate(calc(-50% + var(--fx)), calc(-50% + var(--fy))) rotate(var(--fr)) scale(0.1); }
}
@keyframes flyAway {
  0%   { transform: translate(0, 0px) rotate(0deg) scale(0.5); opacity:0; }
  14%  { transform: translate(0, -8px) rotate(0deg) scale(1.06); opacity:1; }
  20%  { transform: translate(0, 3px) rotate(0deg) scale(0.97); opacity:1; }
  26%  { transform: translate(0, 0px) rotate(0deg) scale(1); opacity:1; }
  /* â”€â”€ ë§Œë½ êµ¬ê°„ â”€â”€ */
  56%  { transform: translate(0, -4px) rotate(calc(var(--fr)*0.04)) scale(1.01); opacity:1; }
  60%  { transform: translate(0, 4px) rotate(calc(var(--fr)*0.08)) scale(1.03); opacity:1; }
  /* â”€â”€ ìœ„ë¡œ ë‚ ì•„ê°€ê¸° â”€â”€ */
  100% { transform: translate(var(--fx), var(--fy)) rotate(var(--fr)) scale(0.12); opacity:0; }
}
.fly-char {
  position: absolute; pointer-events: none; z-index: 10002;
  opacity: 0; /* delay ì¤‘ ìˆ¨ê¹€ */
  animation: flyAway var(--fd) cubic-bezier(0.25,0.1,0.35,1) both;
}
.firework { width: 6px; height: 6px; border-radius: 50%; animation: fwExplode var(--dur) ease-out forwards; }
@keyframes fwExplode { 0% { transform: translate(0,0) scale(1); opacity:1; } 100% { transform: translate(var(--tx),var(--ty)) scale(0); opacity:0; } }
.meso { font-size: 16px; animation: mesoFall var(--dur) ease-in forwards; line-height: 1; }
@keyframes mesoFall { 0% { transform: translateY(0) rotate(0deg) scale(1); opacity:1; } 80% { opacity:1; } 100% { transform: translateY(var(--fall)) rotate(var(--rot)) scale(0.5); opacity:0; } }
.sparkle { font-size: 12px; animation: sparkleFly var(--dur) ease-out forwards; }
@keyframes sparkleFly { 0% { transform: translate(0,0) scale(0) rotate(0deg); opacity:1; } 50% { transform: translate(var(--mx),var(--my)) scale(1.2) rotate(180deg); opacity:1; } 100% { transform: translate(calc(var(--mx)*1.5),calc(var(--my)*1.5 + 30px)) scale(0) rotate(360deg); opacity:0; } }
.footer {
  position: relative; z-index: 1;
  display: flex; align-items: center; justify-content: flex-end;
  padding: 1px 10px 2px; gap: 4px;
}
.live-dot { width: 6px; height: 6px; border-radius: 50%; background: #ff4040; box-shadow: 0 0 6px rgba(255,60,60,0.9); animation: pulse 1.5s ease infinite; }
@keyframes pulse { 0%,100% { opacity:1; transform:scale(1); } 50% { opacity:0.5; transform:scale(0.8); } }
.live-text { font-size: 11px; color: #ff4040; font-weight: 900; letter-spacing: 2px; }
.empty { padding: 14px; text-align: center; color: #6b0000; font-size: 12px; }
#bgCrackCanvas {
  position: absolute; inset: 0; z-index: 0;
  pointer-events: none; border-radius: 10px;
  opacity: 0; transition: opacity 1.2s ease;
}
#bgCrackCanvas.visible { opacity: 1; }

/* ==============================
   ì™„ì£¼ ê²Œì´ì§€ í’€ìƒ· ì»·ì”¬
============================== */
#finishGaugeOverlay {
  display: none;
  position: absolute; inset: 0;
  z-index: 18000;
  pointer-events: none;
  border-radius: 10px;
  overflow: hidden;
  background: rgba(0,0,0,0.82);
}
#finishGaugeOverlay.active { display: block; }

#fgoInner {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  width: 96%;
  opacity: 0;
  transition: opacity 0.35s ease;
  overflow: visible;
}
#finishGaugeOverlay.active #fgoInner { opacity: 1; }

/* ìƒë‹¨ ë¼ë²¨ */
/* â”€â”€ ê³¨ë“œ íŠ¸ë¡œí”¼ ë°°ë„ˆ shimmer â”€â”€ */
@keyframes goldShimmer {
  0%   { background-position: -300% center; }
  100% { background-position: 300% center; }
}
@keyframes bannerLineGlow {
  0%,100% { opacity: 0.5; box-shadow: 0 0 4px rgba(255,200,0,0.3); }
  50%     { opacity: 1;   box-shadow: 0 0 10px rgba(255,220,0,0.7); }
}
@keyframes crownBob {
  0%,100% { transform: translateY(0) scale(1); }
  50%     { transform: translateY(-2px) scale(1.08); }
}

#fgoEventTitle {
  text-align: center;
  margin-bottom: 6px;
  opacity: 0;
  transition: opacity 0.4s ease 0.1s;
}
#finishGaugeOverlay.active #fgoEventTitle { opacity: 1; }

.fgo-banner-wrap {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
.fgo-banner-line {
  flex: 1;
  height: 2px;
  max-width: 60px;
  background: linear-gradient(90deg, transparent, #ffd700, #fff8a0, #ffd700, transparent);
  border-radius: 2px;
  animation: bannerLineGlow 2s ease-in-out infinite;
}
.fgo-banner-line.right {
  background: linear-gradient(270deg, transparent, #ffd700, #fff8a0, #ffd700, transparent);
}
.fgo-banner-crown {
  font-size: 16px;
  animation: crownBob 1.4s ease-in-out infinite;
  filter: drop-shadow(0 0 6px rgba(255,200,0,0.8));
}
.fgo-banner-text {
  font-family: 'Pretendard','Noto Sans KR',sans-serif;
  font-size: 15px;
  font-weight: 900;
  letter-spacing: 4px;
  white-space: nowrap;
  background: linear-gradient(90deg,
    #b8860b 0%, #ffd700 20%, #fff8a0 35%, #ffd700 50%,
    #fff8a0 65%, #ffd700 80%, #b8860b 100%
  );
  background-size: 300% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: goldShimmer 3s linear infinite;
  filter: drop-shadow(0 0 8px rgba(255,200,0,0.5));
}

#fgoTitle {
  text-align: center;
  font-family: 'Pretendard','Noto Sans KR',sans-serif;
  font-size: 22px; font-weight: 900; letter-spacing: 5px;
  color: #ffd700;
  text-shadow: 0 0 12px rgba(255,200,0,0.9), 0 0 24px rgba(255,150,0,0.6);
  margin-bottom: 6px;
  opacity: 0;
  transition: opacity 0.3s ease 0.2s;
}
#finishGaugeOverlay.active #fgoTitle { opacity: 1; }

/* ë¼ìš´ë“œ ë‹¨ê³„ ë¼ë²¨ - ë¯¸ì‚¬ìš© */
#fgoRoundLabel { display: none; }

#fgoAllRaces {
  display: flex;
  flex-direction: column;
  gap: 5px;
  overflow: visible;
  padding-top: 10px;
}

/* ë¼ìš´ë“œ êµ¬ë¶„ì„  ë§ˆì»¤ */
.fgo-round-marker {
  position: absolute;
  top: 50%;
  transform: translate(-50%, -50%);
  font-size: 12px;
  line-height: 1;
  z-index: 5;
  pointer-events: none;
  filter: drop-shadow(0 0 3px rgba(0,0,0,0.9));
}
/* ê²°ìŠ¹ì„  */
.fgo-finish-line {
  position: absolute;
  right: 0; top: 0; bottom: 0;
  width: 5px;
  background: repeating-linear-gradient(180deg, #fff 0px, #fff 3px, #000 3px, #000 6px);
  border-radius: 0 4px 4px 0;
  opacity: 0.7;
  z-index: 4;
}

/* ì™•ê´€ ê³¨ì¸ ì• ë‹ˆë©”ì´ì…˜ */
@keyframes crownBounceIn {
  0%   { transform: translateX(-50%) translateY(-20px) scale(0) rotate(-30deg); opacity: 0; }
  50%  { transform: translateX(-50%) translateY(2px) scale(1.3) rotate(10deg); opacity: 1; }
  70%  { transform: translateX(-50%) translateY(-4px) scale(0.95) rotate(-5deg); }
  85%  { transform: translateX(-50%) translateY(1px) scale(1.05) rotate(2deg); }
  100% { transform: translateX(-50%) translateY(0) scale(1) rotate(0deg); opacity: 1; }
}
@keyframes crownFloat {
  0%,100% { transform: translateX(-50%) translateY(0); }
  50%     { transform: translateX(-50%) translateY(-5px); }
}

#hiddenCutscene {
  display: none;
  position: absolute;
  inset: 0;
  z-index: 99999;
  pointer-events: none;
  overflow: hidden;
  border-radius: 10px;
}
#hiddenCutscene.active {
  display: block;
}

/* ì–´ë‘  ë°°ê²½ */
.cs-backdrop {
  position: absolute; inset: 0;
  background: #000;
  opacity: 0;
  transition: opacity 0.4s ease;
}
#hiddenCutscene.active .cs-backdrop {
  opacity: 1;
}

/* ì˜í™” letterbox ë°” */
.cs-bar-top, .cs-bar-bottom {
  position: absolute; left: 0; right: 0;
  background: #000;
  height: 0;
  transition: height 0.5s cubic-bezier(0.77,0,0.18,1);
  z-index: 2;
}
.cs-bar-top { top: 0; }
.cs-bar-bottom { bottom: 0; }
#hiddenCutscene.bars-in .cs-bar-top,
#hiddenCutscene.bars-in .cs-bar-bottom {
  height: 18vh;
}

/* ê· ì—´ SVG ë ˆì´ì–´ */
.cs-cracks {
  position: absolute; inset: 0;
  z-index: 3;
  opacity: 0;
}
.cs-cracks.show {
  animation: crackReveal 0.6s ease-out forwards;
}
@keyframes crackReveal {
  0%   { opacity: 0; filter: brightness(3); }
  30%  { opacity: 1; filter: brightness(2); }
  100% { opacity: 1; filter: brightness(1); }
}
@keyframes crackShake1 {
  0%,100% { transform: translate(0,0) rotate(0deg); }
  20%  { transform: translate(-3px, 2px) rotate(-0.3deg); }
  40%  { transform: translate(3px,-2px) rotate( 0.4deg); }
  60%  { transform: translate(-2px, 1px) rotate(-0.2deg); }
  80%  { transform: translate(2px,-1px) rotate( 0.2deg); }
}
@keyframes crackShake2 {
  0%,100% { transform: translate(0,0) rotate(0deg); }
  15%  { transform: translate(-4px, 3px) rotate(-0.5deg); }
  30%  { transform: translate(4px,-3px) rotate( 0.6deg); }
  50%  { transform: translate(-3px, 2px) rotate(-0.4deg); }
  70%  { transform: translate(3px,-2px) rotate( 0.4deg); }
  85%  { transform: translate(-1px, 1px) rotate(-0.1deg); }
}
@keyframes crackShake3 {
  0%,100% { transform: translate(0,0) rotate(0deg); }
  10%  { transform: translate(-6px, 4px) rotate(-0.8deg); }
  25%  { transform: translate(6px,-4px) rotate( 0.9deg); }
  40%  { transform: translate(-5px, 3px) rotate(-0.6deg); }
  55%  { transform: translate(5px,-3px) rotate( 0.7deg); }
  70%  { transform: translate(-3px, 2px) rotate(-0.3deg); }
  85%  { transform: translate(2px,-1px) rotate( 0.2deg); }
}
.cs-cracks.crack-shake1 { animation: crackShake1 0.35s ease forwards; }
.cs-cracks.crack-shake2 { animation: crackShake2 0.45s ease forwards; }
.cs-cracks.crack-shake3 { animation: crackShake3 0.55s ease forwards; }

/* ê²½ê³  ë¹„í”„ ë¼ì¸ */
.cs-scanline {
  position: absolute; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, transparent, #ff2222, #ff8888, #ff2222, transparent);
  box-shadow: 0 0 12px rgba(255,30,30,0.8);
  top: 50%;
  opacity: 0;
  z-index: 4;
  transform: scaleX(0);
}
.cs-scanline.show {
  animation: scanlineExpand 0.5s 0.1s cubic-bezier(0.22,1,0.36,1) forwards;
}
@keyframes scanlineExpand {
  0%   { opacity:1; transform: scaleX(0); }
  70%  { opacity:1; transform: scaleX(1.05); }
  100% { opacity:0.7; transform: scaleX(1); }
}

/* ë©”ì¸ ì»¨í…ì¸  ë°•ìŠ¤ */
.cs-content {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%) scale(0.95);
  z-index: 10;
  display: flex; flex-direction: column; align-items: center; gap: 12px;
  width: 100%;
  opacity: 0;
  pointer-events: none;
}

/* ??? í…ìŠ¤íŠ¸ -> 3ë¼ìš´ë“œ ì „í™˜ */
.cs-mystery {
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: 20px; font-weight: 900; letter-spacing: 8px;
  color: #ff3333;
  text-shadow: 0 0 20px rgba(255,50,50,1), 0 0 40px rgba(255,0,0,0.6);
  text-transform: uppercase;
  position: relative;
}

.cs-title-wrap {
  position: relative; display: flex; align-items: center; justify-content: center;
}

/* ë©”ì¸ íƒ€ì´í‹€ */
.cs-main-title {
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: clamp(30px, 7vw, 56px);
  font-weight: 900;
  color: #fff;
  letter-spacing: 6px;
  line-height: 1;
  text-align: center;
  opacity: 0;
  clip-path: inset(0 100% 0 0);
}
.cs-main-title.reveal {
  animation: titleWipe 0.8s 0.1s cubic-bezier(0.77,0,0.18,1) forwards;
}
@keyframes titleWipe {
  0%   { opacity:1; clip-path: inset(0 100% 0 0); }
  100% { opacity:1; clip-path: inset(0 0% 0 0); }
}

/* ê¸€ë¡œìš° ê°•ì¡° */
.cs-main-title span.highlight {
  color: #ff3333;
  text-shadow:
    0 0 10px rgba(255,50,50,1),
    0 0 30px rgba(255,0,0,0.9),
    0 0 60px rgba(200,0,0,0.6),
    2px 2px 0 #7a0000;
}

/* â”€â”€ ê¸€ìë³„ ë¶ˆê½ƒ ì†Œí™˜ ì´í™íŠ¸ â”€â”€ */
.cs-char-wrap {
  display: inline-flex; align-items: flex-end; justify-content: center;
  gap: 2px; flex-wrap: nowrap;
}

.cs-char {
  display: inline-block;
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: clamp(28px, 6.5vw, 52px);
  font-weight: 900;
  line-height: 1;
  opacity: 0;
  will-change: transform, opacity;
}

/* ì¼ë°˜ ê¸€ì: í°ìƒ‰ */
.cs-char.white {
  color: #fff;
  text-shadow: 0 0 10px rgba(255,255,255,0.4);
}

/* ê°•ì¡° ê¸€ì(3ë¼ìš´ë“œê³µê°œ): í°ìƒ‰ ê¸€ì + ë¹¨ê°„ ê¸€ë¡œìš° */
.cs-char.fire {
  color: #ffffff;
  text-shadow:
    0 0 2px rgba(255,255,255,1),
    0 0 8px rgba(255,100,100,0.9),
    0 0 20px rgba(255,50,50,0.7),
    0 0 40px rgba(200,0,0,0.4);
}
/* ì•ˆì°© í›„ ì‚´ì•„ìˆëŠ” í„ìŠ¤ */
@keyframes firePulse {
  0%,100% {
    color: #ffffff;
    text-shadow:
      0 0 2px rgba(255,255,255,1),
      0 0 8px rgba(255,100,100,0.9),
      0 0 22px rgba(255,50,50,0.7),
      0 0 42px rgba(200,0,0,0.4);
  }
  50% {
    color: #ffffff;
    text-shadow:
      0 0 4px rgba(255,255,255,1),
      0 0 14px rgba(255,130,130,1),
      0 0 32px rgba(255,70,70,0.8),
      0 0 58px rgba(220,0,0,0.5);
  }
}

/* ì†Ÿêµ¬ì¹˜ë©° ë“±ì¥ */
@keyframes charRise {
  0%   {
    opacity: 0;
    transform: translateY(40px) rotate(var(--tilt)) scale(0.3);
  }
  35%  {
    opacity: 1;
    transform: translateY(-10px) rotate(calc(var(--tilt) * -0.4)) scale(1.25);
  }
  55%  {
    transform: translateY(4px) rotate(calc(var(--tilt) * 0.1)) scale(0.95);
  }
  72%  {
    transform: translateY(-3px) scale(1.05);
  }
  88%  { transform: translateY(1px) scale(0.99); }
  100% { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; }
}

/* ê°•ì¡° ê¸€ìëŠ” ë” í™”ëˆí•˜ê²Œ ì¶”ê°€ ì”ê´‘ */
@keyframes charFireSettle {
  0%   { color: #ffffff; text-shadow: 0 0 20px #ffffff, 0 0 40px #ff4444, 0 0 80px rgba(255,50,50,0.6); }
  40%  { color: #ffffff; text-shadow: 0 0 8px #ffffff, 0 0 18px rgba(255,100,100,0.9), 0 0 36px rgba(200,0,0,0.5); }
  100% { color: #ffffff; text-shadow: 0 0 2px rgba(255,255,255,1), 0 0 8px rgba(255,100,100,0.9), 0 0 20px rgba(255,50,50,0.7), 0 0 40px rgba(200,0,0,0.4); }
}

.cs-char.fire.risen {
  animation: charFireSettle 0.6s ease forwards, firePulse 1.6s 0.6s ease-in-out infinite;
}

/* ë¶ˆì”¨ íŒŒí‹°í´ (CSS only, ::after pseudo) */
.cs-char.fire::after {
  content: '';
  position: absolute;
  bottom: 0; left: 50%;
  width: 4px; height: 4px;
  background: #ff6600;
  border-radius: 50%;
  transform: translateX(-50%) translateY(0);
  opacity: 0;
  pointer-events: none;
}
.cs-char.fire.sparking::after {
  animation: emberFloat 0.6s ease-out forwards;
}
@keyframes emberFloat {
  0%   { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
  100% { opacity: 0; transform: translateX(calc(-50% + var(--ex,0px))) translateY(-30px) scale(0.2); }
}

/* ì„œë¸Œ ì„¤ëª… */
.cs-subtitle {
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: 30px; font-weight: 700; letter-spacing: 4px;
  color: #ffffff;
  text-shadow:
    0 0 2px rgba(255,255,255,1),
    0 0 10px rgba(255,120,120,0.9),
    0 0 22px rgba(255,50,50,0.5);
  opacity: 0;
  transform: translateY(6px);
}

/* íƒ€ì´í•‘ ì»¤ì„œ */
.cs-cursor {
  display: inline-block;
  width: 2px; height: 1em; vertical-align: middle;
  background: #ff3333;
  animation: blink 0.6s step-end infinite;
  margin-left: 2px;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }

/* ë¹› í­ë°œ */
.cs-burst {
  position: absolute; inset: 0;
  z-index: 5;
  pointer-events: none;
  opacity: 0;
}
.cs-burst.explode {
  animation: burstFlash 0.7s ease-out forwards;
}
@keyframes burstFlash {
  0%   { opacity:1; background: radial-gradient(circle at 50% 50%, rgba(255,80,80,0.95) 0%, rgba(200,0,0,0.7) 30%, transparent 70%); }
  40%  { opacity:0.6; }
  100% { opacity:0; background: radial-gradient(circle at 50% 50%, transparent 0%, transparent 100%); }
}

/* ìˆ˜í‰ ë¹” */
.cs-beams {
  position: absolute; inset: 0; z-index: 6; pointer-events: none; overflow: hidden;
}
.cs-beam {
  position: absolute; top: 50%; left: 50%;
  width: 120%; height: 2px;
  background: linear-gradient(90deg, transparent, rgba(255,80,80,0.9), rgba(255,200,200,1), rgba(255,80,80,0.9), transparent);
  transform-origin: center;
  opacity: 0;
}
.cs-beam.shoot {
  animation: beamShoot 0.6s ease-out forwards;
}
@keyframes beamShoot {
  0%   { opacity:1; transform: translate(-50%, -50%) scaleX(0) rotate(var(--angle)); }
  60%  { opacity:0.8; transform: translate(-50%, -50%) scaleX(1) rotate(var(--angle)); }
  100% { opacity:0; transform: translate(-50%, -50%) scaleX(1.2) rotate(var(--angle)); }
}

/* íŒŒí‹°í´ ë³„ */
.cs-star {
  position: absolute; z-index: 8;
  font-size: 16px;
  pointer-events: none;
  animation: starFly var(--dur) ease-out forwards;
}
@keyframes starFly {
  0%   { opacity:1; transform: translate(0,0) scale(0) rotate(0deg); }
  30%  { opacity:1; transform: translate(var(--sx), var(--sy)) scale(1.4) rotate(180deg); }
  100% { opacity:0; transform: translate(calc(var(--sx)*1.8), calc(var(--sy)*1.8 + 40px)) scale(0) rotate(360deg); }
}

/* ê¸€ë¦¬ì¹˜ íš¨ê³¼ */
@keyframes glitch1 {
  0%,100% { clip-path: inset(0 0 95% 0); transform: translate(-2px, 0); }
  50%      { clip-path: inset(30% 0 50% 0); transform: translate(2px, 0); }
}
@keyframes glitch2 {
  0%,100% { clip-path: inset(60% 0 10% 0); transform: translate(2px, 0); }
  50%      { clip-path: inset(80% 0 5% 0); transform: translate(-2px, 0); }
}
.cs-glitch {
  position: relative;
}
.cs-glitch::before,
.cs-glitch::after {
  content: attr(data-text);
  position: absolute; top: 0; left: 0; width: 100%;
  opacity: 0;
}
.cs-glitch.glitching::before {
  color: #ff0040; opacity: 0.7;
  animation: glitch1 0.15s steps(2) 3;
}
.cs-glitch.glitching::after {
  color: #00ffff; opacity: 0.4;
  animation: glitch2 0.15s steps(2) 3;
}

/* ì ê¸ˆí•´ì œ ì•„ì´ì½˜ */
.cs-lock-icon {
  font-size: 40px;
  display: block;
  animation: lockShake 0.5s ease forwards;
  opacity: 0;
}
.cs-lock-icon.show {
  opacity: 1;
}
@keyframes lockShake {
  0%   { transform: scale(0) rotate(-30deg); opacity:0; }
  50%  { transform: scale(1.3) rotate(10deg); opacity:1; }
  70%  { transform: scale(0.9) rotate(-5deg); }
  100% { transform: scale(1) rotate(0deg); opacity:1; }
}

/* ê²½ê³  í…ìŠ¤íŠ¸ íƒ€ì´í•‘ */
.cs-warning {
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: 20px; font-weight: 700; letter-spacing: 3px;
  color: #ff6666; opacity: 0;
  text-transform: uppercase;
}
.cs-warning.show {
  animation: warnFade 0.3s ease forwards;
}
@keyframes warnFade { to { opacity:0.7; } }

/* íˆë“  ë±ƒì§€ */
.cs-hidden-badge {
  background: linear-gradient(135deg, #2a0000, #5a0000);
  border: 2px solid #ff3333;
  border-radius: 8px;
  padding: 6px 24px;
  box-shadow: 0 0 20px rgba(255,50,50,0.5), inset 0 1px 0 rgba(255,100,100,0.2);
  opacity: 0;
}
.cs-hidden-badge.show {
  animation: badgePop 0.5s 0.8s cubic-bezier(0.34,1.6,0.64,1) forwards;
}
@keyframes badgePop {
  from { opacity:0; transform: scale(0.5) rotate(-5deg); }
  to   { opacity:1; transform: scale(1) rotate(0deg); }
}
.cs-hidden-badge-text {
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: 20px; font-weight: 900; letter-spacing: 5px;
  color: #ffaaaa;
  text-shadow: 0 0 8px rgba(255,100,100,0.8);
}

/* í™”ë©´ ì§„ë™ */
@keyframes screenShake {
  0%   { transform: translate(0px, 0px); }
  8%   { transform: translate(-20px, -10px); }
  16%  { transform: translate( 20px,  10px); }
  24%  { transform: translate(-18px,  14px); }
  32%  { transform: translate( 18px, -14px); }
  40%  { transform: translate(-15px,  10px); }
  48%  { transform: translate( 15px, -10px); }
  56%  { transform: translate(-10px,   8px); }
  64%  { transform: translate( 10px,  -8px); }
  72%  { transform: translate(-6px,   5px); }
  80%  { transform: translate( 6px,  -4px); }
  88%  { transform: translate(-3px,   2px); }
  100% { transform: translate(0px, 0px); }
}
@keyframes screenShakeBig {
  0%   { transform: translate(0px, 0px); }
  7%   { transform: translate(-30px, -16px); }
  14%  { transform: translate( 30px,  16px); }
  21%  { transform: translate(-26px,  20px); }
  28%  { transform: translate( 26px, -20px); }
  35%  { transform: translate(-20px,  14px); }
  42%  { transform: translate( 20px, -14px); }
  50%  { transform: translate(-14px,  10px); }
  58%  { transform: translate( 14px, -10px); }
  66%  { transform: translate(-8px,   6px); }
  74%  { transform: translate( 8px,  -5px); }
  82%  { transform: translate(-4px,   3px); }
  91%  { transform: translate( 2px,  -2px); }
  100% { transform: translate(0px, 0px); }
}
/* cs-content ì „ìš© - translate(-50%,-50%) ìœ ì§€í•˜ë©´ì„œ í”ë“¤ê¸° */
@keyframes screenShakeCenter {
  0%   { transform: translate(-50%, -50%) translate(0px, 0px); }
  8%   { transform: translate(-50%, -50%) translate(-20px, -10px); }
  16%  { transform: translate(-50%, -50%) translate( 20px,  10px); }
  24%  { transform: translate(-50%, -50%) translate(-18px,  14px); }
  32%  { transform: translate(-50%, -50%) translate( 18px, -14px); }
  40%  { transform: translate(-50%, -50%) translate(-15px,  10px); }
  48%  { transform: translate(-50%, -50%) translate( 15px, -10px); }
  56%  { transform: translate(-50%, -50%) translate(-10px,   8px); }
  64%  { transform: translate(-50%, -50%) translate( 10px,  -8px); }
  72%  { transform: translate(-50%, -50%) translate(-6px,   5px); }
  80%  { transform: translate(-50%, -50%) translate( 6px,  -4px); }
  88%  { transform: translate(-50%, -50%) translate(-3px,   2px); }
  100% { transform: translate(-50%, -50%) translate(0px, 0px); }
}
@keyframes screenShakeBigCenter {
  0%   { transform: translate(-50%, -50%) translate(0px, 0px); }
  7%   { transform: translate(-50%, -50%) translate(-30px, -16px); }
  14%  { transform: translate(-50%, -50%) translate( 30px,  16px); }
  21%  { transform: translate(-50%, -50%) translate(-26px,  20px); }
  28%  { transform: translate(-50%, -50%) translate( 26px, -20px); }
  35%  { transform: translate(-50%, -50%) translate(-20px,  14px); }
  42%  { transform: translate(-50%, -50%) translate( 20px, -14px); }
  50%  { transform: translate(-50%, -50%) translate(-14px,  10px); }
  58%  { transform: translate(-50%, -50%) translate( 14px, -10px); }
  66%  { transform: translate(-50%, -50%) translate(-8px,   6px); }
  74%  { transform: translate(-50%, -50%) translate( 8px,  -5px); }
  82%  { transform: translate(-50%, -50%) translate(-4px,   3px); }
  91%  { transform: translate(-50%, -50%) translate( 2px,  -2px); }
  100% { transform: translate(-50%, -50%) translate(0px, 0px); }
}


/* â”€â”€ ì¹´ìš´íŠ¸ë‹¤ìš´ â”€â”€ */
.cs-countdown {
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%,-50%);
  z-index: 15; pointer-events: none;
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: 120px; font-weight: 900;
  color: #fff; line-height: 1;
  opacity: 0;
  will-change: transform, opacity, filter;
}
@keyframes countPunch {
  0%   { transform: translate(-50%,-50%) scale(3); opacity:0; filter: blur(8px) brightness(4); }
  20%  { transform: translate(-50%,-50%) scale(0.85); opacity:1; filter: blur(0) brightness(2.5); }
  45%  { transform: translate(-50%,-50%) scale(1.08); filter: brightness(1.5); }
  65%  { transform: translate(-50%,-50%) scale(0.97); }
  80%  { transform: translate(-50%,-50%) scale(1.01); filter: brightness(1); }
  100% { transform: translate(-50%,-50%) scale(1); opacity:1; }
}
@keyframes countFade {
  0%   { opacity:1; }
  60%  { opacity:1; transform: translate(-50%,-50%) scale(1); }
  100% { opacity:0; transform: translate(-50%,-50%) scale(0.6); filter: blur(4px); }
}

/* â”€â”€ ê²½ê³ ë“± í”Œë˜ì‹œ (ì¢Œìš° ìŠ¤ìº”) â”€â”€ */
.cs-alert-left, .cs-alert-right {
  position: absolute; top: 0; bottom: 0; width: 60px;
  z-index: 2; pointer-events: none; opacity: 0;
}
.cs-alert-left  { left: 0;  background: linear-gradient(90deg, rgba(255,30,30,0.6), transparent); }
.cs-alert-right { right: 0; background: linear-gradient(270deg, rgba(255,30,30,0.6), transparent); }
.cs-alert-top, .cs-alert-bottom {
  position: absolute; left: 0; right: 0; height: 60px;
  z-index: 2; pointer-events: none; opacity: 0;
}
.cs-alert-top    { top: 0;    background: linear-gradient(180deg, rgba(255,30,30,0.6), transparent); }
.cs-alert-bottom { bottom: 0; background: linear-gradient(0deg,   rgba(255,30,30,0.6), transparent); }
@keyframes alertPulse {
  0%,100% { opacity: 0; }
  10%,90% { opacity: 0.9; }
  50%     { opacity: 0.4; }
}

/* â”€â”€ ë°°ê²½ ë¶ˆê½ƒ íŒŒí‹°í´ â”€â”€ */
.cs-ember {
  position: absolute; pointer-events: none; z-index: 2;
  width: var(--ew); height: var(--ew);
  background: radial-gradient(circle, #ff6600, #ff2200);
  border-radius: 50%;
  bottom: -10px; left: var(--ex);
  opacity: 0;
  animation: emberRise var(--ed) ease-in var(--delay) infinite;
}
@keyframes emberRise {
  0%   { transform: translateY(0) translateX(0) scale(1); opacity:0.9; }
  30%  { opacity: 0.8; }
  70%  { transform: translateY(var(--eh)) translateX(var(--esx)) scale(0.6); opacity:0.4; }
  100% { transform: translateY(calc(var(--eh) * 1.5)) translateX(calc(var(--esx) * 1.3)) scale(0.1); opacity:0; }
}

/* â”€â”€ ë¹„ë„¤íŠ¸ (ê°€ì¥ìë¦¬ ë¶ˆê½ƒ) â”€â”€ */
.cs-vignette {
  position: absolute; inset: 0; z-index: 3; pointer-events: none;
  border-radius: 10px; opacity: 0;
  box-shadow: inset 0 0 60px 20px rgba(200,0,0,0.7), inset 0 0 120px 40px rgba(150,0,0,0.5);
}
@keyframes vignetteIn {
  0%   { opacity:0; }
  40%  { opacity:1; }
  70%  { opacity:0.7; }
  100% { opacity:0.85; }
}

/* â”€â”€ í…ìŠ¤íŠ¸ ë¹›ë‚˜ëŠ” shimmer â”€â”€ */
@keyframes textShimmer {
  0%   { background-position: -200% center; }
  100% { background-position: 200% center; }
}
.cs-warning-shimmer {
  background: linear-gradient(90deg, #ff4444 30%, #ffcccc 50%, #ff4444 70%);
  background-size: 200% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: textShimmer 1.8s linear infinite;
}
.cs-badge-shimmer {
  background: linear-gradient(90deg, #ff8888 20%, #ffffff 45%, #ffaaaa 55%, #ff8888 80%);
  background-size: 200% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: textShimmer 2s linear infinite;
}
.cs-mystery-shimmer {
  background: linear-gradient(90deg, #ff3333 25%, #ff9999 50%, #ff3333 75%);
  background-size: 200% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: textShimmer 1.4s linear infinite;
}

/* â”€â”€ íƒ€ì´í‹€ í”ë“¤ë¦¼ ì•ˆì°© â”€â”€ */
@keyframes charRumble {
  0%,100% { transform: translateX(0); }
  20%  { transform: translateX(-2px); }
  40%  { transform: translateX(2px); }
  60%  { transform: translateX(-1px); }
  80%  { transform: translateX(1px); }
}
.cs-char.rumble { animation: charRumble 0.3s ease forwards; }

/* â”€â”€ ì¤Œì¸ ì¶©ê²© â”€â”€ */
@keyframes zoomShock {
  0%   { transform: translate(-50%,-50%) scale(1.18); filter: brightness(1.5); }
  40%  { transform: translate(-50%,-50%) scale(0.97); filter: brightness(1); }
  65%  { transform: translate(-50%,-50%) scale(1.02); }
  100% { transform: translate(-50%,-50%) scale(1); }
}
#hiddenCutscene.zoomshock .cs-content { animation: zoomShock 0.5s cubic-bezier(0.22,1,0.36,1) forwards; }
/* ìµœì¢… í˜ì´ë“œì•„ì›ƒ */
.cs-fadeout {
  position: absolute; inset: 0; z-index: 20;
  background: #000; opacity: 0; pointer-events: none;
}
.cs-fadeout.do-fade {
  animation: fadeToBlack 0.5s ease forwards;
}
@keyframes fadeToBlack {
  from { opacity:0; } to { opacity:1; }
}
</style>
</head>
<body>
<div class="scale-wrapper">
<div class="panel-wrap">
<div class="panel" id="panel">
  <canvas id="bgCrackCanvas"></canvas>
  <div id="finishGaugeOverlay">
    <div id="fgoInner">
      <div id="fgoEventTitle">
    <div class="fgo-banner-wrap">
      <div class="fgo-banner-line"></div>
      <span class="fgo-banner-crown">ğŸ†</span>
      <span class="fgo-banner-text">ì´ë¼333ë°° ë©”ì´í”Œ ê°œë§ì§± ìµœì¢…ìˆœìœ„</span>
      <span class="fgo-banner-crown">ğŸ†</span>
      <div class="fgo-banner-line right"></div>
    </div>
  </div>
  <div id="fgoTitle"></div>
      <div id="fgoRoundLabel">â–¶ 1ë¼ìš´ë“œ</div>
      <div id="fgoAllRaces"></div>
    </div>
  </div>
  <div id="hiddenCutscene">
  <div id="csShakeWrap" style="position:absolute;inset:0;pointer-events:none;">
    <div class="cs-alert-left"  id="csAlertL"></div>
    <div class="cs-alert-right" id="csAlertR"></div>
    <div class="cs-alert-top"    id="csAlertT"></div>
    <div class="cs-alert-bottom" id="csAlertB"></div>
    <div class="cs-vignette"    id="csVignette"></div>
    <div class="cs-countdown"   id="csCountdown"></div>
    <div class="cs-embers"      id="csEmbers"></div>
    <div class="cs-backdrop"></div>
    <div class="cs-bar-top"></div>
    <div class="cs-bar-bottom"></div>
    <div class="cs-scanline"></div>
    <div class="cs-burst"></div>
    <div class="cs-beams" id="csBeams"></div>
    <svg class="cs-cracks" id="csCracks" viewBox="0 0 620 400" preserveAspectRatio="xMidYMid slice">
      <defs>
        <filter id="csglow">
          <feGaussianBlur stdDeviation="4" result="coloredBlur"/>
          <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
        <filter id="csglowbig">
          <feGaussianBlur stdDeviation="10" result="coloredBlur"/>
          <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
      </defs>
      <!-- ì¤‘ì‹¬ì  -->
      <circle id="crackCenter" cx="310" cy="200" r="6" fill="#ff3333" opacity="0" filter="url(#csglow)"/>
      <!-- ê· ì—´ 1ë‹¨ê³„: ì§§ì€ ê· ì—´ (ì²˜ìŒ ë“±ì¥) -->
      <g id="crackStage1" stroke="#ff3333" stroke-width="2" fill="none" opacity="0">
        <path d="M310,200 L280,160 L260,130"/>
        <path d="M310,200 L345,155 L370,120"/>
        <path d="M310,200 L260,230 L220,260"/>
        <path d="M310,200 L365,245 L410,275"/>
        <path d="M310,200 L295,250 L275,310"/>
        <path d="M310,200 L328,255 L348,318"/>
      </g>
      <!-- ê· ì—´ 2ë‹¨ê³„: í™”ë©´ ì ˆë°˜ê¹Œì§€ í¼ì§ -->
      <g id="crackStage2" stroke="#ff4444" stroke-width="1.5" fill="none" opacity="0">
        <path d="M260,130 L220,80 L170,30"/>
        <path d="M370,120 L410,70 L460,10"/>
        <path d="M220,260 L160,310 L80,370"/>
        <path d="M410,275 L470,320 L550,380"/>
        <path d="M275,310 L240,370 L200,410"/>
        <path d="M348,318 L380,380 L430,420"/>
        <!-- ê°€ì§€ ê· ì—´ -->
        <path d="M220,80 L180,100 L140,80"/>
        <path d="M410,70 L440,90 L480,60"/>
        <path d="M160,310 L130,290 L90,310"/>
        <path d="M470,320 L500,300 L540,320"/>
      </g>
      <!-- ê· ì—´ 3ë‹¨ê³„: í™”ë©´ ì „ì²´ ë®ìŒ -->
      <g id="crackStage3" stroke="#ff6666" stroke-width="1" fill="none" opacity="0">
        <path d="M170,30 L100,-10 L20,-30"/>
        <path d="M460,10 L540,-20 L630,-10"/>
        <path d="M80,370 L20,410 L-20,440"/>
        <path d="M550,380 L620,420 L650,450"/>
        <path d="M140,80 L60,60 L0,40"/>
        <path d="M480,60 L570,40 L630,20"/>
        <path d="M90,310 L30,330 L-10,360"/>
        <path d="M540,320 L600,340 L640,370"/>
        <!-- ì¶”ê°€ ì”ê· ì—´ -->
        <path d="M200,-10 L180,50 L150,20"/>
        <path d="M430,-10 L450,40 L490,10"/>
        <path d="M50,200 L20,180 L0,210"/>
        <path d="M580,200 L610,180 L630,210"/>
        <path d="M150,390 L170,420 L130,440"/>
        <path d="M480,390 L500,420 L530,410"/>
      </g>
    </svg>
    <div class="cs-content" id="csContent">
      <span class="cs-lock-icon" id="csLockIcon">ğŸ”“</span>
      <div class="cs-warning" id="csWarning"><span class="cs-warning-shimmer">âš  HIDDEN STAGE UNLOCKED âš </span></div>
      <div class="cs-hidden-badge" id="csBadge"><div class="cs-hidden-badge-text"><span class="cs-badge-shimmer">âœ¦ HIDDEN ROUND âœ¦</span></div></div>
      <div class="cs-mystery" id="csMystery"><span id="csTypingText" class="cs-mystery-shimmer"></span><span class="cs-cursor" id="csCursor"></span></div>
      <div class="cs-title-wrap">
        <div id="csMainTitle" class="cs-char-wrap"></div>
      </div>
      <div class="cs-subtitle" id="csSubtitle">ìˆ¨ê²¨ì§„ ìµœí›„ì˜ ë¼ìš´ë“œê°€ ê³µê°œë©ë‹ˆë‹¤</div>
    </div>
    </div><!-- /csShakeWrap -->
    <div class="cs-fadeout" id="csFadeout"></div>
  </div>
  <!-- ë‘êµ¬ë‘êµ¬ ë¹Œë“œì—… ì˜¤ë²„ë ˆì´ -->
  <div id="drumrollOverlay">
    <div id="drumrollBg"></div>
    <div id="drumrollVignette"></div>
    <div id="drumrollFlash"></div>
    <div id="drumrollText">
      <div id="drumrollQmark">ğŸ†</div>
      <div id="drumrollLabel">ìš° ìŠ¹ ì ëŠ” . . .</div>
    </div>
    <div id="drumrollBar"><div id="drumrollBarFill"></div></div>
  </div>
  <div id="celebOverlay">
    <div class="celeb-box">
      <div class="celeb-char-wrap">
        <img class="celeb-char" id="celebChar" src="" alt="">
        <div class="celeb-title">ğŸ† ìš°ìŠ¹!!! ğŸ†</div>
        <div class="celeb-name" id="celebWinner"></div>
      </div>
    </div>
  </div>
  <div class="header">
    <div class="header-btns">
      <button class="finish-btn" id="finishBtn" onclick="triggerFinish()">ğŸ† ì™„ì£¼!</button>
      <button class="lock-btn"   id="lockBtn"   onclick="toggleRound5()">ğŸ”’</button>
    </div>
    <div class="header-center">
      <span class="header-glove">ğŸ¤œğŸ»</span>
      <span class="header-title">ì´ë¼333ë°° ë©”ì´í”Œ ê°œë§ì§± ì»¨í…ì¸ </span>
      <span class="header-glove">ğŸ¤›ğŸ»</span>
    </div>
    <div style="width:80px"></div>
  </div>
  <div class="race-section" id="raceSection">
  </div>
  <div class="footer">
    <div class="live-dot"></div>
    <span class="live-text">IRA333</span>
  </div>



<script>
const STREAMERS = {
  "ë¥˜ì•„": { look: "GCAKKIDAKGCELMBBLPHPIJEMCPKHLEIIJJHIGNLEDHIOFICJBKHNEAPMFNBFKHAEPPNFGKIAAPEJGICCNAIKBJEJHNBCEHJOCENPEBBKEAJFBPNPFKFFHHLNNKPFIHPNPGMDFLAEGHHFMHPJAGGKFOJJBGKCKOIMKGHNDONCDEEDDIBGCHMOEENMOOMCCOKDIPAOJJEACIBAIEILPICAEMFDFCEEIIDMMCDLIEMBNLLDNMPKHMOGOOPCBDOIFGHMBCHHNCILEIKNDIAGMDACAECIHCAEDFDFOHBMKKKKKGJCBIMPLFBHEICKPILFHNOKNLCEPANAKGKIGFHLLMJMJLNPAJBFEHMGAGEFBAFPKNLHNCAPNIAAPKEKGKAAKKKKDMOPLEAFGKALFEBBEJFEDBCDIAMDOLNEEFEAEEHEOOAKDHBOIANMCGBMNGIPMGLAHFMEMDGHGDFCLOIEIHEJEBJECMPIHCJBJENKALALLLNBNHEGDMMJDFHLEBBMGILNOGAOCPKOPIBFBKPEDLIOBGAOMPJNKBAAGFJPCNEFHDECAKIOOAKCKFMEAEIMGBANFDBIOEMAADANLJEMGGGCBMDBHKNCPABNBHCMNLDPBDJCIDDOFLIFHMBLPKHGIHJJFNMBLLJBPOMJMOBGHGDJECAIGLHDPAIBMLIPOMCODDEDGJIGAGDPMKGHGDOICJADDKLANMJEHGHGFNGJMNEGDBGPLDENFNIJAAGAEEFKANCDDHDBINLDOAMPNFAEFCPKDFMMPIAKKPFOBICPEJHOKCAOLDFCIFAJEPDDNBCFGJOPPELCNLENIDLCNLIEJGGHADPJNOLPINKGDOHBHGJOGOPAFGLBPDIBMENHKKJNPKCAOFNNENNFLLCINJICDBMMCDILJPLDNJGJNJKJDFOKJLKAMMDAELGNIIIBCMDODHGPAPHLHDANJFEKKMGHJKGKIIFNBGBHGLMLEIAEJLLEJCAIPKMEEJIBKFNEDCECKCJLDIPJKIDCIFPKKBKDCAJN", wmotion: "W00" },
  "ë‚˜ë¡œí›„ë‹": { look: "CGOCOFDLOJNBCNAIPPBHEPCGALELJHGACIMKCKDLIGHFGFNENDPLCDDCPLEKBEGLBMDLDGHMNLDPJDLECPBONDCCLGJGPKNHAKKBDGEOGBOIBDAICCIPLCJOCGBPHBHNKPIMILBFDLIEMLHDMPPPILOOCDCHCNCJDMGOKFHDBPNFGHJDPFPGKADIGPPHCAHBKBAGGAKLHHLOGPOBCKGDFLAAPEBOMFLPGGELFKAIGKNJACHNMMLBNJHIEKNGLFIBFFEDCPCMIAAELJNEBIEKODBGEOGJEFFDMLFHKADGFOJIHNNEFPDALBPHAOLGFKHPMODLDACFHENGJEGHLMMLCNJJNJBPAEFGEBIABFIDGJAGPMJENPNOAEMKGEDFDONHAABJAALJMPINMECMLNDDAOFJPIGEPAJEMIEFGNPOAILJLLEBKOBOMBGGKHFCMFHJCPHFLKPEKOEJNFIOLPFBKEFMBDBIGJEBIGMBAGPCNPAOJHHMCKEMMFILJEPFJLLGMHGFAIGGCKKPHGINIDEKPCDECCHHIHIMCIEHHPOHJMJOCDLDOKFHILBAIBAELMAAJAHKCIKGNHKNEGHCGMEGOBAOBDEJOJFONEGCMAABIDHGLMGIKMPAODHKANJOEGHINDAJOMENCPAJMIMLGGFKEFMDGEEAODPLCMFMPOIDJGEFFCHONADDDMBJKEGLELHPFDAGJKDFHLBBABENBKJICGNGEJDOJELAGPJENJLJPCGJPCGNANLFIMPOGKOGNONKBGDEODHLNAPMPPGJKDDAOMNPHMNPCCNGOANPFECKLAHFPKGBIMBMDEDNCJJMIMIKCPCCGNGGIKCBALPBFNPGAFDIGIGCJCGNHGLKLGOHLMCOMLHCFIBIEDDNBFHGDFMKKGDEEOBDGJNJNMBHELAGNKJHFPGFGPJDPCMOLCFLKHMIDAANJIELNLGBLODBEDNAAHCNEDDLOHEOBIAGHPCMNGJAOHHNCDKLPDKJFEJONPJDPMKEJNPGLBHAMJFHINCN", wmotion: "W00" },
  "ì§„ìº":   { look: "OBPKOKNMNPEOKNGEKAJJICKGNJCDKEIOIGEFLLDBLCLPOEHGPBKOJPBDBLOPKMLNAPJKHMLPIMONOKEHDEKFNPCIMJPPIFLFMLGIBIIFPBIMFEMPMPJHMLPKPJGMFPEKBNMHEMKCFCANHNPBGKKMDFJNDPOGPHHHJJBIMLHDHANKHBDFFDADAJJCBKIIPMOJMEBBLKIBIHDHMFLBCJEKLCDMFOGMILOPBKAONMPNEBAFIHJCNHFDIKFBJJKOMNBFLHFHIHNPNIIMKGKENEKEOAKAHIBJFMFPLKJGHFJIJIMKIEIHLGGKGBOFAAIPDHNKOKDGEBEACNBPADCMNAFHHDJEDGGEHMCMDHJKNKHMJMPGANIDIHIFNIAGJKKEJJNMAJCMINPCDGOCPLIFAKOKCGAMHCCLHJPFPNMFJLLNJDJIFDLBJJEKNMDCDHOJDKOINMKEIILMGKNADFLLFHADABFHFKCNCAIBHLFKNKJEFGMDIHKBBFBJJFHDJDHGAMOBBEICDCGHIGLNFHOKFDGPMNIDLDCDKPPLEAMGMLBBMKDLMJDOPEFJLOLLEOJGBPFEJCNGAGNOKDNEKPEBCOGMEFAHCMFHMNPCLJGNIFFBCBHJBLNJOOIKCHEPECGLLGPHNBGLEFMLEECFICIMJODJGHGKIAPILACNBPLNDLACBLDFALEDLIEMBMCKIOKPCEGEGLIAFKFLIALBJDKDGPNMDHONAHABHECJOBJAPMONFDAOKHJPAIJCAKPOMNDLAGOEKBNJNHAMCGCOCDADIEKIKNLBLFOIACIELKEDBACDDIKNNNBPEAJJBDPPBAGMCLELFPDHAEDEGOBOIJIMIBCDMFKJDFCCHDEGGCAGNBKPCHBMEKPEDAGDJCIFBFMJAPIEDLOEHJPKBNHFGCBAJNNBGBJINHOLKEGGGJIHBJBIGCKDEFEICAAAIMDCAPGMJHJBLMBJAGGBJPALOOLCKPHLIGIKMFLLCMELDFELBNKPDFIMFCGLCBMAHAOGFAJBDEGD", wmotion: "W00" },
  "íŒ¡ì´ìš”": { look: "AHFMCHNACDDFCMOMICDHNKFEAFKOCLPFDIIJJPDFNPDDBFHEHCBPOAMFAENNFGBMFJELMPIOHCBGKMEIJPIFLAPGHBGMHJAJAGEDGPAKMCLAKNEJCMEPCEJKFHMJJONPGKJBDADGBJBACDBCFCGLFNJNPDADNDCBMAECGKMFNNFGOEFOFONOJEBIFELNBJIFKDHGBPPKMFANLONIHEGMIGMAJCLGKAOBLJDAFEDEAMHDGCFDDLJOEIOKDPNFEPPMOJGHOLDOCNLAHMJBFPKOLIDJPELGLFEBFLAGPIIIFPJCJLDJMIGJLJGHKHJKPAOPGEMOFKNGECGNJKBDANGJOHCOBDJLNOLALAIENFNCLFEPJOAKLBIFBEFGMKEJMAPIJKKCOKJAFBBPKBNHBEAOAPHMHBCOFLGFFMMPHFLPDFGALCOJHAAHCJPLPGGINFAOFPPIAMCHCMDKIMLEMJGMJNLMOMPPPMKAAJPLGABOLEHKCKJMIDHFMIGPGDPFPDJLONKCFGGELEFGIBPIEOFJLMLMJBIBPJECDFIEDGLCPEPOEJKMMOEOEGJJEIOBEDKFIDEEJOMIAKFMGIHNEHNFMFOKLLNPLIGKPJBAPLKDFGKKJFLMBNGKOOLGMJCAKDEOOPLKGDJLEIOELADEFKGLJLIJDGOMAGALCOGJMGLFGGPJHLBKJONFAMOCMHJODGLNIBJPAPMFNMNHNCJJFFIJKJMGIDGODGIGEHGKBFBACGFPGHEJFPKFCIMCIOEDBBIDJKDMEDIOAKJMHEDHOOGMPGBINJMEMGCNAPOJFMECFAEIDLMMHLPKOJLMCBHOBIHMACELJCGAEIGHLCGIJCHGFPJIJDAODNJBOHECFPCCILKBBOGLPEMOJMJLFNNPEAANMGKCJPOGBCBHDOOAJJAPGIKCDCEKHAAFMBPIBJBJNEPGHENKOBMCABFAHAELNGPNNGPIPLKAOKLGFDDKAFHKBGABIAOOHIFLGANNAHPEDBKNOLLJHOGOIHBKEEPFBJBH", wmotion: "W02" },
  "ë¶€ì¶”": { look: "HIELKPNAHDFOIKMCPEMDKPICEKFBEEBBEEMJAFKOECDMEOKBLGCHBLDBOBDPLHKEOGMJEPCCBGFGFKNHELHGOPOCGJLEINKNKHELKGBJAIBNOLHIOLIPCNEDECJLFLKCLEADOBMAPMOLPJHLOBHOMIGHPHGENJGLDAMBCBIKPBPIBFGJIDLAKKDANLFJKGGMAHCJLFAAKHDINBOABGJFODMCMGCJEJPNCJINADOBDAEBAOGBLCCNHIDNEHNOMKOOPEOIFMFJAKGBNPEKFHIEEBDHDAPNOAKIDNAKEMMBBCBGHJPPKGBCCIAHIEAIKALNMNNGLKCNPCEFHGFGLIAKLMKJECPHAKOHKKPGAKGDBOKDAEHKFMCJCEMJICJIALFOPDJIHOEPCAKNCJBKAOPPLCPECFNOCNKLCHIOLKCAGKEMCNPGJHJCFEONNEIKIAJBJJCPHIDKFIJGHIIKDAOAFGAAKDHLIJKLLDJJAOGMKNGIKDKHIJLGCDGNFNPDGOIIKAADFFILNJNPALGKBJCDMEMPGCILGDMBNLLHPDKNEOOBJPMDAIPIPNDGFNMJONJCAEOEMKLEECKGBCAMKHGNIGCHJOLPFEBJFKIHGKEOPBKIMLOGLBCEOMEAOOJCFODKFABHOMGDNFMICFGJFNGMHOCLCACLNMKHHCDMLNMJBBBKHLOCOMGOCENEKGOEIGKHNDFHEMOOICLLDDJHJEKEKNENLOEAPGMAKKLHANHPNBDGIKDONFJGDOBPBKNJFDKINBIJCBEKBBHKCOHKGMFNKOHHMCBIDFMEGJMKBIJPJKOJNJGGCEDKGGOMJGMIBGKNKPLKDPGMIGPAJKICJMCFPBIMCENCBGNBAKADMGGNGLAAAMIGJKJAOJINJOHGDMOMIPKHPNLKHCHAHJDLILOHDILDNPBFBIJIKPADFAGLFBIPBKOAMBJNMHKFLDNDFCCGPNGAHFAAGDHAIBPLJELPOBOMOFBBLIKDKIDKFGDEGGDANDNALBKPDINDKMPHPHLE", wmotion: "W02" },
  "ì„¸ê¸€ì": { look: "EFBAJENHLMCBEJPKBNNIDKACLKGBJOFLJOJLBEPIHEKBFCBMCDIGGBICHCFMOMBGMMAKBFOOFLKJBBAIEIPHJPDDOIGBBJCHAMJGGFJPIBNEAIOFMKPAAMOJOPPDBEPCMNLHCKDGMECBMJBNCAKLIOKJNCKFELGCIPPAAHAFCMEPAGKDIABINABNAIGICLGMMBIOPLGJGLEEDDKFIHFCBGHMMDGKODGDKLALENFFLNCAMABKFDPBFEJGDPOMLCCIMPIFDDEGNMAGHEKPMMCOLHKJGAONDBCMKJCOFNDJCDENPBJALLPBFFKOCPLFIBBLBMMNJONLLPJEMFCAKCIIBENOEJBGABFKPIEJEKCKICHJKFAHGPOBCGCGKOJCPHJLEKEFDIPHNKLKNMJAEEMDCMCNHOHHEIMBIPPJEPDPFLKIPDOACDECILLGBFOMAALCOGONJOAGMEAKEAPOBPAAKCFGHGEIDFNGKFPNKAIDFPJHEHJEOPIGLNBPCKOMHABKFOHBDEACJMPLPBOIDCKDPEGGOBBKEHGOIOLGGMLLNICNFLNOKEFNNFPMNFMDEHDFFDNGBNDNPGBLDPBADPKECHKFHAONAJJPIAKCHLFPHMNJBEPLJCHPBEEAFLKLJINELFHAAACGPMEACAJFOIONHHEPCBNLBLDGJGEJILNLDAJAFENJDOLOCPHDIELIBJEHHCGMDFJBLIGFMGDHHKGPEABNIPGJEEDKFHJFPJAJABAHNFIMHJCKKCCPGIABHHANLNAKOOBKFCKKBIKILDBFDEDGOJEKEGFKFFOMJLICFPMAEIGKBEPIPEFLMGOBGOJOIPGMLKCGHLNBDECMDPAPJJMCKEOKPAHIGHIFNKKAECADIMHCIGKIICPKIKLLFDJODACDHHKPKGFECPBOFFPAPMHODNPDHIEMABLCNOBNHEPOGANNHHGGGKPJOFLLCDKNBFCDKOBDCNOOMBOECGKJFDGIIIPJEACCNMMGGOFOHLDCFMKNGOFCACABGBOGDDFJ", wmotion: "W00" },
  "ì‹ì¤‘ë•": { look: "HOGJJHPOPPDFAOEBJJODANKNBLPKGLKHHMGNLFKLLGDPIKCJOEDDMPCPALIBLIEADMBILKEICPOCONOMFIBHBBFCAPOMLNBKKFEDDLLKGNJCABJIGKIKCEKLDJFKGFDONAFNACKCFDNDGGKNHEGBKGMKNAJOFADOJGFGHPMIALNGKNGOCMAHFGPPIELPPGODMLAPOBAKDMHENNNHDIFEIHJLHEIPJDNKBAJLKBBIJGGKMOAMKHKLMPPDKAOHDGBGCFHGIONELNHDNKINEOGOLIJIJLPMPCPABBNHIAENJFCGLHLMJINIMIMHFPLNLMKDFPDDIGMHNBBDDOAIDHNGHEGFAOADKKGGDNPBGDMMOKAPCKILDLMDCAOMMMJCFBLMNGHELOMLMLNMADAJDFHLIOBOIIHEOHLBICNPMDBKCLDOHEKNNOOFIJKMFBFECCGLINADNCMHMCGAEPFGNIOFDFHEHGHCNIOACHNGGJJILCEOPAAHHELODDBFEFMJADMEDAIKPOOCIHJFLHOPBLIHIIJBOKKAGOFIAGMDOKEBFOHIAPHDMFDNAEFBFILDOFPOBIKBNJICEOKFHAKOCKOGPDKHNGDMMBEFNIGMCHHMLLNALIAMDCOGLHPHIOPONKLHEJIELNEGNJBKPCEAKNLKNBEKHLCBMABFHECGHDKDFMKEIEIDABOBOIOFMMHMOBHIEMAIACEILIPIEAHAPNHJAHLIMBGGNBAPKDJMBGLHBPHBJLMAPNEBFJOBBLCOOALDIMCKLLPJNKOJCDILHCLALNCKLCDOPJOHHKHKGJGNMGJDLGICNGOMGNICKCPCFILOLGAMJIGDFGACDFDFBEEAJKPDBGMEAHGAPIJCKEHDFLPPBMOBAKPKLDONBKIEHEIDOEGNDOHJCDHBOFCMNKBGPIMLBGAAGNHDKGGMBFOPMNPBPJAENNOJDLCMFJFOGPMHHGABLGOEPJIDBNIDBCCHIPDNPDCPACBFFPBLPMOGIEOJLDEDGDADPIHOIEHHMHKE", wmotion: "W01" },
};

const BASE = "https://open.api.nexon.com/static/maplestory/character/look/";

function buildUrl(name, action, frame, emotion) {
  const s = STREAMERS[name];
  if (!s) return "";
  return BASE + s.look + "?wmotion=" + s.wmotion + "&action=" + action + "." + frame + "&emotion=" + emotion + "&width=800&height=800";
}

const RANK_ANIM = {
  cheer: { action: "A05", emotion: "E09", frames: 2 },
  smile: { action: "A05", emotion: "E02", frames: 2 },
  angry: { action: "A05", emotion: "E04", frames: 2 },
  grave: { action: "A40", emotion: "E03", frames: 4 },
};

function rankToKey(rank) {
  if (rank === 1) return "cheer";
  if (rank <= 3)  return "smile";
  if (rank <= 6)  return "angry";
  return "grave";
}

const activeAnims = {};

function startAvatarAnim(imgEl, name, rank, total, hasAnyScore) {
  if (activeAnims[name]) { clearInterval(activeAnims[name]); delete activeAnims[name]; }
  if (!STREAMERS[name]) { imgEl.style.display = "none"; return; }
  // ë¼ìš´ë“œ ì ìˆ˜ê°€ í•˜ë‚˜ë„ ê¸°ë¡ë˜ì§€ ì•Šì€ ê²½ìš°(ì „ë¶€ ë¹ˆì…€/-)ì—ë§Œ ê¸°ë³¸ í‘œì •
  if (!hasAnyScore) {
    imgEl.src = buildUrl(name, "A00", 0, "E00");
    return;
  }
  const anim = RANK_ANIM[rankToKey(rank)];
  let frame = 0;
  imgEl.src = buildUrl(name, anim.action, frame, anim.emotion);
  frame = (frame + 1) % anim.frames;
  activeAnims[name] = setInterval(() => {
    imgEl.src = buildUrl(name, anim.action, frame, anim.emotion);
    frame = (frame + 1) % anim.frames;
  }, 300);
}

function startCelebAnim(name) {
  const imgEl = document.getElementById("celebChar");
  if (!imgEl || !STREAMERS[name]) return;
  if (activeAnims["__celeb__"]) { clearInterval(activeAnims["__celeb__"]); delete activeAnims["__celeb__"]; }
  const anim = RANK_ANIM["cheer"];
  let frame = 0;
  imgEl.src = buildUrl(name, anim.action, frame, anim.emotion);
  frame = (frame + 1) % anim.frames;
  activeAnims["__celeb__"] = setInterval(() => {
    imgEl.src = buildUrl(name, anim.action, frame, anim.emotion);
    frame = (frame + 1) % anim.frames;
  }, 300);
}

function stopCelebAnim() {
  if (activeAnims["__celeb__"]) { clearInterval(activeAnims["__celeb__"]); delete activeAnims["__celeb__"]; }
}

function startRunnerAnim(imgEl, name) {
  const key = "runner_" + name;
  if (activeAnims[key]) { clearInterval(activeAnims[key]); delete activeAnims[key]; }
  if (!STREAMERS[name]) { imgEl.style.display = "none"; return; }
  let frame = 0;
  imgEl.src = buildUrl(name, "A02", frame, "E00");
  frame = (frame + 1) % 4;
  activeAnims[key] = setInterval(() => {
    imgEl.src = buildUrl(name, "A02", frame, "E00");
    frame = (frame + 1) % 4;
  }, 200);
}

let prevJSON = "";
let round5Revealed = false;
let celebActive = false;
let celebTimer = null;
let currentFirstName = "";
let finishTriggered = false;
let finishApplied = false;
let cutscenePlaying = false;

/* ===== íˆë“  ë¼ìš´ë“œ ì»·ì”¬ ===== */

// â”€â”€ ë°°ê²½ ë¶ˆê½ƒ ìƒì„± â”€â”€
function spawnEmbers(container, cs) {
  container.innerHTML = "";
  const W = cs.offsetWidth || 620;
  const H = cs.offsetHeight || 300;
  for (let i = 0; i < 22; i++) {
    const em = document.createElement("div");
    em.className = "cs-ember";
    const size = 3 + Math.random() * 6;
    const ex = Math.random() * 100;
    const esx = (Math.random() - 0.5) * 40;
    const eh = -(80 + Math.random() * (H * 0.7));
    const ed = 1.2 + Math.random() * 1.8;
    const delay = Math.random() * 2;
    em.style.cssText =
      "--ew:" + size + "px;" +
      "--ex:" + ex + "%;" +
      "--esx:" + esx + "px;" +
      "--eh:" + eh + "px;" +
      "--ed:" + ed + "s;" +
      "--delay:" + delay + "s;";
    container.appendChild(em);
  }
}

function playCutscene(onComplete) {
  if (cutscenePlaying) return;
  cutscenePlaying = true;

  const cs        = document.getElementById("hiddenCutscene");
  const backdrop  = cs.querySelector(".cs-backdrop");
  const scanline  = cs.querySelector(".cs-scanline");
  const burst     = cs.querySelector(".cs-burst");
  const cracks    = document.getElementById("csCracks");
  const content   = document.getElementById("csContent");
  const lockIcon  = document.getElementById("csLockIcon");
  const warning   = document.getElementById("csWarning");
  const badge     = document.getElementById("csBadge");
  const typing    = document.getElementById("csTypingText");
  const cursor    = document.getElementById("csCursor");
  const mainTitle = document.getElementById("csMainTitle");
  const subtitle  = document.getElementById("csSubtitle");
  const fadeout   = document.getElementById("csFadeout");
  const beamsWrap = document.getElementById("csBeams");
  const alertL    = document.getElementById("csAlertL");
  const alertR    = document.getElementById("csAlertR");
  const alertT    = document.getElementById("csAlertT");
  const alertB    = document.getElementById("csAlertB");
  const vignette  = document.getElementById("csVignette");
  const countdown = document.getElementById("csCountdown");
  const embers    = document.getElementById("csEmbers");

  // â”€â”€ ì™„ì „ ì´ˆê¸°í™” â”€â”€
  cs.style.display = "block";
  cs.classList.remove("bars-in", "zoomshock");
  backdrop.style.opacity = "0";
  scanline.style.animation = "none"; scanline.style.opacity = "0"; scanline.style.transform = "scaleX(0)";
  burst.style.animation = "none"; burst.style.opacity = "0";
  cracks.style.animation = "none"; cracks.style.opacity = "0";
  content.style.animation = "none"; content.style.opacity = "0"; content.style.transform = "translate(-50%,-50%) scale(0.95)";
  lockIcon.style.animation = "none"; lockIcon.style.opacity = "0";
  warning.style.animation = "none"; warning.style.opacity = "0";
  badge.style.animation = "none"; badge.style.opacity = "0";
  mainTitle.style.animation = "none"; mainTitle.style.opacity = "0"; mainTitle.innerHTML = "";
  subtitle.style.animation = "none"; subtitle.style.opacity = "0";
  fadeout.style.animation = "none"; fadeout.style.opacity = "0";
  alertL.style.animation = "none"; alertL.style.opacity = "0";
  alertR.style.animation = "none"; alertR.style.opacity = "0";
  alertT.style.animation = "none"; alertT.style.opacity = "0";
  alertB.style.animation = "none"; alertB.style.opacity = "0";
  vignette.style.animation = "none"; vignette.style.opacity = "0";
  countdown.style.animation = "none"; countdown.style.opacity = "0";
  embers.innerHTML = "";
  typing.textContent = "";
  cursor.style.display = "none";
  beamsWrap.innerHTML = "";

  function go(el, props) { Object.assign(el.style, props); }
  function transition(el, duration, props) {
    el.style.transition = "all " + duration + "ms ease";
    Object.assign(el.style, props);
  }

  let t = 30;

  // 1) ë°°ê²½ ì–´ë‘ 
  setTimeout(() => {
    transition(backdrop, 400, { opacity: "1" });
  }, t); t += 350;

  // 2) ì¤Œì¸ ì¶©ê²© + ì§„ë™ + ë ˆí„°ë°•ìŠ¤
  setTimeout(() => {
    cs.classList.add("zoomshock");
    setTimeout(() => cs.classList.remove("zoomshock"), 500);
    // ë°°ê²½ì€ ê³ ì •, ëˆˆì— ë³´ì´ëŠ” ìš”ì†Œë“¤ë§Œ í”ë“¤ê¸°
    [
      document.getElementById("csCracks"),
      document.getElementById("csBeams"),
      document.getElementById("csCountdown"),
    ].forEach(el => {
      if (!el) return;
      el.style.animation = "none";
      void el.offsetWidth;
      el.style.animation = "screenShake 0.7s cubic-bezier(0.36,0.07,0.19,0.97) forwards";
      setTimeout(() => { el.style.animation = ""; }, 750);
    });
    // cs-contentëŠ” translate(-50%,-50%) ìœ ì§€í•˜ë©° í”ë“¤ê¸°
    const csContentEl = document.getElementById("csContent");
    if (csContentEl) {
      csContentEl.style.animation = "none";
      void csContentEl.offsetWidth;
      csContentEl.style.animation = "screenShakeCenter 0.7s cubic-bezier(0.36,0.07,0.19,0.97) forwards";
      setTimeout(() => { csContentEl.style.animation = ""; }, 750);
    }
    cs.classList.add("bars-in");
  }, t); t += 450;

  // 3) ë¹„ë„¤íŠ¸ ë“±ì¥
  setTimeout(() => {
    go(vignette, { animation: "vignetteIn 0.8s ease forwards", opacity: "1" });
  }, t); t += 100;

  // 4) ë¶ˆê½ƒ íŒŒí‹°í´ ì‹œì‘
  setTimeout(() => {
    spawnEmbers(embers, cs);
  }, t); t += 150;

  // 5) ìŠ¤ìº”ë¼ì¸
  setTimeout(() => {
    go(scanline, { transition: "none", opacity: "1", transform: "scaleX(0)" });
    requestAnimationFrame(() => {
      scanline.style.transition = "transform 0.4s cubic-bezier(0.22,1,0.36,1), opacity 0.3s";
      scanline.style.transform = "scaleX(1)";
    });
  }, t); t += 350;

  // 6) ì¹´ìš´íŠ¸ë‹¤ìš´ 3â†’2â†’1
  const countNums = ["3","2","1"];
  const countColors = ["#ff2222","#ff5500","#ffaa00"];
  countNums.forEach((num, ci) => {
    setTimeout(() => {
      countdown.textContent = num;
      countdown.style.color = countColors[ci];
      countdown.style.textShadow = "0 0 30px " + countColors[ci] + ", 0 0 60px " + countColors[ci] + ", 0 0 90px rgba(200,0,0,0.5)";
      countdown.style.animation = "none";
      void countdown.offsetWidth;
      countdown.style.animation = "countPunch 0.35s cubic-bezier(0.22,1,0.36,1) forwards";
      setTimeout(() => { countdown.style.animation = "countFade 0.3s ease forwards"; }, 320);
    }, t + ci * 420);
  });
  t += countNums.length * 420 + 200;

  // 7) ê· ì—´ â†’ í™”ë©´ ì „ì²´ë¡œ í¼ì§€ë©° í­ë°œ
  setTimeout(() => {
    const stage1 = document.getElementById("crackStage1");
    const stage2 = document.getElementById("crackStage2");
    const stage3 = document.getElementById("crackStage3");
    const crackCenterEl = document.getElementById("crackCenter");

    function shakeEl(el, anim, dur) {
      if (!el) return;
      el.style.animation = "none";
      void el.offsetWidth;
      el.style.animation = anim;
      setTimeout(() => { el.style.animation = ""; }, dur);
    }

    // 0ms: ì¤‘ì‹¬ì  + 1ë‹¨ê³„ ê· ì—´ ë“±ì¥
    cracks.style.opacity = "1";
    crackCenterEl.style.opacity = "0.9";
    stage1.style.opacity = "1";
    cracks.classList.remove("crack-shake1","crack-shake2","crack-shake3"); void cracks.offsetWidth;
    cracks.classList.add("crack-shake1"); setTimeout(() => cracks.classList.remove("crack-shake1"), 380);
    shakeEl(document.getElementById("csContent"), "screenShakeCenter 0.4s cubic-bezier(0.36,0.07,0.19,0.97) forwards", 420);

    // 200ms: ê· ì—´ ë¹›ë‚˜ë©° 2ë‹¨ê³„ë¡œ í¼ì§
    setTimeout(() => {
      stage1.style.filter = "drop-shadow(0 0 4px #ff2200) drop-shadow(0 0 8px #ff0000)";
      stage1.setAttribute("stroke", "#ffffff");
      stage2.style.opacity = "1";
      crackCenterEl.setAttribute("r", "14");
      crackCenterEl.style.filter = "url(#csglowbig)";
      cracks.classList.remove("crack-shake1","crack-shake2","crack-shake3"); void cracks.offsetWidth;
      cracks.classList.add("crack-shake2"); setTimeout(() => cracks.classList.remove("crack-shake2"), 480);
      shakeEl(document.getElementById("csContent"), "screenShakeCenter 0.5s cubic-bezier(0.36,0.07,0.19,0.97) forwards", 520);
      shakeEl(document.getElementById("csCountdown"), "screenShake 0.5s cubic-bezier(0.36,0.07,0.19,0.97) forwards", 520);
    }, 200);

    // 450ms: í™”ë©´ ì „ì²´ ê· ì—´ + ë¹› ê·¹ëŒ€í™”
    setTimeout(() => {
      stage2.style.filter = "drop-shadow(0 0 6px #ff3300)";
      stage3.style.opacity = "1";
      crackCenterEl.setAttribute("r", "24");
      crackCenterEl.setAttribute("fill", "#ffffff");
      cracks.style.filter = "brightness(2.5) drop-shadow(0 0 16px #ff2200)";
      cracks.classList.remove("crack-shake1","crack-shake2","crack-shake3"); void cracks.offsetWidth;
      cracks.classList.add("crack-shake3"); setTimeout(() => cracks.classList.remove("crack-shake3"), 580);
      shakeEl(document.getElementById("csContent"), "screenShakeBigCenter 0.6s cubic-bezier(0.36,0.07,0.19,0.97) forwards", 650);
      shakeEl(document.getElementById("csBeams"), "screenShakeBig 0.6s cubic-bezier(0.36,0.07,0.19,0.97) forwards", 650);
    }, 450);

    // 700ms: í­ë°œ! í™”ë©´ ì „ì²´ í”Œë˜ì‹œ + ê· ì—´ ì‚¬ë¼ì§
    setTimeout(() => {
      const flash = document.createElement("div");
      flash.style.cssText = "position:absolute;inset:0;z-index:200;pointer-events:none;border-radius:10px;background:radial-gradient(circle at 50% 50%, #ffffff 0%, rgba(255,60,60,0.95) 25%, rgba(200,0,0,0.8) 55%, transparent 80%);";
      cs.appendChild(flash);
      setTimeout(() => { flash.style.transition = "opacity 0.5s ease"; flash.style.opacity = "0"; setTimeout(() => flash.remove(), 550); }, 80);

      cracks.style.transition = "opacity 0.15s ease";
      cracks.style.opacity = "0";

      for (let i = 0; i < 32; i++) {
        const shard = document.createElement("div");
        const angle = (i / 32) * Math.PI * 2 + (Math.random() - 0.5) * 0.3;
        const dist  = 80 + Math.random() * 200;
        const size  = 1 + Math.random() * 4;
        const dur   = 0.4 + Math.random() * 0.5;
        const tx = Math.cos(angle) * dist;
        const ty = Math.sin(angle) * dist;
        const color = ["#ffffff","#ffaaaa","#ff4400","#ff2200"][Math.floor(Math.random()*4)];
        shard.style.cssText = `position:absolute;left:50%;top:50%;width:${size}px;height:${size*3}px;border-radius:1px;background:${color};pointer-events:none;z-index:201;transform-origin:center;`;
        cs.appendChild(shard);
        shard.animate([
          { transform: `translate(-50%,-50%) rotate(${angle}rad) scale(1)`, opacity: 1 },
          { transform: `translate(calc(-50% + ${tx}px), calc(-50% + ${ty}px)) rotate(${angle+1}rad) scale(0)`, opacity: 0 }
        ], { duration: dur * 1000, easing: "cubic-bezier(0.1,0,0.3,1)", fill: "forwards" });
        setTimeout(() => shard.remove(), dur * 1000 + 100);
      }

      shakeEl(document.getElementById("csContent"),  "screenShakeBigCenter 0.9s cubic-bezier(0.36,0.07,0.19,0.97) forwards", 950);
      shakeEl(document.getElementById("csBeams"),    "screenShakeBig 0.9s cubic-bezier(0.36,0.07,0.19,0.97) forwards", 950);
      shakeEl(document.getElementById("csCountdown"),"screenShakeBig 0.9s cubic-bezier(0.36,0.07,0.19,0.97) forwards", 950);
    }, 700);

  }, t); t += 1400;

  // 8) ê²½ê³ ë“± í”Œë˜ì‹œ (ì¢Œìš°)
  setTimeout(() => {
    alertL.style.animation = "alertPulse 0.4s ease 3";
    alertR.style.animation = "alertPulse 0.4s ease 3 0.2s";
    alertT.style.animation = "alertPulse 0.4s ease 3";
    alertB.style.animation = "alertPulse 0.4s ease 3 0.2s";
    alertL.style.opacity = "1"; alertR.style.opacity = "1";
    alertT.style.opacity = "1"; alertB.style.opacity = "1";
    setTimeout(() => {
      alertL.style.opacity="0"; alertR.style.opacity="0";
      alertT.style.opacity="0"; alertB.style.opacity="0";
    }, 1800);
  }, t); t += 200;

  // 9) ë¹› í­ë°œ + ë¹”
  setTimeout(() => {
    go(burst, { opacity: "1", background: "radial-gradient(circle at 50% 50%, rgba(255,80,80,0.95) 0%, rgba(200,0,0,0.7) 30%, transparent 70%)" });
    setTimeout(() => { transition(burst, 600, { opacity: "0" }); }, 100);
    ["0deg","45deg","90deg","135deg","160deg","20deg"].forEach((angle, i) => {
      const beam = document.createElement("div");
      beam.className = "cs-beam";
      beam.style.cssText = "--angle:" + angle + ";animation-delay:" + (i * 0.04) + "s;";
      beamsWrap.appendChild(beam);
      requestAnimationFrame(() => requestAnimationFrame(() => beam.classList.add("shoot")));
    });
    const starEmojis = ["â­","âœ¨","ğŸ’«","ğŸŒŸ","â¤ï¸â€ğŸ”¥","ğŸ”¥","ğŸ’¥"];
    for (let i = 0; i < 10; i++) {
      const star = document.createElement("div");
      star.className = "cs-star";
      const sx = (Math.random()-0.5)*280, sy = (Math.random()-0.5)*180;
      const dur = 0.8 + Math.random()*0.5;
      star.style.cssText = "left:50%;top:50%;--sx:"+sx+"px;--sy:"+sy+"px;--dur:"+dur+"s;animation-delay:"+(i*0.05)+"s;";
      star.textContent = starEmojis[Math.floor(Math.random()*starEmojis.length)];
      cs.appendChild(star);
      setTimeout(() => { if(star.parentNode) star.remove(); }, (dur+0.3+i*0.05)*1000);
    }
    function shakeEl2(el, anim) {
      if (!el) return;
      el.style.animation = "none";
      void el.offsetWidth;
      el.style.animation = anim;
      setTimeout(() => { el.style.animation = ""; }, 1000);
    }
    shakeEl2(document.getElementById("csBeams"),  "screenShakeBig 0.9s cubic-bezier(0.36,0.07,0.19,0.97) forwards");
    shakeEl2(document.getElementById("csContent"),"screenShakeBigCenter 0.9s cubic-bezier(0.36,0.07,0.19,0.97) forwards");
  }, t); t += 300;

  // 10) ì½˜í…ì¸  ë“±ì¥
  setTimeout(() => {
    go(content, { transition: "opacity 0.4s ease, transform 0.4s ease", opacity: "1", transform: "translate(-50%,-50%) scale(1)" });
  }, t); t += 200;

  // 11) ìë¬¼ì‡ 
  setTimeout(() => {
    go(lockIcon, { opacity: "1", animation: "lockShake 0.5s ease forwards" });
  }, t); t += 500;

  // 12) ê²½ê³  í…ìŠ¤íŠ¸
  setTimeout(() => {
    go(warning, { transition: "opacity 0.3s ease", opacity: "0.9" });
  }, t); t += 400;

  // 13) HIDDEN ROUND ë°°ì§€
  setTimeout(() => {
    go(badge, { animation: "badgePop 0.5s cubic-bezier(0.34,1.6,0.64,1) forwards", opacity: "1" });
  }, t); t += 550;

  // 14) íƒ€ì´í•‘
  setTimeout(() => {
    const typeText = "HIDDEN ROUND ACTIVATED";
    cursor.style.display = "inline-block";
    let i = 0;
    const iv = setInterval(() => {
      if (i < typeText.length) {
        typing.textContent += typeText[i++];
      } else {
        clearInterval(iv);
        setTimeout(() => { cursor.style.display = "none"; }, 400);
      }
    }, 50);
  }, t); t += typeLength(22, 50) + 450;

  // 15) ê¸€ìë³„ ë¶ˆê½ƒ ì†Œí™˜ + ì°©ì§€ ì§„ë™
  setTimeout(() => {
    const parts = [
      { text: "ğŸ«¸ğŸ»", type: "white" },
      { text: "5",   type: "fire"  },
      { text: "ë¼",  type: "fire"  },
      { text: "ìš´",  type: "fire"  },
      { text: "ë“œ",  type: "fire"  },
      { text: " ",   type: "white" },
      { text: "ê³µ",  type: "fire"  },
      { text: "ê°œ",  type: "fire"  },
      { text: "ğŸ«·ğŸ»", type: "white" },
    ];
    mainTitle.innerHTML = "";
    mainTitle.style.opacity = "1";
    const tilts = [-8, 12, -8, 10, -6, 0, 8, -10, 8];
    parts.forEach((p, i) => {
      const span = document.createElement("span");
      span.className = "cs-char " + p.type;
      span.textContent = p.text;
      span.style.setProperty("--tilt", (tilts[i]||0) + "deg");
      mainTitle.appendChild(span);
      setTimeout(() => {
        span.style.animation = "charRise 0.55s cubic-bezier(0.22,1,0.36,1) forwards";
        // ì°©ì§€ í›„ fire ê¸€ì ì”ê´‘ ìœ ì§€
        if (p.type === "fire") {
          setTimeout(() => span.classList.add("risen"), 520);
        }
      }, i * 60);
    });
  }, t); t += parts_duration(9, 60, 600);

  function parts_duration(count, interval, animDur) { return count * interval + animDur + 80; }

  // 16) ë¶€ì œ
  setTimeout(() => {
    subtitle.style.transform = "translateY(6px)";
    go(subtitle, { transition: "opacity 0.5s ease, transform 0.5s ease", opacity: "0.85" });
    requestAnimationFrame(() => { subtitle.style.transform = "translateY(0)"; });
  }, t); t += 1400;

  // 17) í˜ì´ë“œì•„ì›ƒ
  setTimeout(() => {
    go(fadeout, { transition: "opacity 0.5s ease", opacity: "1" });
    // ë¶ˆê½ƒ ì •ë¦¬
    setTimeout(() => { embers.innerHTML = ""; }, 400);
  }, t); t += 600;

  // 18) ì¢…ë£Œ
  setTimeout(() => {
    cs.style.display = "none";
    cs.classList.remove("bars-in");
    cutscenePlaying = false;
    if (onComplete) onComplete();
  }, t);
}

function typeLength(chars, interval) { return chars * interval; }



function revealR5Badges() {
  const badges = document.querySelectorAll(".rs-badge.rs-r5");
  // ê³µê°œ ì‹œì ì— ì‹¤ì œë¡œ ì ìˆ˜ê°€ ë“¤ì–´ì˜¨ ë°°ì§€ë“¤ ì¤‘ max ê³„ì‚°
  const scores = Array.from(badges).map(el => {
    const v = (el.dataset.score || "").trim();
    return (v !== "" && v !== "-" && !isNaN(Number(v))) ? Number(v) : null;
  });
  const validScores = scores.filter(v => v !== null);
  const maxScore5 = validScores.length ? Math.max(...validScores) : null;

  badges.forEach((el, i) => {
    const scoreVal = scores[i];
    // ì‹¤ì œ ì ìˆ˜ê°€ ìˆê³ (0í¬í•¨) maxScore5ë‘ ì¼ì¹˜í•  ë•Œë§Œ 1ë“± ì´í™íŠ¸
    const isFirst = maxScore5 !== null && scoreVal !== null && scoreVal === maxScore5;
    if (isFirst) el.classList.add("rs-r5-first");
    else el.classList.remove("rs-r5-first");
    el.classList.remove("r3-impact", "r3-done", "r5-first-impact", "r5-first-done");
    el.style.display = "";
    el.style.opacity = "0";
    setTimeout(() => {
      el.style.opacity = "";
      requestAnimationFrame(() => requestAnimationFrame(() => {
        if (isFirst) {
          el.classList.add("r3-impact");
          setTimeout(() => {
            el.classList.remove("r3-impact");
            el.classList.add("r5-first-impact");
            setTimeout(() => {
              el.classList.remove("r5-first-impact");
              el.classList.add("r5-first-done");
              spawnCrownParticles(el);
            }, 600);
          }, 750);
        } else {
          el.classList.add("r3-impact");
          setTimeout(() => {
            el.classList.remove("r3-impact");
            el.classList.add("r3-done");
          }, 750);
        }
      }));
    }, i * 110);
  });
}

function spawnCrownParticles(badgeEl) {
  const rect = badgeEl.getBoundingClientRect();
  const panelRect = document.querySelector(".panel").getBoundingClientRect();
  const cx = rect.left - panelRect.left + rect.width / 2;
  const cy = rect.top - panelRect.top + rect.height / 2;
  const panel = document.querySelector(".panel");
  const emojis = ["ğŸ‘‘","âœ¨","â­","ğŸŒŸ","ğŸ’›","ğŸ‘‘","âœ¨","ğŸŒŸ"];
  emojis.forEach((em, idx) => {
    const span = document.createElement("div");
    span.textContent = em;
    const angle = (idx / emojis.length) * Math.PI * 2;
    const dist = 55 + Math.random() * 35;
    const tx = Math.cos(angle) * dist;
    const ty = Math.sin(angle) * dist - 20;
    span.style.cssText = `position:absolute;left:${cx}px;top:${cy}px;font-size:${14 + Math.random()*10}px;pointer-events:none;z-index:9999;transform:translate(-50%,-50%) scale(0);animation:crownParticle 1.1s ${idx*60}ms cubic-bezier(0.22,1,0.36,1) forwards;--tx:${tx}px;--ty:${ty}px;`;
    panel.appendChild(span);
    setTimeout(() => span.remove(), 1800);
  });
}


function hideR5Badges() {
  document.querySelectorAll(".rs-badge.rs-r5").forEach(el => {
    el.style.display = "none";
    el.classList.remove("r3-impact", "r3-done", "r5-first-impact", "r5-first-done", "locked", "decoding", "decoded");
  });
}

function toggleRound5() {
  if (round5Revealed) {
    round5Revealed = false;
    document.getElementById("lockBtn").textContent = "ğŸ”’";
    hideR5Badges();
  } else {
    playCutscene(() => {
      round5Revealed = true;
      document.getElementById("lockBtn").textContent = "ğŸ”“";
      revealR5Badges();
    });
  }
}



// ê²Œì´ì§€ë°”ì™€ ìºë¦­í„°ê°€ ì™„ì „íˆ ë™ì¼í•œ easing/durationì„ ì“°ë„ë¡ ê³µìœ 
function easeFinish(t) {
  // ì•ë¶€ë¶„ ì²œì²œíˆ, ë’¤ë¡œ ê°ˆìˆ˜ë¡ ê°€ì†
  if (t < 0.6) return (t / 0.6) * 0.12;
  const t2 = (t - 0.6) / 0.4;
  return 0.12 + 0.88 * (t2 * t2 * t2);
}

function animateRunnerToEnd(runnerEl, duration, onDone) {
  const startTime = performance.now();
  function step(now) {
    const t = Math.min((now - startTime) / duration, 1);
    const progress = easeFinish(t);
    runnerEl.style.left = (progress * 100) + "%";
    if (t < 1) requestAnimationFrame(step);
    else if (onDone) onDone();
  }
  requestAnimationFrame(step);
}

function animateGaugeFill(fillEl, duration, onDone) {
  const startTime = performance.now();
  function step(now) {
    const t = Math.min((now - startTime) / duration, 1);
    const progress = easeFinish(t);
    fillEl.style.width = (progress * 100) + "%";
    if (t < 1) requestAnimationFrame(step);
    else if (onDone) onDone();
  }
  requestAnimationFrame(step);
}

// fgo ì˜¤ë²„ë ˆì´ìš© (CSS transition í™œìš©)
function animateFgoGauge(fillEl, charImg, duration) {
  // CSS transitionìœ¼ë¡œ ì²˜ë¦¬ - í•œ í”„ë ˆì„ ë’¤ì— width/left ë³€ê²½
  requestAnimationFrame(() => requestAnimationFrame(() => {
    fillEl.style.width = "100%";
    charImg.style.left = "calc(100% - 60px)";
  }));
}

function applyFinishEffects(winnerName) {
  if (finishApplied) return;
  finishApplied = true;

  // ëª¨ë“  ë‹¬ë¦¬ê¸° ì• ë‹ˆë©”ì´ì…˜ ì¤‘ì§€
  Object.keys(activeAnims).forEach(k => {
    if (k === "__celeb__") return;
    clearInterval(activeAnims[k]);
    delete activeAnims[k];
  });

  // 1ë“± ì œì™¸í•œ í”Œë ˆì´ì–´ë§Œ frozen
  document.querySelectorAll(".avatar-img").forEach(el => {
    // avatar_0ì´ 1ë“±ì´ë¯€ë¡œ frozen ì²˜ë¦¬ (ë‚˜ì¤‘ì— _finishRevealRunnerì—ì„œ í•´ì œ)
    el.classList.add("frozen");
  });
  document.querySelectorAll(".runner-icon").forEach(el => {
    // is-first runnerëŠ” frozen ì²˜ë¦¬í•˜ë˜ ë‚˜ì¤‘ì— _finishRevealRunnerì—ì„œ í•´ì œ
    el.classList.add("frozen");
  });

  // ì»·ì”¬ ëë‚˜ë©´ í˜¸ì¶œ: ë°”ê¹¥ 1ë“± ê³¨ì¸ ìœ„ì¹˜ + êº„ë¥µ í¬ì¦ˆ + ê²Œì´ì§€ 100%
  const fill1 = document.querySelector(".track-fill.fill-1");
  const firstRunner = document.querySelector(".runner-icon.is-first");

  window._finishRevealRunner = function() {
    // ê²Œì´ì§€ 100%ë¡œ
    if (fill1) {
      fill1.classList.add("finish-glow");
      fill1.style.transition = "width 0.5s ease";
      fill1.style.width = "100%";
      const trackWrap = fill1.closest(".track-wrap");
      if (trackWrap) trackWrap.classList.add("finish-active");
    }
    // 1ë“± runner frozen ì™„ì „ í•´ì œ + ê³¨ì¸ ìœ„ì¹˜ + êº„ë¥µ í¬ì¦ˆ
    if (firstRunner) {
      firstRunner.classList.remove("frozen");
      firstRunner.classList.add("finish-runner");
      firstRunner.style.left = "100%";
      firstRunner.style.opacity = "1";
      const runnerImg = firstRunner.querySelector("img");
      if (runnerImg) {
        runnerImg.style.opacity = "1";
        runnerImg.style.filter = "drop-shadow(0 2px 4px rgba(0,0,0,0.8))";
        if (STREAMERS[winnerName]) {
          let cFrame = 0;
          runnerImg.src = buildUrl(winnerName, "A05", cFrame, "E09");
          const ci = setInterval(() => {
            cFrame = (cFrame + 1) % 2;
            runnerImg.src = buildUrl(winnerName, "A05", cFrame, "E09");
          }, 300);
          const key = "runner_cheer_" + winnerName;
          if (activeAnims[key]) clearInterval(activeAnims[key]);
          activeAnims[key] = ci;
        }
      }
    }
    // 1ë“± ì•„ë°”íƒ€ frozen ì™„ì „ í•´ì œ + ì„ ëª…í•˜ê²Œ ë³µêµ¬
    const winnerAvatar = document.getElementById("avatar_0");
    if (winnerAvatar && winnerName) {
      winnerAvatar.classList.remove("frozen");
      winnerAvatar.style.opacity = "1";
      winnerAvatar.style.filter = "drop-shadow(0 1px 4px rgba(0,0,0,0.6))";
      startAvatarAnim(winnerAvatar, winnerName, 1, 0, true);
    }
    // 2~7ë“± ì•„ë°”íƒ€ & runner: ë°˜íˆ¬ëª… + í‘ë°± ëª…ì‹œ ê³ ì •
    document.querySelectorAll(".avatar-img.frozen").forEach(el => {
      el.style.opacity = "0.35";
      el.style.filter = "drop-shadow(0 1px 4px rgba(0,0,0,0.6)) grayscale(0.8)";
    });
    document.querySelectorAll(".runner-icon.frozen img").forEach(el => {
      el.style.opacity = "0.3";
      el.style.filter = "drop-shadow(0 2px 4px rgba(0,0,0,0.8)) grayscale(0.8)";
    });
  };
}

function clearFinishEffects() {
  finishTriggered = false;
  finishApplied = false;
  window._finishRevealRunner = null;
  document.querySelectorAll(".track-fill").forEach(el => {
    el.classList.remove("finish-glow");
    el.style.transition = "";
  });
  document.querySelectorAll(".track-wrap").forEach(el => el.classList.remove("finish-active"));
  document.querySelectorAll(".runner-icon").forEach(el => {
    el.classList.remove("frozen", "finish-runner");
    el.style.opacity = "";
  });
  document.querySelectorAll(".avatar-img").forEach(el => el.classList.remove("frozen"));
  document.querySelectorAll(".gauge-sweep").forEach(el => el.remove());
}

function playDrumroll(onReveal) {
  const overlay  = document.getElementById("drumrollOverlay");
  const bg       = document.getElementById("drumrollBg");
  const vignette = document.getElementById("drumrollVignette");
  const flash    = document.getElementById("drumrollFlash");
  const text     = document.getElementById("drumrollText");
  const qmark    = document.getElementById("drumrollQmark");
  const label    = document.getElementById("drumrollLabel");
  const barFill  = document.getElementById("drumrollBarFill");
  const bar      = document.getElementById("drumrollBar");

  overlay.classList.add("active");

  // ë°°ê²½ ì–´ë‘ 
  setTimeout(() => { bg.style.opacity = "0.75"; }, 30);

  // íŠ¸ë¡œí”¼ + ë¼ë²¨ ë“±ì¥
  setTimeout(() => {
    text.style.opacity = "1";
    text.style.transition = "opacity 0.3s ease";
    qmark.style.animation = "qmarkPulse 0.8s ease-in-out infinite";
    label.style.transition = "opacity 0.4s ease 0.2s";
    label.style.opacity = "1";
    bar.style.transition = "opacity 0.3s ease";
    bar.style.opacity = "1";
  }, 400);

  // ë‘êµ¬ë‘êµ¬ â€” ë°•ìë§ˆë‹¤ flash + vignette í„ìŠ¤
  // ì ì  ë¹¨ë¼ì§€ëŠ” ê°„ê²©: 600â†’500â†’420â†’360â†’300â†’240â†’180â†’120ms
  const beats = [600, 500, 420, 360, 300, 240, 180, 120, 90, 70, 55, 45];
  let elapsed = 500; // ì‹œì‘ ë”œë ˆì´
  const totalDuration = beats.reduce((a, b) => a + b, 0);
  let accumulated = 0;

  beats.forEach((interval, i) => {
    setTimeout(() => {
      // í”Œë˜ì‹œ
      flash.style.animation = "none";
      void flash.offsetWidth;
      flash.style.animation = `drumFlash ${Math.max(interval * 0.8, 60)}ms ease-out forwards`;

      // ë¹„ë„¤íŠ¸ í„ìŠ¤
      vignette.style.animation = "none";
      void vignette.offsetWidth;
      vignette.style.animation = `vignetteThump ${Math.max(interval * 0.9, 80)}ms ease-out forwards`;

      // ì§„í–‰ ë°”
      accumulated += interval;
      barFill.style.width = (accumulated / totalDuration * 100) + "%";

      // íŠ¸ë¡œí”¼ ì ì  í”ë“¤ê¸°
      qmark.style.transform = `scale(${1 + i * 0.015})`;

      // ë§ˆì§€ë§‰ ëª‡ ë°•ì€ í™”ë©´ë„ ì‚´ì§ í”ë“¤ê¸°
      if (i >= beats.length - 4) {
        const panel = document.getElementById("panel");
        const amt = (i - beats.length + 5) * 3;
        panel.style.transform = `translate(${(Math.random()-0.5)*amt}px, ${(Math.random()-0.5)*amt}px)`;
        setTimeout(() => { panel.style.transform = ""; }, interval * 0.5);
      }
    }, elapsed);
    elapsed += interval;
  });

  // í´ë¼ì´ë§¥ìŠ¤ â€” ì „ì²´ í™”ë©´ í°ë¹› í­ë°œ í›„ ê³µê°œ
  setTimeout(() => {
    // ìµœì¢… í”Œë˜ì‹œ
    bg.style.background = "#fff";
    bg.style.opacity = "1";
    setTimeout(() => {
      overlay.classList.remove("active");
      bg.style.background = "#000";
      bg.style.opacity = "0";
      text.style.opacity = "0";
      bar.style.opacity = "0";
      barFill.style.width = "0%";
      qmark.style.transform = "";
      qmark.style.animation = "";
      label.style.opacity = "0";
      if (onReveal) onReveal();
    }, 120);
  }, elapsed);
}

function playFinishGaugeScene(winnerName, onComplete) {
  const overlay     = document.getElementById("finishGaugeOverlay");
  const fgoTitle    = document.getElementById("fgoTitle");
  const fgoRoundLbl = document.getElementById("fgoRoundLabel");
  const fgoAllRaces = document.getElementById("fgoAllRaces");

  const raceRows = Array.from(document.querySelectorAll(".race-row"));
  if (!raceRows.length) { if (onComplete) onComplete(); return; }

  // â”€â”€ ë°ì´í„° ìˆ˜ì§‘ â”€â”€
  const players = [];
  raceRows.forEach(row => {
    const nameEl   = row.querySelector(".streamer-name");
    const fillEl   = row.querySelector(".track-fill");
    const runnerEl = row.querySelector(".runner-icon");
    if (!nameEl || !fillEl) return;
    const sname   = (nameEl.dataset && nameEl.dataset.sname) || nameEl.textContent.trim();
    const isFirst = runnerEl && runnerEl.classList.contains("is-first");
    const badges  = Array.from(row.querySelectorAll(".rs-badge"));
    const scores  = [];
    badges.forEach((b, bi) => {
      if (bi >= 5) return;
      const v = b.querySelector(".rs-v");
      const n = v ? parseFloat(v.textContent) : NaN;
      scores.push(isNaN(n) ? 0 : n);
    });
    while (scores.length < 5) scores.push(0);
    players.push({ sname, isFirst, scores });
  });
  if (!players.length) { if (onComplete) onComplete(); return; }

  // â”€â”€ ë¼ìš´ë“œë³„ ëˆ„ì ì ìˆ˜ â†’ ê²Œì´ì§€ ìœ„ì¹˜(%) ê³„ì‚° â”€â”€
  // 5ë¼ìš´ë“œ ëˆ„ì  ìµœëŒ€ê°’ = ì „ì²´ íŠ¸ë™ ê¸¸ì´ ê¸°ì¤€
  const NUM_ROUNDS = 5;
  const totals = players.map(p => p.scores.reduce((a,b)=>a+b, 0));
  const globalMax = Math.max(...totals, 1);

  const cumScores = players.map(p => {
    let cum = 0;
    return p.scores.map(s => { cum += s; return cum; });
  });

  // ê²Œì´ì§€ ìœ„ì¹˜: 0~100% ë²”ìœ„ (1ë“±ì€ ìµœì¢…ì— ì •í™•íˆ 100%)
  const winnerIdx = players.findIndex(p => p.isFirst);
  function toPct(cum, maxCum) {
    if (maxCum <= 0) return 0;
    return Math.min(100, Math.max(0, (cum / maxCum) * 100));
  }
  // ê° ë¼ìš´ë“œ ë‹¨ê³„ë³„ ê²Œì´ì§€ ìœ„ì¹˜
  // roundGauge[pi][r] = rë¼ìš´ë“œê¹Œì§€ ëˆ„ì  í›„ ê²Œì´ì§€%
  const roundGauge = players.map((_, pi) =>
    cumScores[pi].map(cum => toPct(cum, globalMax))
  );

  // â”€â”€ ë¼ìš´ë“œ ê²½ê³„ ë§ˆì»¤ ìœ„ì¹˜ ê³„ì‚° â”€â”€
  // ê° ë¼ìš´ë“œ ë ì‹œì ì˜ 1ë“± ê²Œì´ì§€ ìœ„ì¹˜ë¥¼ ë§ˆì»¤ë¡œ ì‚¬ìš©
  // (1ë“±ì´ ì—†ìœ¼ë©´ í‰ê· )
  const markerPcts = [];
  for (let r = 0; r < NUM_ROUNDS; r++) {
    if (winnerIdx >= 0) {
      markerPcts.push(roundGauge[winnerIdx][r]);
    } else {
      const avg = players.reduce((s,_,pi) => s+roundGauge[pi][r], 0) / players.length;
      markerPcts.push(avg);
    }
  }
  const ROUND_LABELS = ["1ë¼ìš´ë“œ","2ë¼ìš´ë“œ","3ë¼ìš´ë“œ","4ë¼ìš´ë“œ","5ë¼ìš´ë“œ"];

  // â”€â”€ UI êµ¬ì„± â”€â”€
  fgoTitle.textContent = "";
  fgoRoundLbl.textContent = "";
  fgoAllRaces.innerHTML = "";

  // ë§ˆì»¤ ë¼ë²¨ í–‰ (ê²Œì´ì§€ ìœ„ì— í‘œì‹œë  ê³µìœ  ë¼ë²¨ë°”) - ì²« ë²ˆì§¸ í–‰ ìœ„ì— ë¶™ì„
  // ê° í–‰ì˜ íŠ¸ë™ ìœ„ì— ë§ˆì»¤+ë¼ë²¨ì„ ì§ì ‘ ë Œë”ë§

  const runnerDivs   = [];
  const runnerImgs   = [];
  const fillDivs     = [];
  const runIntervals = [];
  const crownEls     = [];

  const TRACK_H  = 11;
  const ROW_H    = 60;
  const CHAR_W   = 240;
  const CHAR_H   = 260;
  const NAME_W   = 52;

  players.forEach((pl, pi) => {
    const miniRow = document.createElement("div");
    miniRow.style.cssText =
      `display:flex;align-items:center;gap:6px;height:${ROW_H}px;position:relative;`;

    const nameSpan = document.createElement("span");
    nameSpan.textContent = pl.sname;
    nameSpan.style.cssText =
      `font-size:12px;font-weight:900;`+
      `color:${pl.isFirst?"#ffd700":"#ffb3b3"};`+
      `width:${NAME_W}px;flex-shrink:0;text-align:right;white-space:nowrap;`+
      `overflow:hidden;text-overflow:ellipsis;`+
      `font-family:'Pretendard','Noto Sans KR',sans-serif;`+
      `text-shadow:${pl.isFirst?"0 0 8px rgba(255,200,0,0.7)":"1px 1px 0 rgba(0,0,0,0.8)"};`;

    const trackWrap = document.createElement("div");
    trackWrap.style.cssText = "position:relative;flex:1;height:100%;overflow:visible;";

    const trackBg = document.createElement("div");
    trackBg.style.cssText =
      `position:absolute;top:50%;transform:translateY(-50%);`+
      `left:0;right:0;height:${TRACK_H}px;background:#100808;`+
      `border-radius:5px;border:1px solid #4a1010;overflow:hidden;`+
      (pl.isFirst ? "animation:trackBgFlash 0.55s ease-in-out infinite;" : "");

    const fillDiv = document.createElement("div");
    fillDiv.style.cssText = `height:100%;width:0%;border-radius:5px;`;
    if (pl.isFirst) {
      fillDiv.style.background = "linear-gradient(90deg,#aa0000,#ff0000,#ff3333,#ff0000,#aa0000)";
      fillDiv.style.boxShadow  = "0 0 4px 1px rgba(255,0,0,0.85),0 0 8px 3px rgba(255,0,0,0.4)";
      fillDiv.style.animation  = "neonRedPulse 1.5s ease-in-out infinite";
    } else {
      fillDiv.style.background = "linear-gradient(90deg,#3a0808,#6b0000)";
    }
    trackBg.appendChild(fillDiv);
    fillDivs.push(fillDiv);

    // ê²°ìŠ¹ì„ 
    const finishLine = document.createElement("div");
    finishLine.style.cssText =
      `position:absolute;right:0;top:-4px;bottom:-4px;width:4px;`+
      `background:repeating-linear-gradient(180deg,#fff 0,#fff 2px,#111 2px,#111 4px);`+
      `border-radius:0 5px 5px 0;opacity:0.6;z-index:2;pointer-events:none;`;
    trackBg.appendChild(finishLine);
    trackWrap.appendChild(trackBg);

    // ëŸ¬ë„ˆ ì»¨í…Œì´ë„ˆ - íŠ¸ë™ ìœ„ì— ì˜¬ë¼íƒ€ë„ë¡
    const runnerDiv = document.createElement("div");
    runnerDiv.style.cssText =
      `position:absolute;top:50%;left:0%;`+
      `transform:translate(-50%,-100%);`+
      `width:${Math.round(CHAR_W*0.18)}px;height:${Math.round(CHAR_H*0.22)}px;`+
      `z-index:10;pointer-events:none;`;
    runnerDivs.push(runnerDiv);

    const runnerImg = document.createElement("img");
    // ì „ì› ë™ì¼í•œ ì„ ëª…ë„ - filter ë™ì¼ ì ìš©
    runnerImg.style.cssText =
      `position:absolute;top:50%;left:50%;`+
      `width:${CHAR_W}px;height:${CHAR_H}px;`+
      `object-fit:contain;`+
      `transform:translate(-50%,-50%) scaleX(-1);`+
      `filter:drop-shadow(0 2px 4px rgba(0,0,0,0.8));`;
    if (STREAMERS[pl.sname]) runnerImg.src = buildUrl(pl.sname, "A02", 0, "E00");
    runnerDiv.appendChild(runnerImg);
    runnerImgs.push(runnerImg);

    // ë‹¬ë¦¬ê¸° í”„ë ˆì„ì€ runChronicleì—ì„œ ì†ë„ë¹„ë¡€ë¡œ ì§ì ‘ ê´€ë¦¬
    runIntervals.push(null);

    // ì™•ê´€ (1ë“±ìš©)
    const crownEl = document.createElement("span");
    crownEl.style.cssText =
      `position:absolute;top:-30px;left:50%;`+
      `font-size:20px;transform:translateX(-50%) scale(0);`+
      `opacity:0;pointer-events:none;z-index:20;line-height:1;`;
    crownEl.textContent = "ğŸ‘‘";
    runnerDiv.appendChild(crownEl);
    crownEls.push(pl.isFirst ? crownEl : null);

    trackWrap.appendChild(runnerDiv);
    miniRow.appendChild(nameSpan);
    miniRow.appendChild(trackWrap);
    fgoAllRaces.appendChild(miniRow);
  });

  overlay.classList.add("active");

  // â”€â”€ ì‹¤ì‹œê°„ ì—°ì† ë‹¬ë¦¬ê¸° ì• ë‹ˆë©”ì´ì…˜ â”€â”€
  // í•µì‹¬: ì ˆëŒ€ ë’¤ë¡œ ê°€ì§€ ì•ŠìŒ.
  // ê° í”Œë ˆì´ì–´ì˜ í‚¤í”„ë ˆì„ì„ "ì „ì²´ ìµœì¢… ìµœëŒ€ê°’" ê¸°ì¤€ìœ¼ë¡œ ê³ ì •í•´ì„œ
  // ì–´ë–¤ ì‹œì ì—ë„ ì•ìœ¼ë¡œë§Œ ì´ë™. ì—­ì „ì€ ìì—°ìŠ¤ëŸ½ê²Œ í‘œí˜„ë¨.
  const TOTAL_MS       = 6600;
  const FINAL_PAUSE_MS = 1000;
  let animCancelled    = false;

  // globalMax = ìµœì¢… ëˆ„ì  ìµœëŒ€ê°’ (ì´ë¯¸ ê³„ì‚°ë¨)
  // í‚¤í”„ë ˆì„: [0%, R1ëˆ„ì /globalMax%, R2ëˆ„ì /globalMax%, ..., R5/globalMax%]
  // â†’ ì ˆëŒ€ ê°ì†Œí•˜ì§€ ì•ŠìŒ (ëˆ„ì ì ìˆ˜ëŠ” ë‹¨ì¡°ì¦ê°€)
  // â†’ ë¼ìš´ë“œë³„ ìƒëŒ€ì  ì•ë’¤ê°€ ì ìˆ˜ì— ë”°ë¼ ìì—°ìŠ¤ëŸ½ê²Œ í‘œí˜„ë¨
  const keyframesAbs = players.map((pl, pi) => {
    const kf = [0];
    for (let r = 0; r < NUM_ROUNDS; r++) {
      const pct = pl.isFirst && r === NUM_ROUNDS - 1
        ? 100
        : Math.min(100, (cumScores[pi][r] / globalMax) * 100);
      kf.push(pct);
    }
    return kf; // [0, R1%, R2%, R3%, R4%, R5%]
  });

  // ê° êµ¬ê°„ ì‚¬ì´ë¥¼ ì„ í˜• ë³´ê°„ (ë“±ì† - ë¹™íŒ ì—†ìŒ)
  function getPctAtT(pi, t) {
    const kf   = keyframesAbs[pi];
    const segs = NUM_ROUNDS; // 5êµ¬ê°„
    const pos  = t * segs;
    const seg  = Math.min(Math.floor(pos), segs - 1);
    const frac = pos - seg;
    // linear: ê·¸ëŒ€ë¡œ ë³´ê°„ â†’ êµ¬ê°„ ê²½ê³„ì—ì„œ ì†ë„ ë³€í™”ë§Œí¼ ìì—°ìŠ¤ëŸ½ê²Œ ì „í™˜
    return kf[seg] + (kf[seg + 1] - kf[seg]) * frac;
  }

  // ê° í”Œë ˆì´ì–´ë³„ í˜„ì¬ êµ¬ê°„ ì†ë„(pct/s) ê³„ì‚°ìš©
  function getSegSpeed(pi, t) {
    const kf   = keyframesAbs[pi];
    const segs = NUM_ROUNDS;
    const pos  = t * segs;
    const seg  = Math.min(Math.floor(pos), segs - 1);
    // ì´ êµ¬ê°„ì—ì„œ ì´ë™í•˜ëŠ” % / êµ¬ê°„ ì‹œê°„(ms)
    const segDelta = kf[seg + 1] - kf[seg];
    const segDurMs = TOTAL_MS / segs;
    return segDelta / segDurMs; // %/ms
  }

  // ë‹¬ë¦¬ê¸° í”„ë ˆì„ ì¸í„°ë²Œ: ì†ë„ì— ë°˜ë¹„ë¡€ (ë¹ ë¥¼ìˆ˜ë¡ ì§§ê²Œ)
  // ê¸°ì¤€: 100%ë¥¼ TOTAL_MSì— ë‹¬ë¦¬ë©´ 200ms/frame
  // ë°œ ì• ë‹ˆë©”ì´ì…˜: setIntervalë¡œ í•­ìƒ ì¼ì •í•˜ê²Œ (rAFì™€ ë¶„ë¦¬)
  const FRAME_INTERVAL_MS = 220;
  const runFrameTimers = players.map(() => ({ frame: 0, iv: null }));

  function runChronicle() {
    const t0 = performance.now();

    // ë°œ í”„ë ˆì„: ê° í”Œë ˆì´ì–´ë³„ ë…ë¦½ setInterval - ì ˆëŒ€ ë©ˆì¶”ì§€ ì•ŠìŒ
    players.forEach((pl, pi) => {
      if (!STREAMERS[pl.sname]) return;
      const ft = runFrameTimers[pi];
      ft.iv = setInterval(() => {
        ft.frame = (ft.frame + 1) % 4;
        // í•´ë‹¹ ì‹œì  êµ¬ê°„ì˜ ì ìˆ˜ ë¸íƒ€ë¡œ ë°©í–¥ ê²°ì •
        const t_now = Math.min((performance.now() - t0) / TOTAL_MS, 1);
        const kf = keyframesAbs[pi];
        const segs = NUM_ROUNDS;
        const pos = t_now * segs;
        const seg = Math.min(Math.floor(pos), segs - 1);
        const delta = kf[seg + 1] - kf[seg]; // ìŒìˆ˜ë©´ ë’¤ë¡œ
        if (delta < 0) {
          // ë’¤ë¡œ ë‹¬ë¦¬ê¸°: scaleX ë°˜ì „ (ì›ë˜ scaleX(-1)ì´ë¯€ë¡œ 1ë¡œ)
          runnerImgs[pi].style.transform = 'translate(-50%,-50%) scaleX(1)';
        } else {
          runnerImgs[pi].style.transform = 'translate(-50%,-50%) scaleX(-1)';
        }
        runnerImgs[pi].src = buildUrl(pl.sname, 'A02', ft.frame, 'E00');
      }, FRAME_INTERVAL_MS);
    });

    function step(now) {
      if (animCancelled) {
        runFrameTimers.forEach(ft => { if (ft.iv) { clearInterval(ft.iv); ft.iv = null; } });
        return;
      }
      const t = Math.min((now - t0) / TOTAL_MS, 1);
      players.forEach((_, pi) => {
        const pct = getPctAtT(pi, t);
        fillDivs[pi].style.width  = pct + '%';
        runnerDivs[pi].style.left = pct + '%';
      });
      if (t < 1) requestAnimationFrame(step);
      else {
        runFrameTimers.forEach(ft => { if (ft.iv) { clearInterval(ft.iv); ft.iv = null; } });
        onGoal();
      }
    }
    requestAnimationFrame(step);
  }
  function onGoal() {
    if (animCancelled) return;
    fgoRoundLbl.textContent = "";

    // ë‹¬ë¦¬ê¸° ì¤‘ì§€ â†’ ëª¨ë‘ í˜„ì¬ í”„ë ˆì„ ê³ ì •
    runIntervals.forEach(iv => { if (iv) clearInterval(iv); });

    // 1ë“± êº„ë¥µ í¬ì¦ˆ
    players.forEach((pl, pi) => {
      if (pl.isFirst && STREAMERS[pl.sname]) {
        let cf = 0;
        runnerImgs[pi].src = buildUrl(pl.sname, "A05", cf, "E09");
        const ci = setInterval(() => {
          cf = (cf+1) % 2;
          runnerImgs[pi].src = buildUrl(pl.sname, "A05", cf, "E09");
        }, 300);
        setTimeout(() => clearInterval(ci), FINAL_PAUSE_MS + 500);
      }
    });

    // ì™•ê´€ ë“±ì¥
    crownEls.forEach((el) => {
      if (!el) return;
      el.style.cssText =
        `position:absolute;top:-28px;left:50%;font-size:20px;`+
        `pointer-events:none;z-index:20;line-height:1;opacity:1;`+
        `transform:translateX(-50%) scale(0);`+
        `animation:crownBounceIn 0.6s cubic-bezier(0.34,1.5,0.64,1) forwards;`;
      setTimeout(() => {
        el.style.animation = "crownFloat 0.9s ease-in-out infinite";
        el.style.opacity   = "1";
        el.style.transform = "translateX(-50%)";
      }, 700);
    });

    setTimeout(() => {
      if (animCancelled) return;
      overlay.style.transition = "opacity 0.4s ease";
      overlay.style.opacity    = "0";
      setTimeout(() => {
        overlay.classList.remove("active");
        overlay.style.opacity    = "";
        overlay.style.transition = "";
        animCancelled = true;
        if (window._finishRevealRunner) {
          window._finishRevealRunner();
          window._finishRevealRunner = null;
        }
        if (onComplete) onComplete();
      }, 420);
    }, FINAL_PAUSE_MS);
  }

  setTimeout(runChronicle, 400);
}

function triggerFinish() {
  if (celebActive) {
    celebActive = false;
    clearInterval(window._celebInterval);
    clearTimeout(celebTimer);
    stopCelebAnim();
    document.getElementById("celebOverlay").classList.remove("active");
    document.getElementById("finishGaugeOverlay").classList.remove("active");
    document.getElementById("finishBtn").classList.remove("active");
    document.getElementById("finishBtn").textContent = "ğŸ† ì™„ì£¼!";
    document.querySelectorAll(".particle").forEach(p => p.remove());
    document.querySelectorAll(".rs-badge").forEach(el => el.style.animationPlayState = "");
    clearFinishEffects();
    return;
  }

  celebActive = true;
  finishTriggered = true;
  finishApplied = false;
  document.getElementById("finishBtn").classList.add("active");
  document.getElementById("finishBtn").textContent = "â¹ ì¢…ë£Œ";

  document.querySelectorAll(".rs-badge.r5-first-done, .rs-badge.r3-done")
    .forEach(el => el.style.animationPlayState = "paused");

  // â‘  ë‘êµ¬ë‘êµ¬ ì‹œì‘
  playDrumroll(() => {
    if (!celebActive) return;

    // â‘¡ ë‘êµ¬ë‘êµ¬ ë â†’ ê²Œì´ì§€ í’€ìƒ· ì»·ì”¬ + ë°”ê¹¥ ê²Œì´ì§€ ë™ì‹œ ì‹œì‘
    applyFinishEffects(currentFirstName);
    playFinishGaugeScene(currentFirstName, () => {
      if (!celebActive) return;

      // â‘¢ ìš°ìŠ¹ì ê³µê°œ
      document.getElementById("celebWinner").textContent = currentFirstName || "";
      startCelebAnim(currentFirstName);
      document.getElementById("celebOverlay").classList.add("active");
      spawnFlyingChars();
      spawnBurst();
      window._celebInterval = setInterval(() => { if (celebActive) spawnBurst(); }, 600);
      celebTimer = setTimeout(() => {
        celebActive = false;
        clearInterval(window._celebInterval);
        stopCelebAnim();
        document.getElementById("celebOverlay").classList.remove("active");
        document.getElementById("finishBtn").classList.remove("active");
        document.getElementById("finishBtn").textContent = "ğŸ† ì™„ì£¼!";
        document.querySelectorAll(".particle").forEach(p => p.remove());
        document.querySelectorAll(".rs-badge").forEach(el => el.style.animationPlayState = "");
      }, 15000);
    });
  });
}

function spawnFlyingChars() {
  const overlay = document.getElementById("celebOverlay");
  const overlayH = overlay.offsetHeight;
  const overlayW = overlay.offsetWidth;

  const targets = [];
  for (let i = 1; i <= 10; i++) {
    const el = document.getElementById("avatar_" + i);
    if (el) targets.push(el);
  }
  const count = targets.length;
  if (count === 0) return;

  const cx = overlayW / 2;
  const cy = overlayH / 2;
  const radius = Math.min(overlayW, overlayH) * 0.32; // ê³µì „ ë°˜ì§€ë¦„
  const CHAR_SIZE = 360;
  const ORBIT_MS  = 5500;  // ê³µì „ ì‹œê°„ ëŠë¦¬ê²Œ
  const STAY_EXTRA = 1200;  // ë‹¤ ëª¨ì¸ í›„ ì ê¹ ë” ë„ëŠ” ì‹œê°„
  const orbitImgs = [];

  targets.forEach((avatarEl, idx) => {
    const sname = avatarEl.dataset.sname || "";
    const angleOffset = (idx / count) * Math.PI * 2; // ê· ë“± ë°°ì¹˜

    const img = document.createElement("img");
    img.dataset.angle = angleOffset;
    img.dataset.sname = sname;
    const src = sname && STREAMERS[sname]
      ? buildUrl(sname, "A40", 0, "E03")  // ê¼´ë“± í¬ì¦ˆ
      : avatarEl.src;
    img.src = src;

    img.style.cssText =
      "position:absolute;" +
      "width:" + CHAR_SIZE + "px;height:" + CHAR_SIZE + "px;" +
      "object-fit:contain;" +
      "pointer-events:none;z-index:10002;" +
      "opacity:0;" +
      "transform:translate(-50%,-50%) scaleX(-1);" +
      "transition:opacity 0.3s ease;";
    overlay.appendChild(img);
    orbitImgs.push(img);

    // ìˆœì°¨ ë“±ì¥
    setTimeout(() => { img.style.opacity = "1"; }, idx * 150);
  });

  // â”€â”€ ê³µì „ ë£¨í”„ â”€â”€
  const startTime = performance.now();
  let orbitRunning = true;
  const BASE_SPEED = (Math.PI * 2) / (ORBIT_MS); // 1ë°”í€´/ORBIT_MS

  function orbitStep(now) {
    if (!orbitRunning) return;
    const elapsed = now - startTime;
    // ì²˜ìŒì—” ëŠë¦¬ê²Œ, ì ì  ì‚´ì§ ë¹¨ë¼ì§€ëŠ” ëŠë‚Œ
    const speedMult = Math.min(1 + elapsed / 4000, 1.5);
    const angle = elapsed * BASE_SPEED * speedMult;

    orbitImgs.forEach((img, idx) => {
      const a = angle + (idx / count) * Math.PI * 2;
      const x = cx + Math.cos(a) * radius;
      const y = cy + Math.sin(a) * radius * 0.55; // íƒ€ì›í˜• (ìœ„ì•„ë˜ ë‚©ì‘)
      img.style.left = x + "px";
      img.style.top  = y + "px";
      // ì˜¤ë¥¸ìª½ ì ˆë°˜ì€ ë’¤ì§‘ê¸° (ë‹¬ë¦¬ëŠ” ë°©í–¥ ì „í™˜)
      const facingRight = Math.cos(a) > 0;
      img.style.transform = "translate(-50%,-50%) scaleX(" + (facingRight ? 1 : -1) + ")";
    });
    requestAnimationFrame(orbitStep);
  }
  requestAnimationFrame(orbitStep);

  // â”€â”€ ê³µì „ ë â†’ ì›ì‹¬ë ¥ìœ¼ë¡œ íŠ•ê²¨ë‚˜ê°€ê¸° â”€â”€
  const totalOrbitMs = ORBIT_MS + STAY_EXTRA + targets.length * 150;
  setTimeout(() => {
    orbitRunning = false;

    orbitImgs.forEach((img, idx) => {
      // í˜„ì¬ ìœ„ì¹˜ ê¸°ì¤€ ì›ì‹¬ ë°©í–¥ìœ¼ë¡œ ë‚ ì•„ê°€ê¸°
      const curLeft = parseFloat(img.style.left) || cx;
      const curTop  = parseFloat(img.style.top)  || cy;
      const dx = curLeft - cx;
      const dy = curTop  - cy;
      const dist = Math.sqrt(dx*dx + dy*dy) || 1;
      const flyDist = 320 + rand(60, 140);
      const fx = (dx / dist) * flyDist;
      const fy = (dy / dist) * flyDist;
      const fr = rand(-45, 45);
      const fd = rand(0.7, 1.1);

      img.style.transition = "none";
      img.style.animation  =
        "orbitFlyOut " + fd + "s " + (idx * 0.07) + "s cubic-bezier(0.4,0,1,1) both";
      img.style.setProperty("--fx", fx + "px");
      img.style.setProperty("--fy", fy + "px");
      img.style.setProperty("--fr", fr + "deg");

      setTimeout(() => img.remove(), (fd + idx * 0.07) * 1000 + 400);
    });
  }, totalOrbitMs);
}

function rand(min, max) { return Math.random() * (max - min) + min; }

function spawnBurst() {
  const overlay = document.getElementById("celebOverlay");
  const W = overlay.offsetWidth, H = overlay.offsetHeight;
  const fwColors = ["#ff0000","#ff4040","#ff8080","#ff2020","#ffaaaa","#cc0000","#ff6060","#fff"];
  [{x:W*0.15,y:H*0.2},{x:W*0.5,y:H*0.08},{x:W*0.85,y:H*0.2},{x:W*rand(0.1,0.9),y:H*rand(0.05,0.3)}]
  .forEach(spot => {
    for (let i = 0; i < Math.floor(rand(8,16)); i++) {
      const el = document.createElement("div"); el.className = "particle firework";
      const angle = rand(0,360)*Math.PI/180, dist = rand(30,100), dur = rand(0.5,1.1);
      el.style.cssText = "left:"+spot.x+"px;top:"+spot.y+"px;background:"+fwColors[Math.floor(rand(0,fwColors.length))]+";--tx:"+Math.cos(angle)*dist+"px;--ty:"+Math.sin(angle)*dist+"px;--dur:"+dur+"s;width:"+rand(3,7)+"px;height:"+rand(3,7)+"px;";
      overlay.appendChild(el); setTimeout(() => el.remove(), dur*1000+100);
    }
  });
  const mesoEmojis = ["ğŸª™","ğŸ’°","â­","âœ¨","ğŸŒŸ","ğŸ’«","ğŸ’µ","ğŸŸ¡","ğŸ‘‘","ğŸ†","ğŸ’›"];
  for (let i = 0; i < Math.floor(rand(6,12)); i++) {
    const el = document.createElement("div"); el.className = "particle meso";
    const dur = rand(1.0,2.0);
    el.style.cssText = "left:"+rand(0,W)+"px;top:-16px;--fall:"+rand(H*0.5,H*0.95)+"px;--rot:"+rand(-360,360)+"deg;--dur:"+dur+"s;animation-delay:"+rand(0,0.3)+"s;";
    el.textContent = mesoEmojis[Math.floor(rand(0,mesoEmojis.length))];
    overlay.appendChild(el); setTimeout(() => el.remove(), (dur+0.4)*1000);
  }
  for (let i = 0; i < Math.floor(rand(4,8)); i++) {
    const el = document.createElement("div"); el.className = "particle sparkle";
    const dur = rand(0.7,1.4);
    el.style.cssText = "left:"+rand(0,W)+"px;top:"+rand(H*0.1,H*0.7)+"px;--mx:"+rand(-60,60)+"px;--my:"+rand(-60,10)+"px;--dur:"+dur+"s;";
    el.textContent = ["âœ¨","â­","ğŸ’«","ğŸŒŸ","ğŸ’µ","ğŸŸ¡","ğŸ‘‘","ğŸ†","ğŸ’›","ğŸ’°","ğŸª™"][Math.floor(rand(0,4))];
    overlay.appendChild(el); setTimeout(() => el.remove(), dur*1000+100);
  }
}

function getRoundBest(data, key) {
  const valid = data.filter(r => {
    const v = r[key];
    return v !== undefined && v !== null && v !== "" && v !== "-" && !isNaN(Number(v));
  });
  if (!valid.length) return { name: "-", pt: "" };
  const best = valid.reduce((b, r) => Number(r[key]) > Number(b[key]) ? r : b);
  const pt = Number(best[key]);
  return { name: best["ğŸ™ï¸ìŠ¤íŠ¸ë¦¬ë¨¸"] || "-", pt: pt.toLocaleString() };
}

function render(data) {
  if (!data || !data.length) {
    document.getElementById("raceSection").innerHTML = "<div class='empty'>ğŸ˜¶ ë°ì´í„° ì—†ìŒ</div>";
    const _rs = document.getElementById("roundSummary"); if (_rs) _rs.style.display = "none";
    return;
  }
  data.sort((a, b) => Number(b["ğŸ“ìµœì¢… ì ìˆ˜"]) - Number(a["ğŸ“ìµœì¢… ì ìˆ˜"]));
  data = data.slice(0, 7);

  // ë™ì  ì²˜ë¦¬: ê°™ì€ ì ìˆ˜ë©´ ê°™ì€ ë“±ìˆ˜ ë¶€ì—¬
  const rankMap = [];
  let currentRank = 1;
  for (let i = 0; i < data.length; i++) {
    if (i > 0 && Number(data[i]["ğŸ“ìµœì¢… ì ìˆ˜"]) === Number(data[i-1]["ğŸ“ìµœì¢… ì ìˆ˜"])) {
      rankMap.push(rankMap[i-1]);
    } else {
      currentRank = i + 1;
      rankMap.push(currentRank);
    }
  }
  const json = JSON.stringify(data);

  if (json === prevJSON) return;

  if (finishTriggered) {
    clearFinishEffects();
    if (celebActive) {
      celebActive = false;
      clearInterval(window._celebInterval);
      clearTimeout(celebTimer);
      stopCelebAnim();
      document.getElementById("celebOverlay").classList.remove("active");
      document.getElementById("finishBtn").classList.remove("active");
      document.getElementById("finishBtn").textContent = "ğŸ† ì™„ì£¼!";
      document.querySelectorAll(".particle").forEach(p => p.remove());
    }
  }

  prevJSON = json;
  currentFirstName = data[0]["ğŸ™ï¸ìŠ¤íŠ¸ë¦¬ë¨¸"] || "";

  const _allScores = data.map(r => Number(r["ğŸ“ìµœì¢… ì ìˆ˜"]) || 0);
  const maxScore = Math.max(..._allScores);
  const minScore = Math.min(..._allScores);

  // ê° ë¼ìš´ë“œ ìµœê³ ì  ê³„ì‚°
  function getRoundMax(key) {
    const vals = data.map(r => {
      const v = r[key];
      if (v === undefined || v === null || v === "" || v === "-") return null;
      const n = Number(v);
      return isNaN(n) ? null : n;
    }).filter(v => v !== null);
    if (!vals.length) return null;
    return Math.max(...vals);
  }
  const max1 = getRoundMax("ğŸ‘‘1ë¼ìš´ë“œ");
  const max2 = getRoundMax("ğŸ‘‘2ë¼ìš´ë“œ");
  const max3 = getRoundMax("ğŸ‘‘3ë¼ìš´ë“œ");
  const max4 = getRoundMax("ğŸ‘‘4ë¼ìš´ë“œ");
  const max5 = getRoundMax("ğŸ‘‘5ë¼ìš´ë“œ");

  const rankFillClasses  = ["fill-1","fill-2","fill-3","fill-o","fill-o","fill-o","fill-o"];
  const rankBadgeClasses = ["rank-1","rank-2","rank-3","rank-other","rank-other","rank-other","rank-other"];
  const section = document.getElementById("raceSection");
  Object.keys(activeAnims).forEach(k => {
    if (k === "__celeb__") return;
    clearInterval(activeAnims[k]);
    delete activeAnims[k];
  });
  section.innerHTML = "";

  data.forEach((row, i) => {
    const rank  = rankMap[i];
    const name  = row["ğŸ™ï¸ìŠ¤íŠ¸ë¦¬ë¨¸"] || "?";
    const total = Number(row["ğŸ“ìµœì¢… ì ìˆ˜"]) || 0;
    const _r1 = row["ğŸ‘‘1ë¼ìš´ë“œ"]; const s1 = (_r1 !== undefined && _r1 !== null && _r1 !== "") ? String(_r1) : "-";
    const _r2 = row["ğŸ‘‘2ë¼ìš´ë“œ"]; const s2 = (_r2 !== undefined && _r2 !== null && _r2 !== "") ? String(_r2) : "-";
    const _r3 = row["ğŸ‘‘3ë¼ìš´ë“œ"]; const s3 = (_r3 !== undefined && _r3 !== null && _r3 !== "") ? String(_r3) : "-";
    const _r4 = row["ğŸ‘‘4ë¼ìš´ë“œ"]; const s4 = (_r4 !== undefined && _r4 !== null && _r4 !== "") ? String(_r4) : "-";
    const _r5 = row["ğŸ‘‘5ë¼ìš´ë“œ"]; const s5 = (_r5 !== undefined && _r5 !== null && _r5 !== "") ? String(_r5) : "-";
    const hasAnyScore = [s1, s2, s3, s4, s5].some(s => s !== "-");
    const e1 = (max1 !== null && s1 !== "-" && Number(s1)===max1) ? 'ğŸ‘‘' : 'ğŸš©';
    const e2 = (max2 !== null && s2 !== "-" && Number(s2)===max2) ? 'ğŸ‘‘' : 'ğŸš©';
    const e3 = (max3 !== null && s3 !== "-" && Number(s3)===max3) ? 'ğŸ‘‘' : 'ğŸš©';
    const e4 = (max4 !== null && s4 !== "-" && Number(s4)===max4) ? 'ğŸ‘‘' : 'ğŸš©';
    const e5 = (max5 !== null && s5 !== "-" && Number(s5)===max5) ? 'ğŸ‘‘' : 'ğŸ';
    const _scoreRange = maxScore - minScore;
    const pct = _scoreRange > 0
      ? Math.min(93, Math.max(5, 5 + ((total - minScore) / _scoreRange) * 88))
      : 5;
    const rankFillClass  = rankFillClasses[Math.min(rank-1, 6)];
    const rankBadgeClass = rankBadgeClasses[Math.min(rank-1, 6)];
    const div = document.createElement("div");
    div.className = "race-row";
    const t1 = (max1 !== null && s1 !== "-" && Number(s1)===max1) ? ' rs-top' : '';
    const t2 = (max2 !== null && s2 !== "-" && Number(s2)===max2) ? ' rs-top' : '';
    const t3 = (max3 !== null && s3 !== "-" && Number(s3)===max3) ? ' rs-top' : '';
    const t4 = (max4 !== null && s4 !== "-" && Number(s4)===max4) ? ' rs-top' : '';
    const t5 = (max5 !== null && s5 !== "-" && Number(s5)===max5) ? ' rs-top' : '';
    div.innerHTML =
      '<div class="race-top">'+
        '<div class="rank-badge '+rankBadgeClass+'">'+rank+'</div>'+
        '<div class="avatar-wrap"><img class="avatar-img" id="avatar_'+i+'" data-sname="'+name+'" src="" alt=""></div>'+
        '<div class="name-score">'+
          '<span class="streamer-name" data-sname="'+name+'">'+name+'</span>'+
          '<span style="display:inline-flex;align-items:baseline;gap:0"><span class="score-total">'+total.toLocaleString()+'</span><span class="score-label">pt</span></span>'+
        '</div>'+
        '<div class="round-scores">'+
          '<div class="rs-badge'+t1+'"><div class="rs-r">'+e1+'1ë¼ìš´ë“œ</div><div class="rs-v">'+s1+'</div></div>'+
          '<div class="rs-badge'+t2+'"><div class="rs-r">'+e2+'2ë¼ìš´ë“œ</div><div class="rs-v">'+s2+'</div></div>'+
          '<div class="rs-badge'+t3+'"><div class="rs-r">'+e3+'3ë¼ìš´ë“œ</div><div class="rs-v">'+s3+'</div></div>'+
          '<div class="rs-badge'+t4+'"><div class="rs-r">'+e4+'4ë¼ìš´ë“œ</div><div class="rs-v">'+s4+'</div></div>'+
          (function(){
            const _isTop5 = max5 && Number(s5)===max5;
            const _doneClass = round5Revealed ? (_isTop5 ? ' r5-first-done' : ' r3-done') : '';
            return '<div class="rs-badge rs-r5'+(_isTop5 ? ' rs-r5-first' : '')+_doneClass+'" data-score="'+s5+'" style="'+(round5Revealed ? '' : 'display:none')+'"><div class="rs-r">'+e5+'5ë¼ìš´ë“œ</div><div class="rs-v">'+s5+'</div></div>';
          })()+
        '</div>'+
      '</div>'+
      '<div class="track-wrap">'+
        '<div class="track-bg">'+
          '<div class="track-fill '+rankFillClass+'" style="width:'+pct+'%"></div>'+
          '<div class="finish-line"></div>'+
        '</div>'+
        '<div class="runner-icon'+(rank===1?' is-first':'')+'" style="left:'+pct+'%">'+
          '<img id="runner_'+i+'" src="" alt="">'+
        '</div>'+
      '</div>';
    section.appendChild(div);
    if (i < data.length-1) {
      const hr = document.createElement("div"); hr.className = "row-divider"; section.appendChild(hr);
    }
    startAvatarAnim(document.getElementById("avatar_"+i), name, rank, total, hasAnyScore);
    startRunnerAnim(document.getElementById("runner_"+i), name);
  });
  if (data.length >= 7 && typeof startBgCrackAnim === "function") startBgCrackAnim();
}

async function fetchData() {
  const url = "https://script.google.com/macros/s/AKfycbwOCpa65clcNPDIOdkAkO-ZHxmhokuEUmWYTDFcVI3KH-Hws9Wz4c9WMTRQvQJF5jJ6gg/exec?t=" + Date.now();
  try {
    const res = await fetch(url);
    const data = await res.json();
    render(data);
  } catch(e) {
    document.getElementById("raceSection").innerHTML = "<div class='empty'>ğŸ˜¢ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div>";
  }
}

fetchData();
setInterval(fetchData, 5000);

// â”€â”€ ë°°ê²½ ì¶©ëŒ ê· ì—´ ì• ë‹ˆë©”ì´ì…˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function () {
  const canvas = document.getElementById("bgCrackCanvas");
  const ctx    = canvas.getContext("2d");
  let running  = false;
  let raf      = null;
  const cracks = [];

  // 7ëª… ìƒ‰ìƒ
  const COLORS = [
    "#ff3300", // ë¹¨ê°•
    "#ff9900", // ì£¼í™©
    "#ffdd00", // ë…¸ë‘
    "#44ff66", // ì´ˆë¡
    "#44ccff", // í•˜ëŠ˜
    "#8844ff", // ë³´ë¼
    "#ff44bb", // í•‘í¬
  ];

  function resize() {
    const p = document.getElementById("panel");
    canvas.width  = p.offsetWidth;
    canvas.height = p.offsetHeight;
  }

  // ê· ì—´ ìƒì„±
  function genCrack(cx, cy) {
    const arms = [];
    const numArms = 3 + Math.floor(Math.random() * 5);
    for (let i = 0; i < numArms; i++) {
      const angle  = (Math.PI * 2 / numArms) * i + (Math.random() - 0.5) * 0.5;
      const length = 40 + Math.random() * 130;
      const pts    = [{x: cx, y: cy}];
      let x = cx, y = cy, a = angle;
      const n = 5 + Math.floor(Math.random() * 6);
      for (let s = 0; s < n; s++) {
        const kink = Math.random() < 0.18
          ? (Math.random() - 0.5) * 0.8
          : (Math.random() - 0.5) * 0.12;
        a += kink;
        const segLen = (length / n) * (0.85 + Math.random() * 0.3);
        x += Math.cos(a) * segLen;
        y += Math.sin(a) * segLen;
        pts.push({x, y});
        if (Math.random() < 0.28 && s > 1 && s < n - 1) {
          const sa  = a + (Math.random() > 0.5 ? 1 : -1) * (0.4 + Math.random() * 0.5);
          const sl  = length * (0.12 + Math.random() * 0.22);
          const subPts = [{x, y}, {x: x + Math.cos(sa)*sl, y: y + Math.sin(sa)*sl}];
          arms.push({ pts: subPts, sub: true, w: 0.5 + Math.random() * 0.5 });
        }
      }
      arms.push({ pts, sub: false, w: 1.0 + Math.random() * 1.5 });
    }
    // ì¶©ê²©ì  ì£¼ë³€ ì½˜í¬ë¦¬íŠ¸ íŒŒí¸ ì¡°ê° (ì§§ì€ ì„ ë¶„ë“¤)
    const chips = [];
    const chipCount = 3 + Math.floor(Math.random() * 5);
    for (let i = 0; i < chipCount; i++) {
      const ca  = Math.random() * Math.PI * 2;
      const cr  = 3 + Math.random() * 9;
      const cl  = 4 + Math.random() * 10;
      const ca2 = ca + (Math.random() - 0.5) * 1.0;
      chips.push({
        x1: cx + Math.cos(ca)  * cr,
        y1: cy + Math.sin(ca)  * cr,
        x2: cx + Math.cos(ca2) * (cr + cl),
        y2: cy + Math.sin(ca2) * (cr + cl),
      });
    }
    return { cx, cy, arms, chips, alpha: 0, target: 0.6 + Math.random() * 0.35 };
  }

  function drawCrack(c) {
    if (c.alpha <= 0) return;

    for (const arm of c.arms) {
      const pts = arm.pts;
      if (pts.length < 2) continue;
      const w = arm.w;
      const a = c.alpha * (arm.sub ? 0.4 : 1);

      // êµµì€ ë°°ê²½ìƒ‰ ê³„ì—´ - íŒŒì¸ ëŠë‚Œ (ì–´ë‘ìš´ ì£¼í™© ë°˜íˆ¬ëª…)
      ctx.globalAlpha = a * 0.2;
      ctx.strokeStyle = arm.sub ? "rgba(80,35,0,0.4)" : "rgba(110,50,0,0.45)";
      ctx.lineWidth   = w * 2.8;
      ctx.lineCap     = "round";
      ctx.lineJoin    = "round";
      ctx.beginPath();
      ctx.moveTo(pts[0].x, pts[0].y);
      for (let i = 1; i < pts.length; i++) ctx.lineTo(pts[i].x, pts[i].y);
      ctx.stroke();

      // ê°€ëŠ” ì½”ì–´ - ì—°í•œ ì£¼í™© ê· ì—´ì„ 
      ctx.globalAlpha = a * 0.35;
      ctx.strokeStyle = arm.sub ? "rgba(255,160,60,0.45)" : "rgba(255,185,70,0.55)";
      ctx.lineWidth   = w * 0.9;
      ctx.beginPath();
      ctx.moveTo(pts[0].x, pts[0].y);
      for (let i = 1; i < pts.length; i++) ctx.lineTo(pts[i].x, pts[i].y);
      ctx.stroke();
    }

    // íŒŒí¸ ì¡°ê°
    if (c.chips) {
      for (const ch of c.chips) {
        ctx.globalAlpha = c.alpha * 0.4;
        ctx.strokeStyle = "rgba(200,100,0,0.7)";
        ctx.lineWidth   = 1.5;
        ctx.lineCap     = "round";
        ctx.beginPath(); ctx.moveTo(ch.x1, ch.y1); ctx.lineTo(ch.x2, ch.y2); ctx.stroke();
      }
    }

    ctx.globalAlpha = 1;
  }

  // â”€â”€ ì¶©ëŒ ì´í™íŠ¸: í”¼ë§› + ì½˜í¬ë¦¬íŠ¸ íŒŒí¸ + ë¨¼ì§€ â”€â”€
  const impactEffects = [];

  function spawnImpactEffect(cx, cy, colors) {
    const now = performance.now();

    // â”€â”€ í•ë°©ìš¸: ëˆˆë¬¼ ëª¨ì–‘, ì¤‘ë ¥ ë°›ì•„ ë–¨ì–´ì§ â”€â”€
    const drops = [];
    for (let i = 0; i < 28; i++) {
      const angle = Math.random() * Math.PI * 2;
      const spd   = 80 + Math.random() * 220;
      const r     = 2 + Math.random() * 5;
      drops.push({
        x: cx, y: cy,
        vx: Math.cos(angle) * spd,
        vy: Math.sin(angle) * spd - 60, // ì´ˆë°˜ì—” ìœ„ë¡œ íŠ€ì—ˆë‹¤ê°€
        r,
        life: 0.4 + Math.random() * 0.7,
        trail: [],
      });
    }

    // â”€â”€ í•ì¤„ê¸°: ì¶©ëŒì ì—ì„œ ë°©ì‚¬í˜•ìœ¼ë¡œ ë»—ëŠ” ì–‡ì€ ì„  â”€â”€
    const streaks = [];
    for (let i = 0; i < 14; i++) {
      const angle = Math.random() * Math.PI * 2;
      const len   = 30 + Math.random() * 90;
      const kink  = (Math.random() - 0.5) * 0.6; // ì•½ê°„ êº¾ì„
      streaks.push({ angle, len, kink, life: 0.3 + Math.random() * 0.4 });
    }

    // â”€â”€ ì½˜í¬ë¦¬íŠ¸ íŒŒí¸: ì‚¬ê°í˜• ë©ì–´ë¦¬ â”€â”€
    const chunks = [];
    for (let i = 0; i < 18; i++) {
      const angle = Math.random() * Math.PI * 2;
      const spd   = 60 + Math.random() * 160;
      chunks.push({
        x: cx, y: cy,
        vx: Math.cos(angle) * spd,
        vy: Math.sin(angle) * spd - 40,
        rot: Math.random() * Math.PI * 2,
        rotV: (Math.random() - 0.5) * 18,
        w: 4 + Math.random() * 10,
        h: 3 + Math.random() * 7,
        life: 0.5 + Math.random() * 0.6,
      });
    }

    // â”€â”€ ë¨¼ì§€ êµ¬ë¦„: ëŠë¦¬ê²Œ í¼ì§€ëŠ” ì›ë“¤ â”€â”€
    const dusts = [];
    for (let i = 0; i < 10; i++) {
      const angle = Math.random() * Math.PI * 2;
      const spd   = 20 + Math.random() * 50;
      dusts.push({
        x: cx + (Math.random() - 0.5) * 20,
        y: cy + (Math.random() - 0.5) * 20,
        vx: Math.cos(angle) * spd,
        vy: Math.sin(angle) * spd - 15,
        r: 8 + Math.random() * 20,
        maxR: 30 + Math.random() * 50,
        life: 0.6 + Math.random() * 0.5,
      });
    }

    impactEffects.push({
      born: now, totalDur: 900,
      cx, cy, drops, streaks, chunks, dusts
    });
  }

  function drawImpactEffects(now) {
    for (let ei = impactEffects.length - 1; ei >= 0; ei--) {
      const ef = impactEffects[ei];
      const t  = (now - ef.born) / ef.totalDur;
      if (t >= 1) { impactEffects.splice(ei, 1); continue; }
      const sec = t * ef.totalDur * 0.001; // ì´ˆ ë‹¨ìœ„

      // â”€â”€ ì§™ì€ ë¶‰ì€ í”Œë˜ì‹œ + í”¼ ë²ˆì§ â”€â”€
      if (t < 0.2) {
        const fa = (1 - t / 0.2);
        ctx.globalAlpha = fa * 0.88;
        const fg = ctx.createRadialGradient(ef.cx, ef.cy, 0, ef.cx, ef.cy, 80 + 50 * t);
        fg.addColorStop(0,   "rgba(180,0,0,1)");
        fg.addColorStop(0.4, "rgba(100,0,0,0.7)");
        fg.addColorStop(1,   "rgba(40,0,0,0)");
        ctx.fillStyle = fg;
        ctx.beginPath(); ctx.arc(ef.cx, ef.cy, 130 + 80 * t, 0, Math.PI * 2); ctx.fill();
      }

      // â”€â”€ í•ì¤„ê¸°: ì¶©ëŒì ì—ì„œ ì„ ì´ ë¹ ë¥´ê²Œ ë»—ìŒ â”€â”€
      for (const sk of ef.streaks) {
        const st = t / sk.life;
        if (st >= 1) continue;
        const eased = 1 - Math.pow(1 - Math.min(st * 3, 1), 2);
        const drawLen = sk.len * eased;
        const ex = ef.cx + Math.cos(sk.angle + sk.kink) * drawLen;
        const ey = ef.cy + Math.sin(sk.angle + sk.kink) * drawLen;
        ctx.globalAlpha = (1 - st) * 0.85;
        ctx.strokeStyle = "rgba(140,0,0,0.9)";
        ctx.lineWidth   = 1.5 + (1 - st) * 1.5;
        ctx.lineCap     = "round";
        ctx.beginPath();
        ctx.moveTo(ef.cx, ef.cy);
        // ì¤‘ê°„ êº¾ì„ì 
        const mx = ef.cx + Math.cos(sk.angle) * drawLen * 0.5;
        const my = ef.cy + Math.sin(sk.angle) * drawLen * 0.5;
        ctx.quadraticCurveTo(mx + Math.cos(sk.angle + Math.PI/2) * sk.kink * 20,
                             my + Math.sin(sk.angle + Math.PI/2) * sk.kink * 20, ex, ey);
        ctx.stroke();
        // ë ë°©ìš¸
        if (st > 0.4) {
          const dropR = (1 - st) * 3.5;
          ctx.globalAlpha = (1 - st) * 0.8;
          ctx.fillStyle   = "rgba(160,0,0,0.9)";
          ctx.beginPath(); ctx.arc(ex, ey, dropR, 0, Math.PI * 2); ctx.fill();
        }
      }

      // â”€â”€ í•ë°©ìš¸: í¬ë¬¼ì„ ìœ¼ë¡œ íŠ€ê¸°ë©° ì¤‘ë ¥ â”€â”€
      for (const dp of ef.drops) {
        const st = t / dp.life;
        if (st >= 1) continue;
        const gravity = 400;
        const px = dp.x + dp.vx * sec;
        const py = dp.y + dp.vy * sec + 0.5 * gravity * sec * sec;
        const fa = (1 - st) * 0.9;

        ctx.globalAlpha = fa;
        ctx.fillStyle   = "rgba(150,0,0,0.95)";
        // ëˆˆë¬¼ë°©ìš¸ ëª¨ì–‘: íƒ€ì›ìœ¼ë¡œ ê·¼ì‚¬
        ctx.beginPath();
        ctx.ellipse(px, py, dp.r * 0.7, dp.r, 0, 0, Math.PI * 2);
        ctx.fill();
        // ë°ì€ í•˜ì´ë¼ì´íŠ¸
        ctx.globalAlpha = fa * 0.4;
        ctx.fillStyle   = "rgba(220,30,30,0.8)";
        ctx.beginPath();
        ctx.ellipse(px - dp.r * 0.15, py - dp.r * 0.2, dp.r * 0.25, dp.r * 0.3, 0, 0, Math.PI * 2);
        ctx.fill();
      }

      // â”€â”€ ì½˜í¬ë¦¬íŠ¸ íŒŒí¸ â”€â”€
      for (const ck of ef.chunks) {
        const st = t / ck.life;
        if (st >= 1) continue;
        const gravity = 300;
        const px  = ck.x + ck.vx * sec;
        const py  = ck.y + ck.vy * sec + 0.5 * gravity * sec * sec;
        const rot = ck.rot + ck.rotV * sec;
        ctx.globalAlpha = (1 - st) * 0.85;
        ctx.save();
        ctx.translate(px, py);
        ctx.rotate(rot);
        ctx.fillStyle   = "rgba(30,5,5,0.9)";
        ctx.fillRect(-ck.w/2, -ck.h/2, ck.w, ck.h);
        // íŒŒí¸ í…Œë‘ë¦¬ (ì•½ê°„ ë°ê²Œ)
        ctx.strokeStyle = "rgba(80,10,10,0.7)";
        ctx.lineWidth   = 0.7;
        ctx.strokeRect(-ck.w/2, -ck.h/2, ck.w, ck.h);
        ctx.restore();
      }

      // â”€â”€ ë¨¼ì§€/ì—°ê¸° êµ¬ë¦„ â”€â”€
      for (const du of ef.dusts) {
        const st = t / du.life;
        if (st >= 1) continue;
        const px   = du.x + du.vx * sec;
        const py   = du.y + du.vy * sec;
        const r    = du.r + (du.maxR - du.r) * st; // ì»¤ì§€ë©´ì„œ
        const fa   = (1 - st) * 0.18;
        ctx.globalAlpha = fa;
        const dg = ctx.createRadialGradient(px, py, 0, px, py, r);
        dg.addColorStop(0, "rgba(60,5,5,0.6)");
        dg.addColorStop(1, "rgba(20,0,0,0)");
        ctx.fillStyle = dg;
        ctx.beginPath(); ctx.arc(px, py, r, 0, Math.PI * 2); ctx.fill();
      }

      ctx.globalAlpha = 1;
    }
  }

  function drawParticle(p, alpha) {
    if (!p) return;
    for (let i = 0; i < p.trail.length; i++) {
      const tf = i / p.trail.length;
      const tr = p.trail[i];
      ctx.globalAlpha = tf * tf * 0.35 * alpha;
      ctx.fillStyle   = p.color;
      ctx.beginPath();
      ctx.arc(tr.x, tr.y, 3 + tf * 10, 0, Math.PI * 2);
      ctx.fill();
    }
    ctx.globalAlpha = alpha;
    const g = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, 28);
    g.addColorStop(0,   "#ffffff");
    g.addColorStop(0.3, p.color);
    g.addColorStop(1,   "transparent");
    ctx.fillStyle = g;
    ctx.beginPath(); ctx.arc(p.x, p.y, 28, 0, Math.PI * 2); ctx.fill();
    ctx.globalAlpha = 1;
  }

  // â”€â”€ 7ê°œ ì¶©ëŒì²´: ë³´ì´ì§€ ì•Šì§€ë§Œ ë¡œì§ì€ ì‚´ì•„ìˆìŒ â”€â”€
  const APPROACH_MS = 900;
  const IMPACT_MS   = 300;
  const RESET_MS    = 800;
  const WAIT_MS     = 20000;

  let phase  = "waiting";
  let phaseT = 0;
  let particles = [];
  let meetX = 0, meetY = 0;
  let lastNow = 0;

  function randomEdgePoint(W, H) {
    const edge = Math.floor(Math.random() * 4);
    if (edge === 0) return { x: 0, y: Math.random() * H };
    if (edge === 1) return { x: W, y: Math.random() * H };
    if (edge === 2) return { x: Math.random() * W, y: 0 };
                    return { x: Math.random() * W, y: H };
  }

  function startApproach() {
    const W = canvas.width, H = canvas.height;
    meetX = W * (0.2 + Math.random() * 0.6);
    meetY = H * (0.2 + Math.random() * 0.6);
    particles = COLORS.map((color) => {
      const start = randomEdgePoint(W, H);
      return { x: start.x, y: start.y, sx: start.x, sy: start.y, color, trail: [] };
    });
    phase = "approach"; phaseT = 0;
  }

  function lerp(a, b, t) { return a + (b - a) * t; }

  function spawnCracks(mx, my) {
    const count = 2 + Math.floor(Math.random() * 4);
    const spots = [{ cx: mx, cy: my }];
    for (let i = 1; i < count; i++) {
      spots.push({
        cx: mx + (Math.random() - 0.5) * canvas.width  * 0.55,
        cy: my + (Math.random() - 0.5) * canvas.height * 0.55,
      });
    }
    spots.forEach(({ cx, cy }) => {
      const ccx = Math.max(20, Math.min(canvas.width  - 20, cx));
      const ccy = Math.max(20, Math.min(canvas.height - 20, cy));
      const cr  = genCrack(ccx, ccy);
      cr.bornAt  = performance.now();
      cr.fadeDur = 120 + Math.random() * 200;
      cracks.push(cr);
    });
  }

  function tick(now) {
    raf = requestAnimationFrame(tick);
    if (!running) return;
    const dt = Math.min(now - lastNow, 50);
    lastNow  = now;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (const c of cracks) {
      if (c.alpha < c.target) {
        c.alpha = Math.min((now - c.bornAt) / c.fadeDur, 1) * c.target;
      }
      drawCrack(c);
    }

    phaseT += dt;

    if (phase === "waiting") {
      if (phaseT >= WAIT_MS) startApproach();

    } else if (phase === "approach") {
      const raw = phaseT / APPROACH_MS;
      const t   = Math.min(raw, 1);
      const e   = t * t;
      // ì¶©ëŒì²´ ìœ„ì¹˜ë§Œ ì—…ë°ì´íŠ¸, ê·¸ë¦¬ì§€ëŠ” ì•ŠìŒ
      for (const p of particles) {
        p.x = lerp(p.sx, meetX, e);
        p.y = lerp(p.sy, meetY, e);
      }
      if (raw >= 1) {
        phase = "impact"; phaseT = 0;
        spawnCracks(meetX, meetY);
        spawnImpactEffect(meetX, meetY, COLORS);
        particles = [];
      }

    } else if (phase === "impact") {
      if (phaseT / IMPACT_MS >= 1) { phase = "reset"; phaseT = 0; }

    } else if (phase === "reset") {
      if (phaseT >= RESET_MS) { phase = "waiting"; phaseT = 0; }
    }

    drawImpactEffects(now);
  }

  window.startBgCrackAnim = function () {
    if (running) return;
    running = true;
    resize();
    canvas.classList.add("visible");
    lastNow = performance.now();
    requestAnimationFrame(tick);
  };

  window.addEventListener("resize", () => { if (running) resize(); });
})();
</script>
</div>
</body>
</html>
