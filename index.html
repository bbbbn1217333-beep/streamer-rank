<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="referrer" content="no-referrer">
<title>Ïù¥Îùº333Î∞∞ Î©îÏù¥Ìîå Í∞úÎßûÏß± Ïª®ÌÖêÏ∏†</title>
<link rel="icon" href="https://i.postimg.cc/d1w9vSmS/seukeulinsyas-2025-12-18-180217.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: transparent; font-family: 'Noto Sans KR', sans-serif; padding: 5px; width: 630px; }
.panel {
  background: linear-gradient(160deg, #1a0000 0%, #3d0000 40%, #1a0000 100%);
  border-radius: 10px; border: 2px solid #c82a2a;
  box-shadow: 0 0 0 1px #6b0000, 0 0 24px rgba(200,42,42,0.3), inset 0 1px 0 rgba(255,100,100,0.12);
  position: relative; overflow: hidden;
}
.header {
  position: relative; z-index: 10;
  display: flex; align-items: center; justify-content: space-between;
  padding: 2px 12px;
  background: linear-gradient(90deg, transparent, rgba(255,50,50,0.07), transparent);
  border-bottom: 2px solid #6b0000;
}
.header-center {
  display: flex; align-items: center; gap: 6px; flex: 1; justify-content: center;
  pointer-events: none;
}
.header-title {
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: 20px; font-weight: 800; color: #ffb3b3;
  text-shadow: 0 0 10px rgba(255,50,50,0.5), 1px 1px 0 rgba(0,0,0,0.6);
  letter-spacing: 3px;
}
.header-glove { font-size: 20px; display: inline-block; animation: punch 0.6s ease infinite alternate; }
@keyframes punch { from { transform: scale(1) rotate(-15deg); } to { transform: scale(1.2) rotate(10deg); } }
.header-btns {
  display: flex; align-items: center; gap: 5px; flex-shrink: 0;
  position: relative; z-index: 20;
}
.lock-btn {
  background: none; border: none; cursor: pointer;
  font-size: 20px; line-height: 1; padding: 0 2px; transition: transform 0.2s;
}
.lock-btn:hover { transform: scale(1.2); }
.finish-btn {
  background: linear-gradient(135deg, #c70000, #ff4444);
  border: 1px solid #ff8080; border-radius: 5px;
  color: #fff; font-size: 11px; font-weight: 900;
  padding: 3px 8px; cursor: pointer;
  font-family: 'Noto Sans KR', sans-serif;
  transition: all 0.15s; box-shadow: 0 2px 6px rgba(0,0,0,0.4);
}
.finish-btn:hover { transform: scale(1.05); }
.finish-btn.active { background: linear-gradient(135deg, #ff4040, #ff0000); border-color: #ffaaaa; color: #fff; }
.round-summary {
  position: relative; z-index: 1;
  display: flex; gap: 4px; padding: 2px 10px;
  border-bottom: 1px solid rgba(107,0,0,0.5);
}
.round-badge {
  flex: 1; background: rgba(0,0,0,0.3);
  border: 1px solid #6b0000; border-radius: 5px;
  padding: 1px 6px; text-align: center;
}
.round-badge .r-label { font-size: 14px; color: #c82a2a; font-weight: 700; letter-spacing: 0.5px; }
.round-badge .r-winner { display: flex; align-items: center; justify-content: center; gap: 5px; flex-wrap: wrap; }
.round-badge .r-name { font-size: 14px; color: #ffb3b3; font-weight: 900; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 80px; }
.round-badge .r-pt { font-size: 13px; color: #ff6060; font-weight: 900; white-space: nowrap; }
.race-section { position: relative; z-index: 1; padding: 1px 7px 1px; }
.race-row { margin-bottom: 1px; }
@keyframes fadeSlide { from { opacity:0; transform: translateX(-12px); } to { opacity:1; transform: translateX(0); } }
.race-row:nth-child(1)  { animation: fadeSlide 0.3s 0.00s both; }
.race-row:nth-child(3)  { animation: fadeSlide 0.3s 0.04s both; }
.race-row:nth-child(5)  { animation: fadeSlide 0.3s 0.08s both; }
.race-row:nth-child(7)  { animation: fadeSlide 0.3s 0.12s both; }
.race-row:nth-child(9)  { animation: fadeSlide 0.3s 0.16s both; }
.race-row:nth-child(11) { animation: fadeSlide 0.3s 0.20s both; }
.race-row:nth-child(13) { animation: fadeSlide 0.3s 0.24s both; }
.race-top { display: flex; align-items: center; gap: 5px; margin-bottom: 0px; }
.rank-badge {
  width: 24px; height: 24px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 12px; font-weight: 900; flex-shrink: 0; border: 2px solid;
}
.rank-1 { background: radial-gradient(circle, #ff4747, #c70000); color: #fff; border-color: #ff6060; box-shadow: 0 0 8px rgba(255,50,50,0.6); }
.rank-2 { background: radial-gradient(circle, #d0d8e0, #7a8a99); color: #1a2030; border-color: #b0bec5; }
.rank-3 { background: radial-gradient(circle, #f0a070, #a04010); color: #2a0800; border-color: #cd7f32; }
.rank-other { background: rgba(0,0,0,0.4); color: #a06060; border-color: #5a2020; }
.avatar-wrap { position: relative; width: 40px; height: 40px; flex-shrink: 0; }
.avatar-img {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scaleX(-1);
  width: 250px; height: 250px; object-fit: contain;
  image-rendering: auto;
  filter: drop-shadow(0 1px 4px rgba(0,0,0,0.6));
  z-index: 2;
}
.name-score { flex: 1; min-width: 0; display: flex; align-items: center; gap: 5px; }
.streamer-name {
  font-size: 16px; font-weight: 900; color: #ffb3b3;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.8);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 120px;
}
.score-total { font-size: 18px; font-weight: 900; color: #fff; text-shadow: 0 0 6px rgba(255,50,50,0.4); flex-shrink: 0; }
.score-label { font-size: 13px; color: #c82a2a; margin-left: 1px; font-weight: 700; }
.round-scores { display: flex; gap: 3px; margin-left: auto; flex-shrink: 0; }
.rs-badge { background: rgba(0,0,0,0.4); border: 1px solid #5a2020; border-radius: 4px; padding: 1px 7px; text-align: center; min-width: 46px; }
.rs-badge .rs-r { font-size: 11px; color: #c82a2a; font-weight: 700; }
.rs-badge .rs-v { font-size: 18px; color: #ffb3b3; font-weight: 900; }

/* ‚îÄ‚îÄ 3ÎùºÏö¥Îìú Î±ÉÏßÄ ÏûÑÌå©Ìä∏ Ïù¥ÌéôÌä∏ (GPU Í∞ÄÏÜç) ‚îÄ‚îÄ */
.rs-badge.rs-r3 {
  position: relative;
  will-change: transform, opacity;
  overflow: hidden;
}

@keyframes r3FlyIn {
  0%   { transform: translateX(80px) scale(1.8); opacity: 0; filter: blur(4px) brightness(4); }
  45%  { transform: translateX(-5px) scale(0.93); opacity: 1; filter: blur(0) brightness(2.5); }
  62%  { transform: translateX(3px) scale(1.06); filter: brightness(1.8); }
  78%  { transform: translateX(-1px) scale(0.98); filter: brightness(1.3); }
  90%  { transform: translateX(1px) scale(1.01); }
  100% { transform: translateX(0) scale(1); filter: brightness(1); }
}

@keyframes r3Flash {
  0%   { background: rgba(255,60,60,0.8);  border-color: #fff;    box-shadow: 0 0 20px 6px rgba(255,50,50,0.9), 0 0 40px 12px rgba(200,0,0,0.6); }
  25%  { background: rgba(150,0,0,0.7);    border-color: #ff8080; box-shadow: 0 0 14px 4px rgba(255,40,40,0.7); }
  60%  { background: rgba(70,0,0,0.55);    border-color: #ff3333; box-shadow: 0 0 10px 3px rgba(255,30,30,0.55); }
  100% { background: rgba(45,0,0,0.5);     border-color: #ff1f1f; box-shadow: 0 0 7px 2px rgba(255,20,20,0.45), inset 0 0 8px rgba(255,20,20,0.12); }
}

.rs-badge.rs-r3.r3-impact::before {
  content: '';
  position: absolute; left: -10%; right: -10%; top: -2px;
  height: 110%;
  background: linear-gradient(180deg,
    rgba(255,100,100,0.0) 0%,
    rgba(255,80,80,0.5)  45%,
    rgba(255,200,200,0.9) 50%,
    rgba(255,80,80,0.5)  55%,
    rgba(255,100,100,0.0) 100%
  );
  transform: translateY(-100%);
  animation: r3Sweep 0.35s ease-out forwards;
  z-index: 5; pointer-events: none;
}
@keyframes r3Sweep {
  from { transform: translateY(-100%); }
  to   { transform: translateY(200%); }
}

@keyframes r3TextPop {
  0%   { opacity:0; transform:scale(0.4); filter:blur(3px); }
  55%  { opacity:1; transform:scale(1.2); filter:blur(0); }
  80%  { transform:scale(0.96); }
  100% { transform:scale(1); opacity:1; }
}

.rs-badge.rs-r3.r3-impact {
  animation: r3FlyIn 0.5s cubic-bezier(0.22,1,0.36,1) forwards,
             r3Flash 0.7s 0.12s ease forwards;
}
.rs-badge.rs-r3.r3-impact .rs-r { animation: r3TextPop 0.38s 0.18s cubic-bezier(0.34,1.6,0.64,1) both; }
.rs-badge.rs-r3.r3-impact .rs-v { animation: r3TextPop 0.42s 0.25s cubic-bezier(0.34,1.6,0.64,1) both; }

@keyframes r3Sizzle {
  0%,100% { box-shadow: 0 0 7px 2px rgba(255,25,25,0.45), inset 0 0 8px rgba(255,20,20,0.12); }
  40%     { box-shadow: 0 0 11px 3px rgba(255,50,50,0.65), inset 0 0 12px rgba(255,40,40,0.2); }
}
.rs-badge.rs-r3.r3-done {
  border-color: #ff1f1f;
  background: rgba(45,0,0,0.5);
  animation: r3Sizzle 2.2s ease-in-out infinite;
}
.rs-badge.rs-r3.r3-done .rs-r { color: #ff5050; }
.rs-badge.rs-r3.r3-done .rs-v { color: #ffd5d5; text-shadow: 0 0 7px rgba(255,70,70,0.65); }

@keyframes r3BadgeHeaderIn {
  0%   { transform: scaleX(0); opacity:0; filter: blur(4px) brightness(4); }
  50%  { transform: scaleX(1.08); opacity:1; filter: brightness(2.5); }
  70%  { transform: scaleX(0.97); filter: brightness(1.6); }
  85%  { transform: scaleX(1.02); }
  100% { transform: scaleX(1); filter: brightness(1); }
}
#r3badge.r3-header-in {
  animation: r3BadgeHeaderIn 0.55s cubic-bezier(0.22,1,0.36,1) forwards,
             r3Flash 0.65s 0.12s ease forwards;
}
#r3badge.r3-header-done {
  border-color: #ff1f1f !important;
  animation: r3Sizzle 2.5s ease-in-out infinite !important;
}
#r3badge.r3-header-done .r-label { color: #ff5050; text-shadow: 0 0 8px rgba(255,50,50,0.6); }
.track-wrap { position: relative; height: 18px; overflow: visible; }
.track-bg {
  position: absolute; top: 50%; transform: translateY(-50%);
  left: 0; right: 0; height: 9px;
  background: #100808; border-radius: 5px; border: 1px solid #4a1010; overflow: hidden;
}
.track-bg::after {
  content: ''; position: absolute; top: 50%; transform: translateY(-50%);
  left: 0; right: 0; height: 1px;
  background: repeating-linear-gradient(90deg, transparent, transparent 10px, rgba(255,50,50,0.12) 10px, rgba(255,50,50,0.12) 18px);
}
.track-fill {
  position: absolute; top: 0; left: 0; height: 100%; border-radius: 5px;
  transition: width 1s cubic-bezier(0.34,1.3,0.64,1); z-index: 1;
}
.fill-1 { background: linear-gradient(90deg, #c70000, #ff4444, #ff8080); box-shadow: 0 0 4px rgba(255,50,50,0.5); }
.fill-2 { background: linear-gradient(90deg, #5a6a7a, #b0bec5); }
.fill-3 { background: linear-gradient(90deg, #7a3010, #cd7f32); }
.fill-o { background: linear-gradient(90deg, #3a0808, #6b0000); }

@keyframes redFlash {
  0%   { filter: brightness(1) saturate(1); }
  40%  { filter: brightness(3) saturate(2.5); }
  100% { filter: brightness(1.6) saturate(1.8); }
}
.fill-1.finish-glow {
  background: linear-gradient(90deg, #a80000, #ff2222, #ff8080, #ff4444, #ff2222) !important;
  box-shadow:
    0 0 18px 6px rgba(255, 50, 50, 0.95),
    0 0 40px 14px rgba(200, 0, 0, 0.7),
    0 0 70px 24px rgba(255, 0, 0, 0.4) !important;
  animation: redFlash 0.8s ease-out 1 forwards !important;
}

.finish-line { position: absolute; right: 0; top: 0; height: 100%; width: 6px; background: repeating-linear-gradient(90deg, #fff 0px, #fff 2px, #000 2px, #000 4px); border-radius: 0 5px 5px 0; opacity: 0.5; z-index: 2; }
.runner-icon {
  position: absolute; top: 50%; transform: translate(-50%, -100%);
  width: 26px; height: 26px;
  z-index: 10; pointer-events: none;
}
.runner-icon img {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scaleX(-1);
  width: 180px; height: 180px; object-fit: contain;
  image-rendering: auto;
  filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8));
}
.runner-icon.is-first::after {
  content: '‚≠ê'; position: absolute; top: -8px; left: 50%;
  transform: translateX(-50%); font-size: 7px;
  animation: bounce 0.8s ease infinite alternate;
}
@keyframes bounce { from { transform: translateX(-50%) translateY(0); } to { transform: translateX(-50%) translateY(-3px); } }

.avatar-img.frozen { opacity: 0.45; filter: drop-shadow(0 1px 4px rgba(0,0,0,0.6)) grayscale(0.6); }
.runner-icon.frozen img { opacity: 0.4; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8)) grayscale(0.6); }

.row-divider { height: 1px; background: linear-gradient(90deg, transparent, rgba(107,0,0,0.3), transparent); margin-bottom: 1px; }
#celebOverlay {
  display: none; position: absolute; inset: 0;
  pointer-events: none; z-index: 9999; overflow: visible; border-radius: 10px;
}
#celebOverlay.active { display: block; }
#celebOverlay::before { content: ''; position: absolute; inset: 0; background: rgba(0,0,0,0.6); border-radius: 10px; }
.celeb-box {
  position: absolute; top: 53%; left: 50%;
  transform: translate(-50%, -50%);
  display: flex; flex-direction: column; align-items: center; gap: 4px; z-index: 10001;
  width: 100%; padding: 0 10px;
  animation: boxPop 0.5s cubic-bezier(0.34,1.6,0.64,1) both;
  max-height: 100%; overflow: hidden;
}
@keyframes boxPop { from { transform: translate(-50%,-50%) scale(0.3) rotate(-8deg); opacity:0; } to { transform: translate(-50%,-50%) scale(1) rotate(0deg); opacity:1; } }
@keyframes winnerGlow {
  0%   { box-shadow: 0 0 20px rgba(255,50,50,0.9), 0 0 50px rgba(200,0,0,0.5), 0 0 0px rgba(255,100,100,0); border-color: #ff4444; }
  50%  { box-shadow: 0 0 40px rgba(255,80,80,1), 0 0 80px rgba(220,0,0,0.9), 0 0 120px rgba(255,100,100,0.6); border-color: #ffffff; }
  100% { box-shadow: 0 0 20px rgba(255,50,50,0.9), 0 0 50px rgba(200,0,0,0.5), 0 0 0px rgba(255,100,100,0); border-color: #ff4444; }
}
.celeb-char {
  width: min(480px, 70%); height: auto; aspect-ratio: 1/1; object-fit: contain; border-radius: 12px;
  transform: scaleX(-1);
  border: 4px solid #ff4444;
  image-rendering: auto;
  animation: winnerGlow 1.2s ease-in-out infinite;
  flex-shrink: 1;
}
.celeb-title {
  font-size: clamp(22px, 5vw, 40px); font-weight: 800; color: #ffb3b3;
  text-shadow: 0 0 16px rgba(255,50,50,1), 0 0 32px rgba(200,0,0,0.8), 2px 2px 0 #7a0000, 4px 4px 0 rgba(0,0,0,0.5);
  letter-spacing: 4px; white-space: nowrap;
}
.celeb-name {
  font-size: clamp(22px, 5vw, 40px); font-weight: 700; color: #fff;
  text-shadow: 0 0 12px rgba(255,100,100,0.9), 2px 2px 0 rgba(0,0,0,0.8);
  letter-spacing: 2px; white-space: nowrap;
}
.particle { position: absolute; pointer-events: none; z-index: 10000; }
@keyframes flyAway {
  0%   { transform: translate(0,0) rotate(0deg) scale(1); opacity:1; }
  25%  { opacity:1; }
  100% { transform: translate(var(--fx),var(--fy)) rotate(var(--fr)) scale(0.2); opacity:0; }
}
.fly-char {
  position: absolute; pointer-events: none; z-index: 10002;
  animation: flyAway var(--fd) cubic-bezier(0.15,0,0.5,1) forwards;
}
.firework { width: 6px; height: 6px; border-radius: 50%; animation: fwExplode var(--dur) ease-out forwards; }
@keyframes fwExplode { 0% { transform: translate(0,0) scale(1); opacity:1; } 100% { transform: translate(var(--tx),var(--ty)) scale(0); opacity:0; } }
.meso { font-size: 16px; animation: mesoFall var(--dur) ease-in forwards; line-height: 1; }
@keyframes mesoFall { 0% { transform: translateY(0) rotate(0deg) scale(1); opacity:1; } 80% { opacity:1; } 100% { transform: translateY(var(--fall)) rotate(var(--rot)) scale(0.5); opacity:0; } }
.sparkle { font-size: 12px; animation: sparkleFly var(--dur) ease-out forwards; }
@keyframes sparkleFly { 0% { transform: translate(0,0) scale(0) rotate(0deg); opacity:1; } 50% { transform: translate(var(--mx),var(--my)) scale(1.2) rotate(180deg); opacity:1; } 100% { transform: translate(calc(var(--mx)*1.5),calc(var(--my)*1.5 + 30px)) scale(0) rotate(360deg); opacity:0; } }
.footer {
  position: relative; z-index: 1;
  display: flex; align-items: center; justify-content: flex-end;
  padding: 1px 10px 2px; gap: 4px;
}
.live-dot { width: 6px; height: 6px; border-radius: 50%; background: #ff4040; box-shadow: 0 0 6px rgba(255,60,60,0.9); animation: pulse 1.5s ease infinite; }
@keyframes pulse { 0%,100% { opacity:1; transform:scale(1); } 50% { opacity:0.5; transform:scale(0.8); } }
.live-text { font-size: 11px; color: #ff4040; font-weight: 900; letter-spacing: 2px; }
.empty { padding: 14px; text-align: center; color: #6b0000; font-size: 12px; }

/* ==============================
   ÌûàÎì† ÎùºÏö¥Îìú Ïª∑Ïî¨ Ïä§ÌÉÄÏùº
============================== */
#hiddenCutscene {
  display: none;
  position: absolute;
  inset: 0;
  z-index: 99999;
  pointer-events: none;
  overflow: hidden;
  border-radius: 10px;
}
#hiddenCutscene.active {
  display: block;
}

/* Ïñ¥Îë† Î∞∞Í≤Ω */
.cs-backdrop {
  position: absolute; inset: 0;
  background: #000;
  opacity: 0;
  transition: opacity 0.4s ease;
}
#hiddenCutscene.active .cs-backdrop {
  opacity: 1;
}

/* ÏòÅÌôî letterbox Î∞î */
.cs-bar-top, .cs-bar-bottom {
  position: absolute; left: 0; right: 0;
  background: #000;
  height: 0;
  transition: height 0.5s cubic-bezier(0.77,0,0.18,1);
  z-index: 2;
}
.cs-bar-top { top: 0; }
.cs-bar-bottom { bottom: 0; }
#hiddenCutscene.bars-in .cs-bar-top,
#hiddenCutscene.bars-in .cs-bar-bottom {
  height: 18vh;
}

/* Í∑†Ïó¥ SVG Î†àÏù¥Ïñ¥ */
.cs-cracks {
  position: absolute; inset: 0;
  z-index: 3;
  opacity: 0;
}
.cs-cracks.show {
  animation: crackReveal 0.6s ease-out forwards;
}
@keyframes crackReveal {
  0%   { opacity: 0; filter: brightness(3); }
  30%  { opacity: 1; filter: brightness(2); }
  100% { opacity: 1; filter: brightness(1); }
}

/* Í≤ΩÍ≥† ÎπÑÌîÑ ÎùºÏù∏ */
.cs-scanline {
  position: absolute; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, transparent, #ff2222, #ff8888, #ff2222, transparent);
  box-shadow: 0 0 12px rgba(255,30,30,0.8);
  top: 50%;
  opacity: 0;
  z-index: 4;
  transform: scaleX(0);
}
.cs-scanline.show {
  animation: scanlineExpand 0.5s 0.1s cubic-bezier(0.22,1,0.36,1) forwards;
}
@keyframes scanlineExpand {
  0%   { opacity:1; transform: scaleX(0); }
  70%  { opacity:1; transform: scaleX(1.05); }
  100% { opacity:0.7; transform: scaleX(1); }
}

/* Î©îÏù∏ Ïª®ÌÖêÏ∏† Î∞ïÏä§ */
.cs-content {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%) scale(0.95);
  z-index: 10;
  display: flex; flex-direction: column; align-items: center; gap: 12px;
  width: 100%;
  opacity: 0;
  pointer-events: none;
}

/* ??? ÌÖçÏä§Ìä∏ -> 3ÎùºÏö¥Îìú Ï†ÑÌôò */
.cs-mystery {
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: 20px; font-weight: 900; letter-spacing: 8px;
  color: #ff3333;
  text-shadow: 0 0 20px rgba(255,50,50,1), 0 0 40px rgba(255,0,0,0.6);
  text-transform: uppercase;
  position: relative;
}

.cs-title-wrap {
  position: relative; display: flex; align-items: center; justify-content: center;
}

/* Î©îÏù∏ ÌÉÄÏù¥ÌãÄ */
.cs-main-title {
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: clamp(30px, 7vw, 56px);
  font-weight: 900;
  color: #fff;
  letter-spacing: 6px;
  line-height: 1;
  text-align: center;
  opacity: 0;
  clip-path: inset(0 100% 0 0);
}
.cs-main-title.reveal {
  animation: titleWipe 0.8s 0.1s cubic-bezier(0.77,0,0.18,1) forwards;
}
@keyframes titleWipe {
  0%   { opacity:1; clip-path: inset(0 100% 0 0); }
  100% { opacity:1; clip-path: inset(0 0% 0 0); }
}

/* Í∏ÄÎ°úÏö∞ Í∞ïÏ°∞ */
.cs-main-title span.highlight {
  color: #ff3333;
  text-shadow:
    0 0 10px rgba(255,50,50,1),
    0 0 30px rgba(255,0,0,0.9),
    0 0 60px rgba(200,0,0,0.6),
    2px 2px 0 #7a0000;
}

/* ‚îÄ‚îÄ Í∏ÄÏûêÎ≥Ñ Î∂àÍΩÉ ÏÜåÌôò Ïù¥ÌéôÌä∏ ‚îÄ‚îÄ */
.cs-char-wrap {
  display: inline-flex; align-items: flex-end; justify-content: center;
  gap: 2px; flex-wrap: nowrap;
}

.cs-char {
  display: inline-block;
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: clamp(28px, 6.5vw, 52px);
  font-weight: 900;
  line-height: 1;
  opacity: 0;
  will-change: transform, opacity, filter;
}

/* ÏùºÎ∞ò Í∏ÄÏûê: Ìù∞ÏÉâ */
.cs-char.white {
  color: #fff;
  text-shadow: 0 0 10px rgba(255,255,255,0.4);
}

/* Í∞ïÏ°∞ Í∏ÄÏûê(3ÎùºÏö¥Îìú): Î∂àÍΩÉ Îπ®Í∞ï */
.cs-char.fire {
  color: #ff3333;
  text-shadow:
    0 0 8px #ff0000,
    0 0 20px rgba(255,50,0,0.9),
    0 0 40px rgba(200,0,0,0.6);
}

/* ÏÜüÍµ¨ÏπòÎ©∞ Îì±Ïû• */
@keyframes charRise {
  0%   {
    opacity: 0;
    transform: translateY(40px) rotate(var(--tilt)) scale(0.3);
    filter: blur(6px) brightness(6);
    text-shadow: 0 0 30px #ff4400, 0 0 60px #ff0000;
  }
  35%  {
    opacity: 1;
    transform: translateY(-10px) rotate(calc(var(--tilt) * -0.4)) scale(1.25);
    filter: blur(1px) brightness(3);
  }
  55%  {
    transform: translateY(4px) rotate(calc(var(--tilt) * 0.1)) scale(0.95);
    filter: blur(0) brightness(1.8);
  }
  72%  {
    transform: translateY(-3px) scale(1.05);
    filter: brightness(1.4);
  }
  88%  { transform: translateY(1px) scale(0.99); filter: brightness(1.1); }
  100% { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; filter: brightness(1); }
}

/* Í∞ïÏ°∞ Í∏ÄÏûêÎäî Îçî ÌôîÎÅàÌïòÍ≤å Ï∂îÍ∞Ä ÏûîÍ¥ë */
@keyframes charFireSettle {
  0%   { text-shadow: 0 0 30px #ff2200, 0 0 60px #ff0000, 0 0 90px rgba(255,50,0,0.8); }
  40%  { text-shadow: 0 0 16px #ff3300, 0 0 32px rgba(255,50,0,0.7), 0 0 60px rgba(200,0,0,0.5); }
  100% {
    text-shadow:
      0 0 8px #ff0000,
      0 0 20px rgba(255,50,0,0.9),
      0 0 40px rgba(200,0,0,0.6);
  }
}

.cs-char.fire.risen {
  animation: charFireSettle 0.8s ease forwards;
}

/* Î∂àÏî® ÌååÌã∞ÌÅ¥ (CSS only, ::after pseudo) */
.cs-char.fire::after {
  content: '';
  position: absolute;
  bottom: 0; left: 50%;
  width: 4px; height: 4px;
  background: #ff6600;
  border-radius: 50%;
  transform: translateX(-50%) translateY(0);
  opacity: 0;
  pointer-events: none;
}
.cs-char.fire.sparking::after {
  animation: emberFloat 0.6s ease-out forwards;
}
@keyframes emberFloat {
  0%   { opacity: 1; transform: translateX(-50%) translateY(0) scale(1); }
  100% { opacity: 0; transform: translateX(calc(-50% + var(--ex,0px))) translateY(-30px) scale(0.2); }
}

/* ÏÑúÎ∏å ÏÑ§Î™Ö */
.cs-subtitle {
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: 30px; font-weight: 700; letter-spacing: 4px;
  color: #ffaaaa;
  text-shadow: 0 0 10px rgba(255,100,100,0.8);
  opacity: 0;
  transform: translateY(6px);
}

/* ÌÉÄÏù¥Ìïë Ïª§ÏÑú */
.cs-cursor {
  display: inline-block;
  width: 2px; height: 1em; vertical-align: middle;
  background: #ff3333;
  animation: blink 0.6s step-end infinite;
  margin-left: 2px;
}
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }

/* Îπõ Ìè≠Î∞ú */
.cs-burst {
  position: absolute; inset: 0;
  z-index: 5;
  pointer-events: none;
  opacity: 0;
}
.cs-burst.explode {
  animation: burstFlash 0.7s ease-out forwards;
}
@keyframes burstFlash {
  0%   { opacity:1; background: radial-gradient(circle at 50% 50%, rgba(255,80,80,0.95) 0%, rgba(200,0,0,0.7) 30%, transparent 70%); }
  40%  { opacity:0.6; }
  100% { opacity:0; background: radial-gradient(circle at 50% 50%, transparent 0%, transparent 100%); }
}

/* ÏàòÌèâ Îπî */
.cs-beams {
  position: absolute; inset: 0; z-index: 6; pointer-events: none; overflow: hidden;
}
.cs-beam {
  position: absolute; top: 50%; left: 50%;
  width: 120%; height: 2px;
  background: linear-gradient(90deg, transparent, rgba(255,80,80,0.9), rgba(255,200,200,1), rgba(255,80,80,0.9), transparent);
  transform-origin: center;
  opacity: 0;
}
.cs-beam.shoot {
  animation: beamShoot 0.6s ease-out forwards;
}
@keyframes beamShoot {
  0%   { opacity:1; transform: translate(-50%, -50%) scaleX(0) rotate(var(--angle)); }
  60%  { opacity:0.8; transform: translate(-50%, -50%) scaleX(1) rotate(var(--angle)); }
  100% { opacity:0; transform: translate(-50%, -50%) scaleX(1.2) rotate(var(--angle)); }
}

/* ÌååÌã∞ÌÅ¥ Î≥Ñ */
.cs-star {
  position: absolute; z-index: 8;
  font-size: 16px;
  pointer-events: none;
  animation: starFly var(--dur) ease-out forwards;
}
@keyframes starFly {
  0%   { opacity:1; transform: translate(0,0) scale(0) rotate(0deg); }
  30%  { opacity:1; transform: translate(var(--sx), var(--sy)) scale(1.4) rotate(180deg); }
  100% { opacity:0; transform: translate(calc(var(--sx)*1.8), calc(var(--sy)*1.8 + 40px)) scale(0) rotate(360deg); }
}

/* Í∏ÄÎ¶¨Ïπò Ìö®Í≥º */
@keyframes glitch1 {
  0%,100% { clip-path: inset(0 0 95% 0); transform: translate(-2px, 0); }
  50%      { clip-path: inset(30% 0 50% 0); transform: translate(2px, 0); }
}
@keyframes glitch2 {
  0%,100% { clip-path: inset(60% 0 10% 0); transform: translate(2px, 0); }
  50%      { clip-path: inset(80% 0 5% 0); transform: translate(-2px, 0); }
}
.cs-glitch {
  position: relative;
}
.cs-glitch::before,
.cs-glitch::after {
  content: attr(data-text);
  position: absolute; top: 0; left: 0; width: 100%;
  opacity: 0;
}
.cs-glitch.glitching::before {
  color: #ff0040; opacity: 0.7;
  animation: glitch1 0.15s steps(2) 3;
}
.cs-glitch.glitching::after {
  color: #00ffff; opacity: 0.4;
  animation: glitch2 0.15s steps(2) 3;
}

/* Ïû†Í∏àÌï¥Ï†ú ÏïÑÏù¥ÏΩò */
.cs-lock-icon {
  font-size: 40px;
  display: block;
  animation: lockShake 0.5s ease forwards;
  opacity: 0;
}
.cs-lock-icon.show {
  opacity: 1;
}
@keyframes lockShake {
  0%   { transform: scale(0) rotate(-30deg); opacity:0; }
  50%  { transform: scale(1.3) rotate(10deg); opacity:1; }
  70%  { transform: scale(0.9) rotate(-5deg); }
  100% { transform: scale(1) rotate(0deg); opacity:1; }
}

/* Í≤ΩÍ≥† ÌÖçÏä§Ìä∏ ÌÉÄÏù¥Ìïë */
.cs-warning {
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: 20px; font-weight: 700; letter-spacing: 3px;
  color: #ff6666; opacity: 0;
  text-transform: uppercase;
}
.cs-warning.show {
  animation: warnFade 0.3s ease forwards;
}
@keyframes warnFade { to { opacity:0.7; } }

/* ÌûàÎì† Î±ÉÏßÄ */
.cs-hidden-badge {
  background: linear-gradient(135deg, #2a0000, #5a0000);
  border: 2px solid #ff3333;
  border-radius: 8px;
  padding: 6px 24px;
  box-shadow: 0 0 20px rgba(255,50,50,0.5), inset 0 1px 0 rgba(255,100,100,0.2);
  opacity: 0;
}
.cs-hidden-badge.show {
  animation: badgePop 0.5s 0.8s cubic-bezier(0.34,1.6,0.64,1) forwards;
}
@keyframes badgePop {
  from { opacity:0; transform: scale(0.5) rotate(-5deg); }
  to   { opacity:1; transform: scale(1) rotate(0deg); }
}
.cs-hidden-badge-text {
  font-family: 'Pretendard', 'Noto Sans KR', sans-serif;
  font-size: 20px; font-weight: 900; letter-spacing: 5px;
  color: #ffaaaa;
  text-shadow: 0 0 8px rgba(255,100,100,0.8);
}

/* ÌôîÎ©¥ ÏßÑÎèô */
@keyframes screenShake {
  0%,100% { transform: translate(0,0); }
  15% { transform: translate(-4px, 2px); }
  30% { transform: translate(4px, -3px); }
  45% { transform: translate(-3px, 3px); }
  60% { transform: translate(3px, -2px); }
  75% { transform: translate(-2px, 2px); }
  90% { transform: translate(2px, -1px); }
}
.panel.shaking {
  animation: screenShake 0.5s ease forwards;
}

/* ÏµúÏ¢Ö ÌéòÏù¥ÎìúÏïÑÏõÉ */
.cs-fadeout {
  position: absolute; inset: 0; z-index: 20;
  background: #000; opacity: 0; pointer-events: none;
}
.cs-fadeout.do-fade {
  animation: fadeToBlack 0.5s ease forwards;
}
@keyframes fadeToBlack {
  from { opacity:0; } to { opacity:1; }
}
</style>
</head>
<body>
<div class="panel" id="panel">
  <div id="hiddenCutscene">
    <div class="cs-backdrop"></div>
    <div class="cs-bar-top"></div>
    <div class="cs-bar-bottom"></div>
    <div class="cs-scanline"></div>
    <div class="cs-burst"></div>
    <div class="cs-beams" id="csBeams"></div>
    <svg class="cs-cracks" id="csCracks" viewBox="0 0 620 400" preserveAspectRatio="xMidYMid slice">
      <g stroke="#ff3333" stroke-width="1.5" fill="none" opacity="0.7">
        <path d="M310,200 L270,140 L240,100"/>
        <path d="M310,200 L350,130 L380,80"/>
        <path d="M310,200 L240,230 L180,280"/>
        <path d="M310,200 L380,260 L440,300"/>
        <path d="M310,200 L290,260 L260,340"/>
        <path d="M310,200 L330,270 L360,350"/>
        <path d="M270,140 L230,160 L200,120"/>
        <path d="M350,130 L390,150 L420,110"/>
        <path d="M240,230 L210,210 L170,240"/>
        <path d="M380,260 L400,240 L450,260"/>
      </g>
      <g stroke="#ff6666" stroke-width="0.8" fill="none" opacity="0.4">
        <path d="M270,140 L250,125 L220,130"/>
        <path d="M350,130 L370,118 L400,125"/>
        <path d="M240,230 L220,250 L195,265"/>
        <path d="M380,260 L410,275 L430,270"/>
      </g>
      <circle cx="310" cy="200" r="8" fill="#ff3333" opacity="0.9" filter="url(#csglow)"/>
      <defs>
        <filter id="csglow">
          <feGaussianBlur stdDeviation="6" result="coloredBlur"/>
          <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
      </defs>
    </svg>
    <div class="cs-content" id="csContent">
      <span class="cs-lock-icon" id="csLockIcon">üîì</span>
      <div class="cs-warning" id="csWarning">‚ö† HIDDEN STAGE UNLOCKED ‚ö†</div>
      <div class="cs-hidden-badge" id="csBadge"><div class="cs-hidden-badge-text">‚ú¶ HIDDEN ROUND ‚ú¶</div></div>
      <div class="cs-mystery" id="csMystery"><span id="csTypingText"></span><span class="cs-cursor" id="csCursor"></span></div>
      <div class="cs-title-wrap">
        <div id="csMainTitle" class="cs-char-wrap"></div>
      </div>
      <div class="cs-subtitle" id="csSubtitle">Ïà®Í≤®ÏßÑ ÏµúÌõÑÏùò ÎùºÏö¥ÎìúÍ∞Ä Í≥µÍ∞úÎê©ÎãàÎã§</div>
    </div>
    <div class="cs-fadeout" id="csFadeout"></div>
  </div>
  <div id="celebOverlay">
    <div class="celeb-box">
      <img class="celeb-char" id="celebChar" src="" alt="">
      <div class="celeb-title">üèÜ Ïö∞Ïäπ!!! üèÜ</div>
      <div class="celeb-name" id="celebWinner"></div>
    </div>
  </div>
  <div class="header">
    <div class="header-btns">
      <button class="finish-btn" id="finishBtn" onclick="triggerFinish()">üèÜ ÏôÑÏ£º!</button>
      <button class="lock-btn"   id="lockBtn"   onclick="toggleRound3()">üîí</button>
    </div>
    <div class="header-center">
      <span class="header-glove">ü§úüèª</span>
      <span class="header-title">Ïù¥Îùº333Î∞∞ Î©îÏù¥Ìîå Í∞úÎßûÏß± Ïª®ÌÖêÏ∏†</span>
      <span class="header-glove">ü§õüèª</span>
    </div>
    <div style="width:80px"></div>
  </div>
  <div class="round-summary" id="roundSummary" style="display:none">
    <div class="round-badge"><div class="r-label">üëë1ÎùºÏö¥Îìú</div><div class="r-winner" id="r1winner">-</div></div>
    <div class="round-badge"><div class="r-label">üëë2ÎùºÏö¥Îìú</div><div class="r-winner" id="r2winner">-</div></div>
    <div class="round-badge" id="r3badge" style="display:none"><div class="r-label">üëë3ÎùºÏö¥Îìú</div><div class="r-winner" id="r3winner">-</div></div>
  </div>
  <div class="race-section" id="raceSection">
    <div class="empty">üì° Îç∞Ïù¥ÌÑ∞ Î°úÎî© Ï§ë...</div>
  </div>
  <div class="footer">
    <div class="live-dot"></div>
    <span class="live-text">IRA333</span>
  </div>
</div>



<script>
const STREAMERS = {
  "Ïù¥Îùº333": { look: "CGKHHKEDKCJHIGEBGFEEHJPANLIFOMALOPBJCCEBFPOKJHOBBAENJFKGANOOCCBCDFCPFLDEBPFEFDMHGOOELJKIFKDHGKOMPAKOAOPIPECGPLHMGJDCDDCBGMNHFLLPEKBBMDHINJJOMPOBEONFPAFIJOOCDJMKNEIKIBBGDHENPAHPBNODJFCHIDKBEOKHAAMBDDCAFCMEANHPLHOMLNHMJBMFAOAPIDNGNAOBAEFHGCHFABCEFMMEBLHGJBJMDHCOJJAOCBOBIODBNBMOGBKIIMKLGGEAMFAHPFOOFGCLKBEBFFHPNBOMIMMOGMEPGEHMOPEDENKCEBHFGDJMPPCFEOBLHLHGPDMEBOLFCADNBPEAGAPFPJKEEEGNLNNNHILEIDFCFDHOFOHDIFLJIGFCCDGHPCEKDOLEBCLGFCKIEIOOGGHHPEINEFJKFNKBBJFIPAFPBCIEGAGJEEOAFBPJDBPPBNMHOAFIKMEGKMIDKNLCNCNCAEHIONAGBFBGEBDCBPKLDJJAOIBPKFCBLANGMDPEODFGDADAFCKFMLFJGIMCHNHLPEPDLHIADGGJIPHDJHEODMKGJLCHIBEJGPNMMCLJPKBOJBOPPABHCNIGOIPLHFMDOKMIGPEOMJIKAFHIOHNOMCKOAIKGEOAHJCBMMDMPDDJGBIPDEFPEJJIJKICNADBECMCFEGKLJEMOBCCDMMKDIMJDCIHHFNMPIHMMHLANNCDNGOIAPPNNBDIKOMHJOMHCCHEJPKIHHFNDHNMPEGGBMBMJENPKEMAPCCNKOKKJAOAAMIACLIGKFOLIBPNKKJCFDCMJFBCFFOCHJNMMPCLNHGLDGBCDBKOECPCDHOLBFAKKIDJMPNDCFAHHKFLIGLNOKODILHIAMCNEGFLKCDFFHCKGFIHMNDGMFJOHNAGFHCJLJDJDCKCAKMCKMIJFNNPJGMNGHJPKKLGCKJBBOECIJBCEJICCBKEGJNBBGLENDOLGOCBBCKNEEAKEAFIIHBLJLJOEGHJHHHLA", wmotion: "W03" },
  "ÎÇòÎ°úÌõÑÎãù": { look: "CGOCOFDLOJNBCNAIPPBHEPCGALELJHGACIMKCKDLIGHFGFNENDPLCDDCPLEKBEGLBMDLDGHMNLDPJDLECPBONDCCLGJGPKNHAKKBDGEOGBOIBDAICCIPLCJOCGBPHBHNKPIMILBFDLIEMLHDMPPPILOOCDCHCNCJDMGOKFHDBPNFGHJDPFPGKADIGPPHCAHBKBAGGAKLHHLOGPOBCKGDFLAAPEBOMFLPGGELFKAIGKNJACHNMMLBNJHIEKNGLFIBFFEDCPCMIAAELJNEBIEKODBGEOGJEFFDMLFHKADGFOJIHNNEFPDALBPHAOLGFKHPMODLDACFHENGJEGHLMMLCNJJNJBPAEFGEBIABFIDGJAGPMJENPNOAEMKGEDFDONHAABJAALJMPINMECMLNDDAOFJPIGEPAJEMIEFGNPOAILJLLEBKOBOMBGGKHFCMFHJCPHFLKPEKOEJNFIOLPFBKEFMBDBIGJEBIGMBAGPCNPAOJHHMCKEMMFILJEPFJLLGMHGFAIGGCKKPHGINIDEKPCDECCHHIHIMCIEHHPOHJMJOCDLDOKFHILBAIBAELMAAJAHKCIKGNHKNEGHCGMEGOBAOBDEJOJFONEGCMAABIDHGLMGIKMPAODHKANJOEGHINDAJOMENCPAJMIMLGGFKEFMDGEEAODPLCMFMPOIDJGEFFCHONADDDMBJKEGLELHPFDAGJKDFHLBBABENBKJICGNGEJDOJELAGPJENJLJPCGJPCGNANLFIMPOGKOGNONKBGDEODHLNAPMPPGJKDDAOMNPHMNPCCNGOANPFECKLAHFPKGBIMBMDEDNCJJMIMIKCPCCGNGGIKCBALPBFNPGAFDIGIGCJCGNHGLKLGOHLMCOMLHCFIBIEDDNBFHGDFMKKGDEEOBDGJNJNMBHELAGNKJHFPGFGPJDPCMOLCFLKHMIDAANJIELNLGBLODBEDNAAHCNEDDLOHEOBIAGHPCMNGJAOHHNCDKLPDKJFEJONPJDPMKEJNPGLBHAMJFHINCN", wmotion: "W00" },
  "ÏßÑÏ∫ê":   { look: "OBPKOKNMNPEOKNGEKAJJICKGNJCDKEIOIGEFLLDBLCLPOEHGPBKOJPBDBLOPKMLNAPJKHMLPIMONOKEHDEKFNPCIMJPPIFLFMLGIBIIFPBIMFEMPMPJHMLPKPJGMFPEKBNMHEMKCFCANHNPBGKKMDFJNDPOGPHHHJJBIMLHDHANKHBDFFDADAJJCBKIIPMOJMEBBLKIBIHDHMFLBCJEKLCDMFOGMILOPBKAONMPNEBAFIHJCNHFDIKFBJJKOMNBFLHFHIHNPNIIMKGKENEKEOAKAHIBJFMFPLKJGHFJIJIMKIEIHLGGKGBOFAAIPDHNKOKDGEBEACNBPADCMNAFHHDJEDGGEHMCMDHJKNKHMJMPGANIDIHIFNIAGJKKEJJNMAJCMINPCDGOCPLIFAKOKCGAMHCCLHJPFPNMFJLLNJDJIFDLBJJEKNMDCDHOJDKOINMKEIILMGKNADFLLFHADABFHFKCNCAIBHLFKNKJEFGMDIHKBBFBJJFHDJDHGAMOBBEICDCGHIGLNFHOKFDGPMNIDLDCDKPPLEAMGMLBBMKDLMJDOPEFJLOLLEOJGBPFEJCNGAGNOKDNEKPEBCOGMEFAHCMFHMNPCLJGNIFFBCBHJBLNJOOIKCHEPECGLLGPHNBGLEFMLEECFICIMJODJGHGKIAPILACNBPLNDLACBLDFALEDLIEMBMCKIOKPCEGEGLIAFKFLIALBJDKDGPNMDHONAHABHECJOBJAPMONFDAOKHJPAIJCAKPOMNDLAGOEKBNJNHAMCGCOCDADIEKIKNLBLFOIACIELKEDBACDDIKNNNBPEAJJBDPPBAGMCLELFPDHAEDEGOBOIJIMIBCDMFKJDFCCHDEGGCAGNBKPCHBMEKPEDAGDJCIFBFMJAPIEDLOEHJPKBNHFGCBAJNNBGBJINHOLKEGGGJIHBJBIGCKDEFEICAAAIMDCAPGMJHJBLMBJAGGBJPALOOLCKPHLIGIKMFLLCMELDFELBNKPDFIMFCGLCBMAHAOGFAJBDEGD", wmotion: "W00" },
  "Ìå°Ïù¥Ïöî": { look: "AHFMCHNACDDFCMOMICDHNKFEAFKOCLPFDIIJJPDFNPDDBFHEHCBPOAMFAENNFGBMFJELMPIOHCBGKMEIJPIFLAPGHBGMHJAJAGEDGPAKMCLAKNEJCMEPCEJKFHMJJONPGKJBDADGBJBACDBCFCGLFNJNPDADNDCBMAECGKMFNNFGOEFOFONOJEBIFELNBJIFKDHGBPPKMFANLONIHEGMIGMAJCLGKAOBLJDAFEDEAMHDGCFDDLJOEIOKDPNFEPPMOJGHOLDOCNLAHMJBFPKOLIDJPELGLFEBFLAGPIIIFPJCJLDJMIGJLJGHKHJKPAOPGEMOFKNGECGNJKBDANGJOHCOBDJLNOLALAIENFNCLFEPJOAKLBIFBEFGMKEJMAPIJKKCOKJAFBBPKBNHBEAOAPHMHBCOFLGFFMMPHFLPDFGALCOJHAAHCJPLPGGINFAOFPPIAMCHCMDKIMLEMJGMJNLMOMPPPMKAAJPLGABOLEHKCKJMIDHFMIGPGDPFPDJLONKCFGGELEFGIBPIEOFJLMLMJBIBPJECDFIEDGLCPEPOEJKMMOEOEGJJEIOBEDKFIDEEJOMIAKFMGIHNEHNFMFOKLLNPLIGKPJBAPLKDFGKKJFLMBNGKOOLGMJCAKDEOOPLKGDJLEIOELADEFKGLJLIJDGOMAGALCOGJMGLFGGPJHLBKJONFAMOCMHJODGLNIBJPAPMFNMNHNCJJFFIJKJMGIDGODGIGEHGKBFBACGFPGHEJFPKFCIMCIOEDBBIDJKDMEDIOAKJMHEDHOOGMPGBINJMEMGCNAPOJFMECFAEIDLMMHLPKOJLMCBHOBIHMACELJCGAEIGHLCGIJCHGFPJIJDAODNJBOHECFPCCILKBBOGLPEMOJMJLFNNPEAANMGKCJPOGBCBHDOOAJJAPGIKCDCEKHAAFMBPIBJBJNEPGHENKOBMCABFAHAELNGPNNGPIPLKAOKLGFDDKAFHKBGABIAOOHIFLGANNAHPEDBKNOLLJHOGOIHBKEEPFBJBH", wmotion: "W02" },
  "ÏùºÏñ¥ÎÇò": { look: "OFOCBAJFNGHKJNNMMAMJNJOPADPCKMFGKJAOHJACIFBCFJCIBGJMPLCLAOLPFHOBOFALAAMPFPMILMCNBJPDFFJIACOIGKKIAEHJMMCJOHHEJJOBKHBKKJBLFEBOLCDDADFMPDHDODACALIMCEFKOMCMCIMKLOIENKKNHJEPNHHIEEHCOICJGOMPOOAHEOLILMAJNPEGADMJPMCGFKJJFDHNNFMLFOIAEBAMJMKNGMADILLGEOKJBOLCBBOOAGHOACHJPKIPKOKCJPBCGPCJMJMAPJLFALHHIDIOFMNAKCKLAIPBPDFOJCGJMKDICCEPMPFJMBCDMJGGAPCAPEPAKELGFAIGFKLGJLBMEHNKEOPEMAGHCDLPMMIPIPFJMNJHLEDBFNOCLIABLLMGOGHNFDMOKAFONBOEPMLPLNABJOHMJHLJEBICFGLDFJFINJIOEILNDILOAJDCPLOCDNINIECADENGBCDCAFLBHNFONDMGHILKKNMHNKIJGAKDEMBPHMDKKPPCHGNOLCHEGMCDJKDJAAFEHEKLBPONDAECKOODNPOMCBKEDJBALGFDBGAEDDOBIGDDPDHANJMBEMCCOHDDBCIKBDEKONBFGAJPBBDAMHMDBMBABGNGOCLMELLNGIOFHNLCNFGFEOMBBLOLEALMIFIIEPHJFLJHKFMNOPPDGBAKEIGMNLDPKJKOHBDFMHHFEEIPIPHOGDJIOPEIKKOJOGKAKCNHKNHMHJMEJFKLIKKICOLDMPHDHMDOBCJCLMLMKMHAFKGAALKAENODBPPKDIKFBBBCCPGJLGCOHOGJDLHMDHDBCAGPJEEOHICOAKDOHCDEMEJJGGDGDBKMNIIGGLDPMLHJAIKAOIBELOLDDJBIEGDPMADPCIFGBGDCNAPNBHOPGNBNDPAJEMFECIDNCOPEFFCMFIIEFDHHAIIFBEIINPIOEJCLPNDGGPJBDNIOOKILGLAOOGJKIFNDOKJPCAHDFBKGADNPHNFDOIGOPGPGNBMLBAIBENANGPEL", wmotion: "W01" },
  "ÏÑ∏Í∏ÄÏûê": { look: "EFBAJENHLMCBEJPKBNNIDKACLKGBJOFLJOJLBEPIHEKBFCBMCDIGGBICHCFMOMBGMMAKBFOOFLKJBBAIEIPHJPDDOIGBBJCHAMJGGFJPIBNEAIOFMKPAAMOJOPPDBEPCMNLHCKDGMECBMJBNCAKLIOKJNCKFELGCIPPAAHAFCMEPAGKDIABINABNAIGICLGMMBIOPLGJGLEEDDKFIHFCBGHMMDGKODGDKLALENFFLNCAMABKFDPBFEJGDPOMLCCIMPIFDDEGNMAGHEKPMMCOLHKJGAONDBCMKJCOFNDJCDENPBJALLPBFFKOCPLFIBBLBMMNJONLLPJEMFCAKCIIBENOEJBGABFKPIEJEKCKICHJKFAHGPOBCGCGKOJCPHJLEKEFDIPHNKLKNMJAEEMDCMCNHOHHEIMBIPPJEPDPFLKIPDOACDECILLGBFOMAALCOGONJOAGMEAKEAPOBPAAKCFGHGEIDFNGKFPNKAIDFPJHEHJEOPIGLNBPCKOMHABKFOHBDEACJMPLPBOIDCKDPEGGOBBKEHGOIOLGGMLLNICNFLNOKEFNNFPMNFMDEHDFFDNGBNDNPGBLDPBADPKECHKFHAONAJJPIAKCHLFPHMNJBEPLJCHPBEEAFLKLJINELFHAAACGPMEACAJFOIONHHEPCBNLBLDGJGEJILNLDAJAFENJDOLOCPHDIELIBJEHHCGMDFJBLIGFMGDHHKGPEABNIPGJEEDKFHJFPJAJABAHNFIMHJCKKCCPGIABHHANLNAKOOBKFCKKBIKILDBFDEDGOJEKEGFKFFOMJLICFPMAEIGKBEPIPEFLMGOBGOJOIPGMLKCGHLNBDECMDPAPJJMCKEOKPAHIGHIFNKKAECADIMHCIGKIICPKIKLLFDJODACDHHKPKGFECPBOFFPAPMHODNPDHIEMABLCNOBNHEPOGANNHHGGGKPJOFLLCDKNBFCDKOBDCNOOMBOECGKJFDGIIIPJEACCNMMGGOFOHLDCFMKNGOFCACABGBOGDDFJ", wmotion: "W00" },
  "ÏãùÏ§ëÎïê": { look: "HOGJJHPOPPDFAOEBJJODANKNBLPKGLKHHMGNLFKLLGDPIKCJOEDDMPCPALIBLIEADMBILKEICPOCONOMFIBHBBFCAPOMLNBKKFEDDLLKGNJCABJIGKIKCEKLDJFKGFDONAFNACKCFDNDGGKNHEGBKGMKNAJOFADOJGFGHPMIALNGKNGOCMAHFGPPIELPPGODMLAPOBAKDMHENNNHDIFEIHJLHEIPJDNKBAJLKBBIJGGKMOAMKHKLMPPDKAOHDGBGCFHGIONELNHDNKINEOGOLIJIJLPMPCPABBNHIAENJFCGLHLMJINIMIMHFPLNLMKDFPDDIGMHNBBDDOAIDHNGHEGFAOADKKGGDNPBGDMMOKAPCKILDLMDCAOMMMJCFBLMNGHELOMLMLNMADAJDFHLIOBOIIHEOHLBICNPMDBKCLDOHEKNNOOFIJKMFBFECCGLINADNCMHMCGAEPFGNIOFDFHEHGHCNIOACHNGGJJILCEOPAAHHELODDBFEFMJADMEDAIKPOOCIHJFLHOPBLIHIIJBOKKAGOFIAGMDOKEBFOHIAPHDMFDNAEFBFILDOFPOBIKBNJICEOKFHAKOCKOGPDKHNGDMMBEFNIGMCHHMLLNALIAMDCOGLHPHIOPONKLHEJIELNEGNJBKPCEAKNLKNBEKHLCBMABFHECGHDKDFMKEIEIDABOBOIOFMMHMOBHIEMAIACEILIPIEAHAPNHJAHLIMBGGNBAPKDJMBGLHBPHBJLMAPNEBFJOBBLCOOALDIMCKLLPJNKOJCDILHCLALNCKLCDOPJOHHKHKGJGNMGJDLGICNGOMGNICKCPCFILOLGAMJIGDFGACDFDFBEEAJKPDBGMEAHGAPIJCKEHDFLPPBMOBAKPKLDONBKIEHEIDOEGNDOHJCDHBOFCMNKBGPIMLBGAAGNHDKGGMBFOPMNPBPJAENNOJDLCMFJFOGPMHHGABLGOEPJIDBNIDBCCHIPDNPDCPACBFFPBLPMOGIEOJLDEDGDADPIHOIEHHMHKE", wmotion: "W01" },
};

const BASE = "https://open.api.nexon.com/static/maplestory/character/look/";

function buildUrl(name, action, frame, emotion) {
  const s = STREAMERS[name];
  if (!s) return "";
  return BASE + s.look + "?wmotion=" + s.wmotion + "&action=" + action + "." + frame + "&emotion=" + emotion + "&width=800&height=800";
}

const RANK_ANIM = {
  cheer: { action: "A05", emotion: "E09", frames: 2 },
  smile: { action: "A05", emotion: "E02", frames: 2 },
  angry: { action: "A05", emotion: "E04", frames: 2 },
  grave: { action: "A40", emotion: "E03", frames: 4 },
};

function rankToKey(rank) {
  if (rank === 1) return "cheer";
  if (rank <= 3)  return "smile";
  if (rank <= 6)  return "angry";
  return "grave";
}

const activeAnims = {};

function startAvatarAnim(imgEl, name, rank) {
  if (activeAnims[name]) { clearInterval(activeAnims[name]); delete activeAnims[name]; }
  if (!STREAMERS[name]) { imgEl.style.display = "none"; return; }
  const anim = RANK_ANIM[rankToKey(rank)];
  let frame = 0;
  imgEl.src = buildUrl(name, anim.action, frame, anim.emotion);
  frame = (frame + 1) % anim.frames;
  activeAnims[name] = setInterval(() => {
    imgEl.src = buildUrl(name, anim.action, frame, anim.emotion);
    frame = (frame + 1) % anim.frames;
  }, 300);
}

function startCelebAnim(name) {
  const imgEl = document.getElementById("celebChar");
  if (!imgEl || !STREAMERS[name]) return;
  if (activeAnims["__celeb__"]) { clearInterval(activeAnims["__celeb__"]); delete activeAnims["__celeb__"]; }
  const anim = RANK_ANIM["cheer"];
  let frame = 0;
  imgEl.src = buildUrl(name, anim.action, frame, anim.emotion);
  frame = (frame + 1) % anim.frames;
  activeAnims["__celeb__"] = setInterval(() => {
    imgEl.src = buildUrl(name, anim.action, frame, anim.emotion);
    frame = (frame + 1) % anim.frames;
  }, 300);
}

function stopCelebAnim() {
  if (activeAnims["__celeb__"]) { clearInterval(activeAnims["__celeb__"]); delete activeAnims["__celeb__"]; }
}

function startRunnerAnim(imgEl, name) {
  const key = "runner_" + name;
  if (activeAnims[key]) { clearInterval(activeAnims[key]); delete activeAnims[key]; }
  if (!STREAMERS[name]) { imgEl.style.display = "none"; return; }
  let frame = 0;
  imgEl.src = buildUrl(name, "A02", frame, "E00");
  frame = (frame + 1) % 4;
  activeAnims[key] = setInterval(() => {
    imgEl.src = buildUrl(name, "A02", frame, "E00");
    frame = (frame + 1) % 4;
  }, 200);
}

let prevJSON = "";
let round3Revealed = false;
let celebActive = false;
let celebTimer = null;
let currentFirstName = "";
let finishTriggered = false;
let finishApplied = false;
let cutscenePlaying = false;

/* ===== ÌûàÎì† ÎùºÏö¥Îìú Ïª∑Ïî¨ ===== */

function playCutscene(onComplete) {
  if (cutscenePlaying) return;
  cutscenePlaying = true;

  const cs        = document.getElementById("hiddenCutscene");
  const backdrop  = cs.querySelector(".cs-backdrop");
  const scanline  = cs.querySelector(".cs-scanline");
  const burst     = cs.querySelector(".cs-burst");
  const cracks    = document.getElementById("csCracks");
  const content   = document.getElementById("csContent");
  const lockIcon  = document.getElementById("csLockIcon");
  const warning   = document.getElementById("csWarning");
  const badge     = document.getElementById("csBadge");
  const typing    = document.getElementById("csTypingText");
  const cursor    = document.getElementById("csCursor");
  const mainTitle = document.getElementById("csMainTitle");
  const subtitle  = document.getElementById("csSubtitle");
  const fadeout   = document.getElementById("csFadeout");
  const beamsWrap = document.getElementById("csBeams");

  // ‚îÄ‚îÄ ÏôÑÏ†Ñ Ï¥àÍ∏∞Ìôî ‚îÄ‚îÄ
  cs.style.display = "block";
  backdrop.style.opacity = "0";
  scanline.style.animation = "none"; scanline.style.opacity = "0"; scanline.style.transform = "scaleX(0)";
  burst.style.animation = "none"; burst.style.opacity = "0";
  cracks.style.animation = "none"; cracks.style.opacity = "0";
  content.style.animation = "none"; content.style.opacity = "0"; content.style.transform = "translate(-50%,-50%) scale(0.95)";
  lockIcon.style.animation = "none"; lockIcon.style.opacity = "0";
  warning.style.animation = "none"; warning.style.opacity = "0";
  badge.style.animation = "none"; badge.style.opacity = "0";
  mainTitle.style.animation = "none"; mainTitle.style.opacity = "0"; mainTitle.innerHTML = "";
  subtitle.style.animation = "none"; subtitle.style.opacity = "0";
  fadeout.style.animation = "none"; fadeout.style.opacity = "0";
  typing.textContent = "";
  cursor.style.display = "none";
  beamsWrap.innerHTML = "";
  cs.classList.remove("bars-in");

  // ‚îÄ‚îÄ Ïú†Ìã∏ ‚îÄ‚îÄ
  function go(el, props) { Object.assign(el.style, props); }
  function transition(el, duration, props) {
    el.style.transition = "all " + duration + "ms ease";
    Object.assign(el.style, props);
  }

  let t = 50;

  // 1) Î∞∞Í≤Ω Ïñ¥Îë†
  setTimeout(() => {
    transition(backdrop, 300, { opacity: "1" });
  }, t); t += 300;

  // 2) ÏßÑÎèô (CSS class)
  setTimeout(() => {
    document.getElementById("panel").classList.add("shaking");
    setTimeout(() => document.getElementById("panel").classList.remove("shaking"), 500);
    // Î†àÌÑ∞Î∞ïÏä§
    cs.classList.add("bars-in");
  }, t); t += 400;

  // 3) Ïä§Ï∫îÎùºÏù∏
  setTimeout(() => {
    go(scanline, { transition: "none", opacity: "1", transform: "scaleX(0)" });
    requestAnimationFrame(() => {
      scanline.style.transition = "transform 0.4s cubic-bezier(0.22,1,0.36,1), opacity 0.3s";
      scanline.style.transform = "scaleX(1)";
    });
  }, t); t += 350;

  // 4) Í∑†Ïó¥
  setTimeout(() => {
    cracks.style.transition = "opacity 0.4s ease";
    cracks.style.opacity = "1";
  }, t); t += 200;

  // 5) Îπõ Ìè≠Î∞ú + Îπî
  setTimeout(() => {
    // burst
    go(burst, { opacity: "1", background: "radial-gradient(circle at 50% 50%, rgba(255,80,80,0.95) 0%, rgba(200,0,0,0.7) 30%, transparent 70%)" });
    setTimeout(() => { transition(burst, 600, { opacity: "0" }); }, 100);

    // beams
    ["0deg","45deg","90deg","135deg","160deg","20deg"].forEach((angle, i) => {
      const beam = document.createElement("div");
      beam.className = "cs-beam";
      beam.style.cssText = "--angle:" + angle + ";animation-delay:" + (i * 0.04) + "s;";
      beamsWrap.appendChild(beam);
      requestAnimationFrame(() => requestAnimationFrame(() => beam.classList.add("shoot")));
    });

    // Î≥Ñ ÌååÌã∞ÌÅ¥
    const starEmojis = ["‚≠ê","‚ú®","üí´","üåü","‚ù§Ô∏è‚Äçüî•","üî•","üí•"];
    for (let i = 0; i < 10; i++) {
      const star = document.createElement("div");
      star.className = "cs-star";
      const sx = (Math.random() - 0.5) * 280;
      const sy = (Math.random() - 0.5) * 180;
      const dur = 0.8 + Math.random() * 0.5;
      star.style.cssText = "left:50%;top:50%;--sx:"+sx+"px;--sy:"+sy+"px;--dur:"+dur+"s;animation-delay:"+(i*0.05)+"s;";
      star.textContent = starEmojis[Math.floor(Math.random()*starEmojis.length)];
      cs.appendChild(star);
      setTimeout(() => { if(star.parentNode) star.remove(); }, (dur + 0.3 + i*0.05) * 1000);
    }
  }, t); t += 250;

  // 6) ÏΩòÌÖêÏ∏† ÏòÅÏó≠ ÌéòÏù¥ÎìúÏù∏
  setTimeout(() => {
    go(content, { transition: "opacity 0.4s ease, transform 0.4s ease", opacity: "1", transform: "translate(-50%,-50%) scale(1)" });
  }, t); t += 200;

  // 7) ÏûêÎ¨ºÏá† ÏïÑÏù¥ÏΩò
  setTimeout(() => {
    go(lockIcon, { opacity: "1", animation: "lockShake 0.5s ease forwards" });
  }, t); t += 550;

  // 8) Í≤ΩÍ≥† ÌÖçÏä§Ìä∏
  setTimeout(() => {
    go(warning, { transition: "opacity 0.3s ease", opacity: "0.7" });
  }, t); t += 450;

  // 9) HIDDEN ROUND Î∞∞ÏßÄ
  setTimeout(() => {
    go(badge, { animation: "badgePop 0.5s cubic-bezier(0.34,1.6,0.64,1) forwards", opacity: "1" });
  }, t); t += 600;

  // 10) ÌÉÄÏù¥Ìïë
  setTimeout(() => {
    const typeText = "HIDDEN ROUND ACTIVATED";
    cursor.style.display = "inline-block";
    let i = 0;
    const iv = setInterval(() => {
      if (i < typeText.length) {
        typing.textContent += typeText[i++];
      } else {
        clearInterval(iv);
        setTimeout(() => { cursor.style.display = "none"; }, 400);
      }
    }, 55);
  }, t); t += typeLength(22, 55) + 500;

  // 11) Í∏ÄÏûêÎ≥Ñ Î∂àÍΩÉ ÏÜåÌôò
  setTimeout(() => {
    // üî• 3ÎùºÏö¥Îìú Í≥µÍ∞ú üî• ‚Äî fire Í∏ÄÏûê: 3ÎùºÏö¥Îìú
    const parts = [
      { text: "‚≠ê", type: "white" },
      { text: " ", type: "white" },
      { text: "3", type: "fire" },
      { text: "Îùº", type: "fire" },
      { text: "Ïö¥", type: "fire" },
      { text: "Îìú", type: "fire" },
      { text: " ", type: "white" },
      { text: "Í≥µ", type: "white" },
      { text: "Í∞ú", type: "white" },
      { text: " ", type: "white" },
      { text: "‚≠ê", type: "white" },
    ];
    mainTitle.innerHTML = "";
    mainTitle.style.opacity = "1";
    const tilts = [-12,-8,10,-6,14,-10,8,-4,12,-8,10];
    parts.forEach((p, i) => {
      const span = document.createElement("span");
      span.className = "cs-char " + p.type;
      span.textContent = p.text;
      span.style.setProperty("--tilt", (tilts[i] || 0) + "deg");
      mainTitle.appendChild(span);
      // ÏàúÏ∞® Îì±Ïû•
      setTimeout(() => {
        span.style.animation = "charRise 0.55s cubic-bezier(0.22,1,0.36,1) forwards";
        if (p.type === "fire") {
          setTimeout(() => span.classList.add("risen"), 500);
        }
      }, i * 60);
    });
  }, t); t += parts_duration(11, 60, 550);

  function parts_duration(count, interval, animDur) { return count * interval + animDur + 100; }

  // 12) Î∂ÄÏ†ú
  setTimeout(() => {
    go(subtitle, { transition: "opacity 0.5s ease, transform 0.5s ease", opacity: "0.85", transform: "translateY(0)" });
    subtitle.style.transform = "translateY(6px)";
    requestAnimationFrame(() => {
      subtitle.style.transform = "translateY(0)";
    });
  }, t); t += 1600;

  // 13) ÌéòÏù¥ÎìúÏïÑÏõÉ
  setTimeout(() => {
    go(fadeout, { transition: "opacity 0.5s ease", opacity: "1" });
  }, t); t += 600;

  // 14) Ï¢ÖÎ£å
  setTimeout(() => {
    cs.style.display = "none";
    cs.classList.remove("bars-in");
    cutscenePlaying = false;
    if (onComplete) onComplete();
  }, t);
}

function typeLength(chars, interval) { return chars * interval; }



function revealR3Badges() {
  // ÏÉÅÎã® r3badge
  const r3b = document.getElementById("r3badge");
  r3b.style.display = "";
  r3b.classList.remove("r3-header-done", "r3-header-in");
  void r3b.offsetWidth;
  r3b.classList.add("r3-header-in");
  setTimeout(() => {
    r3b.classList.remove("r3-header-in");
    r3b.classList.add("r3-header-done");
  }, 700);

  // Í∞Å ÌîåÎ†àÏù¥Ïñ¥ Î±ÉÏßÄ ‚Äî ÏàúÏ∞® Îì±Ïû• (DOM Ï°∞Ïûë ÏóÜÏùå, CSSÎßå)
  const badges = document.querySelectorAll(".rs-badge.rs-r3");
  badges.forEach((el, i) => {
    el.classList.remove("r3-impact", "r3-done");
    el.style.display = "";
    el.style.opacity = "0";
    setTimeout(() => {
      el.style.opacity = "";
      void el.offsetWidth;
      el.classList.add("r3-impact");
      setTimeout(() => {
        el.classList.remove("r3-impact");
        el.classList.add("r3-done");
      }, 750);
    }, i * 110);
  });
}


function hideR3Badges() {
  const r3b = document.getElementById("r3badge");
  r3b.style.display = "none";
  r3b.classList.remove("r3-header-in", "r3-header-done");
  document.querySelectorAll(".rs-badge.rs-r3").forEach(el => {
    el.style.display = "none";
    el.classList.remove("r3-impact", "r3-done", "locked", "decoding", "decoded");
  });
}

function toggleRound3() {
  if (round3Revealed) {
    round3Revealed = false;
    document.getElementById("lockBtn").textContent = "üîí";
    hideR3Badges();
  } else {
    playCutscene(() => {
      round3Revealed = true;
      document.getElementById("lockBtn").textContent = "üîì";
      revealR3Badges();
    });
  }
}



function animateRunnerToEnd(runnerEl, duration) {
  const startPct = 0;
  const endPct = 100;
  const startTime = performance.now();
  function easeInExpo(t) {
    if (t < 0.65) return (t / 0.65) * 0.15;
    const t2 = (t - 0.65) / 0.35;
    return 0.15 + 0.85 * (t2 * t2 * t2);
  }
  function step(now) {
    const elapsed = now - startTime;
    const t = Math.min(elapsed / duration, 1);
    const progress = easeInExpo(t);
    const currentPct = startPct + (endPct - startPct) * progress;
    runnerEl.style.left = currentPct + "%";
    if (t < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

function animateGaugeFill(fillEl, duration) {
  const startPct = 0;
  const endPct = 100;
  const startTime = performance.now();
  function easeInExpo(t) {
    if (t < 0.65) return (t / 0.65) * 0.15;
    const t2 = (t - 0.65) / 0.35;
    return 0.15 + 0.85 * (t2 * t2 * t2);
  }
  function step(now) {
    const elapsed = now - startTime;
    const t = Math.min(elapsed / duration, 1);
    const progress = easeInExpo(t);
    fillEl.style.width = (startPct + (endPct - startPct) * progress) + "%";
    if (t < 1) requestAnimationFrame(step);
  }
  requestAnimationFrame(step);
}

function applyFinishEffects(winnerName) {
  if (finishApplied) return;
  finishApplied = true;

  const fill1 = document.querySelector(".track-fill.fill-1");
  const firstRunner = document.querySelector(".runner-icon.is-first");

  if (fill1) {
    fill1.style.transition = "none";
    fill1.style.width = "0%";
    fill1.classList.add("finish-glow");
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        animateGaugeFill(fill1, 3000);
      });
    });
  }

  if (firstRunner) {
    firstRunner.style.transition = "none";
    firstRunner.style.left = "0%";
    requestAnimationFrame(() => {
      requestAnimationFrame(() => {
        animateRunnerToEnd(firstRunner, 3000);
      });
    });
  }

  Object.keys(activeAnims).forEach(k => {
    if (k === "__celeb__") return;
    clearInterval(activeAnims[k]);
    delete activeAnims[k];
  });

  document.querySelectorAll(".avatar-img").forEach((el, i) => {
    if (i !== 0) el.classList.add("frozen");
  });
  document.querySelectorAll(".runner-icon").forEach((el, i) => {
    if (i !== 0) el.classList.add("frozen");
  });

  const winnerAvatar = document.getElementById("avatar_0");
  if (winnerAvatar && winnerName) startAvatarAnim(winnerAvatar, winnerName, 1);
}

function clearFinishEffects() {
  finishTriggered = false;
  finishApplied = false;
  document.querySelectorAll(".track-fill").forEach(el => el.classList.remove("finish-glow"));
  document.querySelectorAll(".avatar-img").forEach(el => el.classList.remove("frozen"));
  document.querySelectorAll(".runner-icon").forEach(el => el.classList.remove("frozen"));
}

function triggerFinish() {
  if (celebActive) {
    celebActive = false;
    clearInterval(window._celebInterval);
    clearTimeout(celebTimer);
    stopCelebAnim();
    document.getElementById("celebOverlay").classList.remove("active");
    document.getElementById("finishBtn").classList.remove("active");
    document.getElementById("finishBtn").textContent = "üèÜ ÏôÑÏ£º!";
    document.querySelectorAll(".particle").forEach(p => p.remove());
    return;
  }

  celebActive = true;
  finishTriggered = true;
  finishApplied = false;
  document.getElementById("finishBtn").classList.add("active");
  document.getElementById("finishBtn").textContent = "‚èπ Ï¢ÖÎ£å";
  document.getElementById("celebWinner").textContent = currentFirstName || "";

  startCelebAnim(currentFirstName);

  document.getElementById("celebOverlay").classList.add("active");

  spawnFlyingChars();
  applyFinishEffects(currentFirstName);
  spawnBurst();
  window._celebInterval = setInterval(() => { if (celebActive) spawnBurst(); }, 600);
  celebTimer = setTimeout(() => {
    celebActive = false;
    clearInterval(window._celebInterval);
    stopCelebAnim();
    document.getElementById("celebOverlay").classList.remove("active");
    document.getElementById("finishBtn").classList.remove("active");
    document.getElementById("finishBtn").textContent = "üèÜ ÏôÑÏ£º!";
    document.querySelectorAll(".particle").forEach(p => p.remove());
  }, 15000);
}

function spawnFlyingChars() {
  const overlay = document.getElementById("celebOverlay");
  const overlayH = overlay.offsetHeight;
  const overlayW = overlay.offsetWidth;

  const targets = [];
  for (let i = 1; i <= 10; i++) {
    const el = document.getElementById("avatar_" + i);
    if (el) targets.push(el);
  }
  const count = targets.length;
  if (count === 0) return;

  targets.forEach((avatarEl, idx) => {
    const startX = overlayW * 0.25 + idx * (overlayW * 0.20 / Math.max(count - 1, 1));
    const startY = overlayH + 80;

    const img = document.createElement("img");
    img.className = "fly-char";
    const sname = avatarEl.dataset.sname || "";
    img.src = sname && STREAMERS[sname]
      ? buildUrl(sname, "A40", 0, "E03")
      : avatarEl.src;

    const fx = rand(-20, 20);
    const fy = -(overlayH + 250);
    const fr = rand(-40, 40);
    const fd = rand(3.0, 4.2);
    const delay = idx * 0.12;

    img.style.cssText =
      "left:" + startX + "px;" +
      "top:" + startY + "px;" +
      "width:600px;height:600px;" +
      "object-fit:contain;" +
      "transform:translate(-50%,-50%) scaleX(-1);" +
      "animation-delay:" + delay + "s;" +
      "--fx:" + fx + "px;--fy:" + fy + "px;--fr:" + fr + "deg;--fd:" + fd + "s;";
    overlay.appendChild(img);
    setTimeout(() => img.remove(), (fd + delay) * 1000 + 300);
  });
}

function rand(min, max) { return Math.random() * (max - min) + min; }

function spawnBurst() {
  const overlay = document.getElementById("celebOverlay");
  const W = overlay.offsetWidth, H = overlay.offsetHeight;
  const fwColors = ["#ff0000","#ff4040","#ff8080","#ff2020","#ffaaaa","#cc0000","#ff6060","#fff"];
  [{x:W*0.15,y:H*0.2},{x:W*0.5,y:H*0.08},{x:W*0.85,y:H*0.2},{x:W*rand(0.1,0.9),y:H*rand(0.05,0.3)}]
  .forEach(spot => {
    for (let i = 0; i < Math.floor(rand(8,16)); i++) {
      const el = document.createElement("div"); el.className = "particle firework";
      const angle = rand(0,360)*Math.PI/180, dist = rand(30,100), dur = rand(0.5,1.1);
      el.style.cssText = "left:"+spot.x+"px;top:"+spot.y+"px;background:"+fwColors[Math.floor(rand(0,fwColors.length))]+";--tx:"+Math.cos(angle)*dist+"px;--ty:"+Math.sin(angle)*dist+"px;--dur:"+dur+"s;width:"+rand(3,7)+"px;height:"+rand(3,7)+"px;";
      overlay.appendChild(el); setTimeout(() => el.remove(), dur*1000+100);
    }
  });
  const mesoEmojis = ["ü™ô","üí∞","‚≠ê","‚ú®","üåü","üí´","üíµ","üü°","üëë","üèÜ","üíõ"];
  for (let i = 0; i < Math.floor(rand(6,12)); i++) {
    const el = document.createElement("div"); el.className = "particle meso";
    const dur = rand(1.0,2.0);
    el.style.cssText = "left:"+rand(0,W)+"px;top:-16px;--fall:"+rand(H*0.5,H*0.95)+"px;--rot:"+rand(-360,360)+"deg;--dur:"+dur+"s;animation-delay:"+rand(0,0.3)+"s;";
    el.textContent = mesoEmojis[Math.floor(rand(0,mesoEmojis.length))];
    overlay.appendChild(el); setTimeout(() => el.remove(), (dur+0.4)*1000);
  }
  for (let i = 0; i < Math.floor(rand(4,8)); i++) {
    const el = document.createElement("div"); el.className = "particle sparkle";
    const dur = rand(0.7,1.4);
    el.style.cssText = "left:"+rand(0,W)+"px;top:"+rand(H*0.1,H*0.7)+"px;--mx:"+rand(-60,60)+"px;--my:"+rand(-60,10)+"px;--dur:"+dur+"s;";
    el.textContent = ["‚ú®","‚≠ê","üí´","üåü","üíµ","üü°","üëë","üèÜ","üíõ","üí∞","ü™ô"][Math.floor(rand(0,4))];
    overlay.appendChild(el); setTimeout(() => el.remove(), dur*1000+100);
  }
}

function getRoundBest(data, key) {
  const valid = data.filter(r => r[key] && r[key] !== "-" && !isNaN(Number(r[key])));
  if (!valid.length) return { name: "-", pt: "" };
  const best = valid.reduce((b, r) => Number(r[key]) > Number(b[key]) ? r : b);
  const pt = Number(best[key]);
  return { name: best["üéôÔ∏èÏä§Ìä∏Î¶¨Î®∏"] || "-", pt: pt > 0 ? pt.toLocaleString() : "" };
}

function render(data) {
  if (!data || !data.length) {
    document.getElementById("raceSection").innerHTML = "<div class='empty'>üò∂ Îç∞Ïù¥ÌÑ∞ ÏóÜÏùå</div>";
    document.getElementById("roundSummary").style.display = "none";
    return;
  }
  data.sort((a, b) => Number(b["üìùÏµúÏ¢Ö Ï†êÏàò"]) - Number(a["üìùÏµúÏ¢Ö Ï†êÏàò"]));
  data = data.slice(0, 7);
  const json = JSON.stringify(data);

  if (json === prevJSON) return;

  if (finishTriggered) {
    clearFinishEffects();
    if (celebActive) {
      celebActive = false;
      clearInterval(window._celebInterval);
      clearTimeout(celebTimer);
      stopCelebAnim();
      document.getElementById("celebOverlay").classList.remove("active");
      document.getElementById("finishBtn").classList.remove("active");
      document.getElementById("finishBtn").textContent = "üèÜ ÏôÑÏ£º!";
      document.querySelectorAll(".particle").forEach(p => p.remove());
    }
  }

  prevJSON = json;
  currentFirstName = data[0]["üéôÔ∏èÏä§Ìä∏Î¶¨Î®∏"] || "";

  const r1 = getRoundBest(data, "üëë1ÎùºÏö¥Îìú");
  const r2 = getRoundBest(data, "üëë2ÎùºÏö¥Îìú");
  const r3 = getRoundBest(data, "üëë3ÎùºÏö¥Îìú");
  document.getElementById("roundSummary").style.display = "flex";
  document.getElementById("r1winner").innerHTML = '<span class="r-name">'+r1.name+'</span>'+(r1.pt?'<span class="r-pt">'+r1.pt+'pt</span>':'');
  document.getElementById("r2winner").innerHTML = '<span class="r-name">'+r2.name+'</span>'+(r2.pt?'<span class="r-pt">'+r2.pt+'pt</span>':'');
  document.getElementById("r3winner").innerHTML = '<span class="r-name">'+r3.name+'</span>'+(r3.pt?'<span class="r-pt">'+r3.pt+'pt</span>':'');

  const maxScore = Math.max(...data.map(r => Number(r["üìùÏµúÏ¢Ö Ï†êÏàò"]) || 0));
  const rankFillClass  = ["fill-1","fill-2","fill-3","fill-o","fill-o","fill-o","fill-o"];
  const rankBadgeClass = ["rank-1","rank-2","rank-3","rank-other","rank-other","rank-other","rank-other"];
  const section = document.getElementById("raceSection");
  Object.keys(activeAnims).forEach(k => {
    if (k === "__celeb__") return;
    clearInterval(activeAnims[k]);
    delete activeAnims[k];
  });
  section.innerHTML = "";

  data.forEach((row, i) => {
    const rank  = i + 1;
    const name  = row["üéôÔ∏èÏä§Ìä∏Î¶¨Î®∏"] || "?";
    const total = Number(row["üìùÏµúÏ¢Ö Ï†êÏàò"]) || 0;
    const s1 = row["üëë1ÎùºÏö¥Îìú"] || "-";
    const s2 = row["üëë2ÎùºÏö¥Îìú"] || "-";
    const s3 = row["üëë3ÎùºÏö¥Îìú"] || "-";
    const pct = maxScore > 0 ? Math.min(93, Math.max(5, (total/maxScore)*88)) : 5;
    const div = document.createElement("div");
    div.className = "race-row";
    div.innerHTML =
      '<div class="race-top">'+
        '<div class="rank-badge '+rankBadgeClass[i]+'">'+rank+'</div>'+
        '<div class="avatar-wrap"><img class="avatar-img" id="avatar_'+i+'" data-sname="'+name+'" src="" alt=""></div>'+
        '<div class="name-score">'+
          '<span class="streamer-name">'+name+'</span>'+
          '<span class="score-total">'+total.toLocaleString()+'</span><span class="score-label">pt</span>'+
        '</div>'+
        '<div class="round-scores">'+
          '<div class="rs-badge"><div class="rs-r">üëë1ÎùºÏö¥Îìú</div><div class="rs-v">'+s1+'</div></div>'+
          '<div class="rs-badge"><div class="rs-r">üëë2ÎùºÏö¥Îìú</div><div class="rs-v">'+s2+'</div></div>'+
          '<div class="rs-badge rs-r3'+(round3Revealed ? ' r3-done' : '')+'" style="'+(round3Revealed ? '' : 'display:none')+'"><div class="rs-r">üëë3ÎùºÏö¥Îìú</div><div class="rs-v">'+s3+'</div></div>'+
        '</div>'+
      '</div>'+
      '<div class="track-wrap">'+
        '<div class="track-bg">'+
          '<div class="track-fill '+rankFillClass[i]+'" style="width:'+pct+'%"></div>'+
          '<div class="finish-line"></div>'+
        '</div>'+
        '<div class="runner-icon'+(rank===1?' is-first':'')+'" style="left:'+pct+'%">'+
          '<img id="runner_'+i+'" src="" alt="">'+
        '</div>'+
      '</div>';
    section.appendChild(div);
    if (i < data.length-1) {
      const hr = document.createElement("div"); hr.className = "row-divider"; section.appendChild(hr);
    }
    startAvatarAnim(document.getElementById("avatar_"+i), name, rank);
    startRunnerAnim(document.getElementById("runner_"+i), name);
  });
}

async function fetchData() {
  const url = "https://script.google.com/macros/s/AKfycbwOCpa65clcNPDIOdkAkO-ZHxmhokuEUmWYTDFcVI3KH-Hws9Wz4c9WMTRQvQJF5jJ6gg/exec?t=" + Date.now();
  try {
    const res = await fetch(url);
    const data = await res.json();
    render(data);
  } catch(e) {
    document.getElementById("raceSection").innerHTML = "<div class='empty'>üò¢ Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®</div>";
  }
}

fetchData();
setInterval(fetchData, 5000);
</script>
</body>
</html>











































