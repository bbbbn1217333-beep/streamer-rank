<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì´ë¼333ë°° ê°œë§ì§± ì»¨í…ì¸ </title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: transparent; font-family: 'Noto Sans KR', sans-serif; padding: 6px; width: 900px; }

.panel {
  background: linear-gradient(160deg, #2a1a00 0%, #3d2600 40%, #2a1a00 100%);
  border-radius: 10px;
  border: 2px solid #c88a2a;
  box-shadow: 0 0 0 1px #6b4200, 0 0 24px rgba(200,138,42,0.3), inset 0 1px 0 rgba(255,220,100,0.12);
  overflow: visible;
  position: relative;
}

.header {
  position: relative; z-index: 1;
  display: flex; align-items: center; justify-content: space-between;
  padding: 5px 12px;
  background: linear-gradient(90deg, transparent, rgba(255,190,50,0.07), transparent);
  border-bottom: 1px solid #6b4200;
  border-radius: 8px 8px 0 0;
}
.header-title { font-size: 13px; font-weight: 900; color: #ffe680; text-shadow: 0 0 10px rgba(255,200,0,0.5), 1px 1px 0 rgba(0,0,0,0.6); letter-spacing: 2px; }
.header-glove { font-size: 13px; display: inline-block; animation: punch 0.6s ease infinite alternate; }
@keyframes punch { from { transform: scale(1) rotate(-15deg); } to { transform: scale(1.2) rotate(10deg); } }

.header-btns { display: flex; align-items: center; gap: 6px; }

/* ìë¬¼ì‡  ë²„íŠ¼ */
.lock-btn {
  background: none; border: none; cursor: pointer;
  font-size: 18px; line-height: 1; padding: 0 2px;
  transition: transform 0.2s;
  filter: drop-shadow(0 0 4px rgba(255,200,0,0.3));
}
.lock-btn:hover { transform: scale(1.2); }

/* ì™„ì£¼ ë²„íŠ¼ */
.finish-btn {
  background: linear-gradient(135deg, #c87000, #ffcc00);
  border: 1px solid #ffe080;
  border-radius: 5px;
  color: #3a1a00;
  font-size: 10px; font-weight: 900;
  padding: 3px 8px;
  cursor: pointer;
  font-family: 'Noto Sans KR', sans-serif;
  letter-spacing: 0.5px;
  transition: all 0.15s;
  box-shadow: 0 2px 6px rgba(0,0,0,0.4);
}
.finish-btn:hover { transform: scale(1.05); box-shadow: 0 0 10px rgba(255,200,0,0.5); }
.finish-btn:active { transform: scale(0.97); }
.finish-btn.active {
  background: linear-gradient(135deg, #ff4040, #ff8800);
  border-color: #ffaaaa;
  color: #fff;
}

/* ë¼ìš´ë“œ ìš”ì•½ */
.round-summary {
  position: relative; z-index: 1;
  display: flex; gap: 4px;
  padding: 4px 10px;
  border-bottom: 1px solid rgba(107,66,0,0.5);
}
.round-badge {
  flex: 1; background: rgba(0,0,0,0.3);
  border: 1px solid #6b4200; border-radius: 5px;
  padding: 2px 6px; text-align: center;
}
.round-badge .r-label { font-size: 8px; color: #c88a2a; font-weight: 700; letter-spacing: 0.5px; }
.round-badge .r-winner { font-size: 10px; color: #ffe680; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* ë©”ì¸ ë ˆì´ìŠ¤ */
.race-section { position: relative; z-index: 1; padding: 4px 8px 2px; }

.race-row { margin-bottom: 3px; position: relative; }
@keyframes fadeSlide { from { opacity:0; transform: translateX(-12px); } to { opacity:1; transform: translateX(0); } }
.race-row:nth-child(1)  { animation: fadeSlide 0.35s 0.00s both; }
.race-row:nth-child(3)  { animation: fadeSlide 0.35s 0.05s both; }
.race-row:nth-child(5)  { animation: fadeSlide 0.35s 0.10s both; }
.race-row:nth-child(7)  { animation: fadeSlide 0.35s 0.15s both; }
.race-row:nth-child(9)  { animation: fadeSlide 0.35s 0.20s both; }
.race-row:nth-child(11) { animation: fadeSlide 0.35s 0.25s both; }
.race-row:nth-child(13) { animation: fadeSlide 0.35s 0.30s both; }

.race-top { display: flex; align-items: center; gap: 5px; margin-bottom: 1px; }

.rank-badge {
  width: 18px; height: 18px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 9px; font-weight: 900; flex-shrink: 0; border: 1px solid;
}
.rank-1 { background: radial-gradient(circle, #ffe047, #c87000); color: #3a1a00; border-color: #ffcc00; box-shadow: 0 0 6px rgba(255,200,0,0.5); }
.rank-2 { background: radial-gradient(circle, #d0d8e0, #7a8a99); color: #1a2030; border-color: #b0bec5; }
.rank-3 { background: radial-gradient(circle, #f0a070, #a04010); color: #2a0800; border-color: #cd7f32; }
.rank-other { background: rgba(0,0,0,0.4); color: #a09060; border-color: #5a4020; }

.avatar-wrap { width: 24px; height: 48px; flex-shrink: 0; }
.avatar-wrap img { width: 120px; height: 120px; object-fit: cover; border-radius: 3px; border: 1px solid; display: block; }
.rank-1-border { border-color: #ffcc00 !important; box-shadow: 0 0 4px rgba(255,200,0,0.6); }
.rank-2-border { border-color: #b0bec5 !important; }
.rank-3-border { border-color: #cd7f32 !important; }
.rank-o-border { border-color: #5a4020 !important; }
.avatar-placeholder { width: 24px; height: 24px; border-radius: 3px; background: rgba(0,0,0,0.3); border: 1px dashed #6b4200; display: flex; align-items: center; justify-content: center; font-size: 12px; }

.name-score { flex: 1; min-width: 0; display: flex; align-items: center; gap: 5px; }
.streamer-name { font-size: 11px; font-weight: 700; color: #ffe680; text-shadow: 1px 1px 0 rgba(0,0,0,0.7); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 120px; }
.score-total { font-size: 12px; font-weight: 900; color: #fff; text-shadow: 0 0 6px rgba(255,200,0,0.3); flex-shrink: 0; }
.score-label { font-size: 8px; color: #c88a2a; margin-left: 1px; }

.round-scores { display: flex; gap: 2px; margin-left: auto; flex-shrink: 0; }
.rs-badge { background: rgba(0,0,0,0.4); border: 1px solid #5a4020; border-radius: 3px; padding: 1px 4px; text-align: center; min-width: 30px; }
.rs-badge .rs-r { font-size: 6px; color: #a07840; font-weight: 700; }
.rs-badge .rs-v { font-size: 9px; color: #e8d080; font-weight: 700; }

/* íŠ¸ë™ */
.track-wrap { position: relative; height: 44px; overflow: visible; }
.track-bg {
  position: absolute; top: 50%; transform: translateY(-50%);
  left: 0; right: 0; height: 10px;
  background: #1a1008; border-radius: 5px; border: 1px solid #4a3010; overflow: hidden;
}
.track-bg::after {
  content: ''; position: absolute; top: 50%; transform: translateY(-50%);
  left: 0; right: 0; height: 1px;
  background: repeating-linear-gradient(90deg, transparent, transparent 10px, rgba(255,200,0,0.12) 10px, rgba(255,200,0,0.12) 18px);
}
.track-fill { position: absolute; top: 0; left: 0; height: 100%; border-radius: 5px; transition: width 1s cubic-bezier(0.34,1.3,0.64,1); z-index: 1; }
.fill-1 { background: linear-gradient(90deg, #c87000, #ffcc00, #ffe680); box-shadow: 0 0 4px rgba(255,180,0,0.5); }
.fill-2 { background: linear-gradient(90deg, #5a6a7a, #b0bec5); }
.fill-3 { background: linear-gradient(90deg, #7a3010, #cd7f32); }
.fill-o { background: linear-gradient(90deg, #3a2800, #6b4200); }
.finish-line { position: absolute; right: 0; top: 0; height: 100%; width: 7px; background: repeating-linear-gradient(90deg, #fff 0px, #fff 2px, #000 2px, #000 4px); border-radius: 0 5px 5px 0; opacity: 0.5; z-index: 2; }

.runner-icon {
  position: absolute; top: 50%; transform: translate(-50%, -50%);
  width: 24px; height: 48px;
  z-index: 10;
  transition: left 1s cubic-bezier(0.34,1.3,0.64,1);
  pointer-events: none;
}
.runner-icon img {
  width: 120px; height: 120px; object-fit: cover;
  border-radius: 50%; border: none; background: transparent;
  image-rendering: pixelated;
}
.runner-icon.is-first::after {
  content: 'â­'; position: absolute; top: -10px; left: 50%;
  transform: translateX(-50%); font-size: 9px;
  animation: bounce 0.8s ease infinite alternate;
}
@keyframes bounce { from { transform: translateX(-50%) translateY(0); } to { transform: translateX(-50%) translateY(-3px); } }

/* ===== ì™„ì£¼ ì´í™íŠ¸ ì˜¤ë²„ë ˆì´ ===== */
#celebOverlay {
  display: none;
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9999;
  overflow: hidden;
}
#celebOverlay.active { display: block; }

/* 1ë“± í™•ì • í…ìŠ¤íŠ¸ */
.celeb-text {
  position: absolute;
  top: 38%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-family: 'Noto Sans KR', sans-serif;
  font-size: 52px;
  font-weight: 900;
  color: #ffe680;
  text-shadow:
    0 0 20px rgba(255,200,0,1),
    0 0 40px rgba(255,150,0,0.8),
    3px 3px 0 #7a3a00,
    6px 6px 0 rgba(0,0,0,0.5);
  animation: textPop 0.5s cubic-bezier(0.34,1.6,0.64,1) both;
  white-space: nowrap;
  text-align: center;
  z-index: 10001;
}
.celeb-winner {
  display: block;
  font-size: 30px;
  color: #fff;
  text-shadow: 0 0 10px rgba(255,220,100,0.8), 2px 2px 0 rgba(0,0,0,0.6);
  margin-top: 6px;
}
@keyframes textPop {
  from { transform: translate(-50%, -50%) scale(0.2) rotate(-10deg); opacity: 0; }
  to   { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
}

/* íŒŒí‹°í´ ê³µí†µ */
.particle { position: absolute; pointer-events: none; z-index: 10000; }

/* í­ì£½ */
.firework {
  width: 6px; height: 6px; border-radius: 50%;
  animation: fwExplode var(--dur) ease-out forwards;
}
@keyframes fwExplode {
  0%   { transform: translate(0,0) scale(1); opacity: 1; }
  100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
}

/* ë©”ì†Œ (ë™ì „) */
.meso {
  font-size: 18px;
  animation: mesoFall var(--dur) ease-in forwards;
  line-height: 1;
}
@keyframes mesoFall {
  0%   { transform: translateY(0) rotate(0deg) scale(1); opacity: 1; }
  80%  { opacity: 1; }
  100% { transform: translateY(var(--fall)) rotate(var(--rot)) scale(0.6); opacity: 0; }
}

/* ë°˜ì§ì´ */
.sparkle {
  font-size: 14px;
  animation: sparkleFly var(--dur) ease-out forwards;
}
@keyframes sparkleFly {
  0%   { transform: translate(0,0) scale(0) rotate(0deg); opacity: 1; }
  50%  { transform: translate(var(--mx), var(--my)) scale(1.2) rotate(180deg); opacity: 1; }
  100% { transform: translate(calc(var(--mx)*1.5), calc(var(--my)*1.5 + 40px)) scale(0) rotate(360deg); opacity: 0; }
}

.row-divider { height: 1px; background: linear-gradient(90deg, transparent, rgba(107,66,0,0.3), transparent); margin-bottom: 3px; }

.footer {
  position: relative; z-index: 1;
  display: flex; align-items: center; justify-content: flex-end;
  padding: 2px 10px 5px; gap: 4px;
}
.live-dot { width: 5px; height: 5px; border-radius: 50%; background: #4cff80; box-shadow: 0 0 4px rgba(76,255,128,0.8); animation: pulse 1.5s ease infinite; }
@keyframes pulse { 0%,100% { opacity:1; transform:scale(1); } 50% { opacity:0.5; transform:scale(0.8); } }
.live-text { font-size: 9px; color: #4cff80; font-weight: 700; letter-spacing: 1px; }
.update-time { font-size: 8px; color: #6b5030; margin-left: 3px; }
.empty { padding: 16px; text-align: center; color: #6b4200; font-size: 12px; }
</style>
</head>
<body>

<!-- ì™„ì£¼ ì´í™íŠ¸ ì˜¤ë²„ë ˆì´ -->
<div id="celebOverlay">
  <div class="celeb-text" id="celebText">
    ğŸ† 1ë“± í™•ì •! ğŸ†
    <span class="celeb-winner" id="celebWinner"></span>
  </div>
</div>

<div class="panel" id="panel">
  <div class="header">
    <span class="header-glove">ğŸ¥Š</span>
    <span class="header-title">ì´ë¼333ë°° ê°œë§ì§± ì»¨í…ì¸ </span>
    <div class="header-btns">
      <button class="finish-btn" id="finishBtn" onclick="triggerFinish()">ğŸ† ì™„ì£¼!</button>
      <button class="lock-btn" id="lockBtn" onclick="toggleRound3()" title="3ë¼ìš´ë“œ ê³µê°œ/ìˆ¨ê¹€">ğŸ”’</button>
    </div>
  </div>

  <div class="round-summary" id="roundSummary" style="display:none">
    <div class="round-badge"><div class="r-label">ğŸ¥Š 1ë¼ìš´ë“œ</div><div class="r-winner" id="r1winner">-</div></div>
    <div class="round-badge"><div class="r-label">ğŸ¥Š 2ë¼ìš´ë“œ</div><div class="r-winner" id="r2winner">-</div></div>
    <div class="round-badge" id="r3badge" style="display:none"><div class="r-label">ğŸ¥Š 3ë¼ìš´ë“œ</div><div class="r-winner" id="r3winner">-</div></div>
  </div>

  <div class="race-section" id="raceSection">
    <div class="empty">ğŸ“¡ ë°ì´í„° ë¡œë”© ì¤‘...</div>
  </div>

  <div class="footer">
    <div class="live-dot"></div>
    <span class="live-text">LIVE</span>
    <span class="update-time" id="updateTime">-</span>
  </div>
</div>

<script>
const SHEET_ID   = "18F2mJsiSWYbxSl97u4vKEX9pTuEOuoL1WaGE5PB_iJ0";
const SHEET_NAME = "ì‹œíŠ¸1!E12:I18";
let prevJSON = "";
let round3Revealed = false;
let celebActive = false;
let celebTimer = null;
let currentFirstName = "";

// ===== ìë¬¼ì‡  =====
function toggleRound3() {
  round3Revealed = !round3Revealed;
  const btn = document.getElementById("lockBtn");
  const badge = document.getElementById("r3badge");
  if (round3Revealed) {
    btn.textContent = "ğŸ”“";
    badge.style.display = "";
    document.querySelectorAll(".rs-r3").forEach(el => el.style.display = "");
  } else {
    btn.textContent = "ğŸ”’";
    badge.style.display = "none";
    document.querySelectorAll(".rs-r3").forEach(el => el.style.display = "none");
  }
}

// ===== ì™„ì£¼ ì´í™íŠ¸ =====
function triggerFinish() {
  if (celebActive) {
    stopCeleb();
    return;
  }
  celebActive = true;
  document.getElementById("finishBtn").classList.add("active");
  document.getElementById("finishBtn").textContent = "â¹ ì¢…ë£Œ";

  // 1ë“± ì´ë¦„ í‘œì‹œ
  document.getElementById("celebWinner").textContent = currentFirstName || "";
  document.getElementById("celebText").style.display = "";

  const overlay = document.getElementById("celebOverlay");
  overlay.classList.add("active");

  // í­ì£½ + ë©”ì†Œ ë°˜ë³µ ë°œì‚¬
  spawnBurst();
  const interval = setInterval(() => {
    if (!celebActive) { clearInterval(interval); return; }
    spawnBurst();
  }, 600);

  // ì €ì¥í•´ë’€ë‹¤ê°€ stopCelebì—ì„œ í´ë¦¬ì–´
  window._celebInterval = interval;

  // 15ì´ˆ í›„ ìë™ ì¢…ë£Œ
  celebTimer = setTimeout(stopCeleb, 15000);
}

function stopCeleb() {
  celebActive = false;
  clearInterval(window._celebInterval);
  clearTimeout(celebTimer);
  document.getElementById("celebOverlay").classList.remove("active");
  document.getElementById("finishBtn").classList.remove("active");
  document.getElementById("finishBtn").textContent = "ğŸ† ì™„ì£¼!";
  // íŒŒí‹°í´ ì „ë¶€ ì œê±°
  document.querySelectorAll(".particle").forEach(p => p.remove());
}

function rand(min, max) { return Math.random() * (max - min) + min; }

function spawnBurst() {
  const overlay = document.getElementById("celebOverlay");
  const W = window.innerWidth;
  const H = window.innerHeight;

  // í­ì£½ ì—¬ëŸ¬ êµ°ë°
  const fwColors = ["#ff4040","#ff9900","#ffe040","#40ff80","#40c0ff","#c040ff","#ff40c0","#ffffff"];
  const spots = [
    { x: W * 0.2, y: H * 0.25 },
    { x: W * 0.5, y: H * 0.15 },
    { x: W * 0.8, y: H * 0.25 },
    { x: W * rand(0.1, 0.9), y: H * rand(0.1, 0.4) },
  ];

  spots.forEach(spot => {
    const count = Math.floor(rand(10, 20));
    for (let i = 0; i < count; i++) {
      const el = document.createElement("div");
      el.className = "particle firework";
      const angle = rand(0, 360) * Math.PI / 180;
      const dist  = rand(40, 130);
      const dur   = rand(0.6, 1.2);
      el.style.cssText = `
        left: ${spot.x}px; top: ${spot.y}px;
        background: ${fwColors[Math.floor(rand(0, fwColors.length))]};
        --tx: ${Math.cos(angle) * dist}px;
        --ty: ${Math.sin(angle) * dist}px;
        --dur: ${dur}s;
        width: ${rand(4,8)}px; height: ${rand(4,8)}px;
      `;
      overlay.appendChild(el);
      setTimeout(() => el.remove(), dur * 1000 + 100);
    }
  });

  // ë©”ì†Œ ë¹„ (ìƒë‹¨ì—ì„œ ì•„ë˜ë¡œ)
  const mesoEmojis = ["ğŸª™","ğŸ’°","ğŸ’µ","â­","âœ¨","ğŸŒŸ"];
  const mesoCount = Math.floor(rand(8, 16));
  for (let i = 0; i < mesoCount; i++) {
    const el = document.createElement("div");
    el.className = "particle meso";
    const x   = rand(0, W);
    const dur  = rand(1.2, 2.2);
    const fall = rand(H * 0.5, H * 0.9);
    el.style.cssText = `
      left: ${x}px; top: ${-20}px;
      --fall: ${fall}px;
      --rot: ${rand(-360, 360)}deg;
      --dur: ${dur}s;
      animation-delay: ${rand(0, 0.4)}s;
    `;
    el.textContent = mesoEmojis[Math.floor(rand(0, mesoEmojis.length))];
    overlay.appendChild(el);
    setTimeout(() => el.remove(), (dur + 0.5) * 1000);
  }

  // ë°˜ì§ì´
  const sparkCount = Math.floor(rand(6, 12));
  for (let i = 0; i < sparkCount; i++) {
    const el = document.createElement("div");
    el.className = "particle sparkle";
    const dur = rand(0.8, 1.6);
    el.style.cssText = `
      left: ${rand(0, W)}px; top: ${rand(H * 0.1, H * 0.7)}px;
      --mx: ${rand(-80, 80)}px;
      --my: ${rand(-80, 20)}px;
      --dur: ${dur}s;
    `;
    el.textContent = ["âœ¨","â­","ğŸ’«","ğŸŒŸ"][Math.floor(rand(0,4))];
    overlay.appendChild(el);
    setTimeout(() => el.remove(), dur * 1000 + 100);
  }
}

// ===== ë°ì´í„° =====
function getImgFile(name, rank) {
  if (name === "ì´ë¼333") return rank <= 3 ? "/images/default.gif" : "/images/ì´ë¼333.gif";
  return "/images/default.gif";
}

function getRoundWinner(data, key) {
  if (!data.length) return "-";
  return data.reduce((best, r) => Number(r[key]) > Number(best[key]) ? r : best)["ğŸ™ï¸ìŠ¤íŠ¸ë¦¬ë¨¸"] || "-";
}

function render(data) {
  if (!data || !data.length) {
    document.getElementById("raceSection").innerHTML = "<div class='empty'>ğŸ˜¶ ë°ì´í„° ì—†ìŒ</div>";
    document.getElementById("roundSummary").style.display = "none";
    return;
  }

  data.sort((a, b) => Number(b["ğŸ“ìµœì¢… ì ìˆ˜"]) - Number(a["ğŸ“ìµœì¢… ì ìˆ˜"]));
  data = data.slice(0, 7);

  const json = JSON.stringify(data);
  if (json === prevJSON) return;
  prevJSON = json;

  // 1ë“± ì´ë¦„ ì—…ë°ì´íŠ¸
  currentFirstName = data[0]["ğŸ™ï¸ìŠ¤íŠ¸ë¦¬ë¨¸"] || "";
  if (celebActive) {
    document.getElementById("celebWinner").textContent = currentFirstName;
  }

  const maxScore = Math.max(...data.map(r => Number(r["ğŸ“ìµœì¢… ì ìˆ˜"]) || 0));

  document.getElementById("roundSummary").style.display = "flex";
  document.getElementById("r1winner").textContent = getRoundWinner(data, "ğŸ¥Š1ì„¸íŠ¸");
  document.getElementById("r2winner").textContent = getRoundWinner(data, "ğŸ¥Š2ì„¸íŠ¸");
  document.getElementById("r3winner").textContent = getRoundWinner(data, "ğŸ¥Š3ì„¸íŠ¸");

  const rankFillClass   = ["fill-1","fill-2","fill-3","fill-o","fill-o","fill-o","fill-o"];
  const rankBadgeClass  = ["rank-1","rank-2","rank-3","rank-other","rank-other","rank-other","rank-other"];
  const rankBorderClass = ["rank-1-border","rank-2-border","rank-3-border","rank-o-border","rank-o-border","rank-o-border","rank-o-border"];

  const section = document.getElementById("raceSection");
  section.innerHTML = "";

  data.forEach((row, i) => {
    const rank    = i + 1;
    const name    = row["ğŸ™ï¸ìŠ¤íŠ¸ë¦¬ë¨¸"] || "?";
    const total   = Number(row["ğŸ“ìµœì¢… ì ìˆ˜"]) || 0;
    const s1      = row["ğŸ¥Š1ì„¸íŠ¸"] || "-";
    const s2      = row["ğŸ¥Š2ì„¸íŠ¸"] || "-";
    const s3      = row["ğŸ¥Š3ì„¸íŠ¸"] || "-";
    const pct     = maxScore > 0 ? Math.min(93, Math.max(5, (total / maxScore) * 88)) : 5;
    const imgFile = getImgFile(name, rank);
    const r3disp  = round3Revealed ? "" : "display:none";

    const div = document.createElement("div");
    div.className = "race-row";
    div.innerHTML =
      '<div class="race-top">' +
        '<div class="rank-badge ' + rankBadgeClass[i] + '">' + rank + '</div>' +
        '<div class="avatar-wrap">' +
          '<img src="' + imgFile + '" class="' + rankBorderClass[i] + '" onerror="this.outerHTML=\'<div class=&quot;avatar-placeholder&quot;>ğŸ§™</div>\'" alt="' + name + '">' +
        '</div>' +
        '<div class="name-score">' +
          '<span class="streamer-name">' + name + '</span>' +
          '<span class="score-total">' + total.toLocaleString() + '</span><span class="score-label">pt</span>' +
        '</div>' +
        '<div class="round-scores">' +
          '<div class="rs-badge"><div class="rs-r">1ë¼ìš´ë“œ</div><div class="rs-v">' + s1 + '</div></div>' +
          '<div class="rs-badge"><div class="rs-r">2ë¼ìš´ë“œ</div><div class="rs-v">' + s2 + '</div></div>' +
          '<div class="rs-badge rs-r3" style="' + r3disp + '"><div class="rs-r">3ë¼ìš´ë“œ</div><div class="rs-v">' + s3 + '</div></div>' +
        '</div>' +
      '</div>' +
      '<div class="track-wrap">' +
        '<div class="track-bg">' +
          '<div class="track-fill ' + rankFillClass[i] + '" style="width:' + pct + '%"></div>' +
          '<div class="finish-line"></div>' +
        '</div>' +
        '<div class="runner-icon' + (rank === 1 ? ' is-first' : '') + '" style="left:' + pct + '%">' +
          '<img src="' + imgFile + '" onerror="this.style.display=\'none\'" alt="">' +
        '</div>' +
      '</div>';

    section.appendChild(div);

    if (i < data.length - 1) {
      const hr = document.createElement("div");
      hr.className = "row-divider";
      section.appendChild(hr);
    }
  });

  const now = new Date();
  document.getElementById("updateTime").textContent =
    "ì—…ë°ì´íŠ¸ " + String(now.getHours()).padStart(2,"0") + ":" +
    String(now.getMinutes()).padStart(2,"0") + ":" +
    String(now.getSeconds()).padStart(2,"0");
}

async function fetchData() {
  const url = "https://opensheet.elk.sh/" + SHEET_ID + "/" + encodeURIComponent(SHEET_NAME);
  try {
    const res  = await fetch(url);
    const data = await res.json();
    render(data);
  } catch (e) {
    console.error(e);
    document.getElementById("raceSection").innerHTML = "<div class='empty'>ğŸ˜¢ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</div>";
  }
}

fetchData();
setInterval(fetchData, 5000);
</script>
</body>
</html>



















